"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[4280],{3905:function(n,t,e){e.d(t,{Zo:function(){return s},kt:function(){return h}});var r=e(7294);function i(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function o(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?o(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):o(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function l(n,t){if(null==n)return{};var e,r,i=function(n,t){if(null==n)return{};var e,r,i={},o=Object.keys(n);for(r=0;r<o.length;r++)e=o[r],t.indexOf(e)>=0||(i[e]=n[e]);return i}(n,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)e=o[r],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}var c=r.createContext({}),u=function(n){var t=r.useContext(c),e=t;return n&&(e="function"==typeof n?n(t):a(a({},t),n)),e},s=function(n){var t=u(n.components);return r.createElement(c.Provider,{value:t},n.children)},m={inlineCode:"code",wrapper:function(n){var t=n.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(n,t){var e=n.components,i=n.mdxType,o=n.originalType,c=n.parentName,s=l(n,["components","mdxType","originalType","parentName"]),p=u(e),h=i,d=p["".concat(c,".").concat(h)]||p[h]||m[h]||o;return e?r.createElement(d,a(a({ref:t},s),{},{components:e})):r.createElement(d,a({ref:t},s))}));function h(n,t){var e=arguments,i=t&&t.mdxType;if("string"==typeof n||i){var o=e.length,a=new Array(o);a[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=n,l.mdxType="string"==typeof n?n:i,a[1]=l;for(var u=2;u<o;u++)a[u]=e[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,e)}p.displayName="MDXCreateElement"},9118:function(n,t,e){e.r(t),e.d(t,{assets:function(){return s},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return m}});var r=e(7462),i=e(3366),o=(e(7294),e(3905)),a=["components"],l={},c=void 0,u={unversionedId:"\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406",id:"\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406",title:"\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406",description:"\u524d\u8a00",source:"@site/docs/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93",slug:"/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406",draft:!1,editUrl:"https://github.com/longyuwlz/longyu.github.io/docs/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528 atexit \u51fd\u6570\u6765\u6ce8\u518c\u89e3\u521d\u59cb\u5316\u51fd\u6570",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u4f7f\u7528 atexit \u51fd\u6570\u6765\u6ce8\u518c\u89e3\u521d\u59cb\u5316\u51fd\u6570"},next:{title:"\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879"}},s={},m=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u5982\u4f55\u5b9e\u73b0\u5728 main \u51fd\u6570\u4e4b\u524d\u6267\u884c\u67d0\u4e9b\u903b\u8f91",id:"\u5982\u4f55\u5b9e\u73b0\u5728-main-\u51fd\u6570\u4e4b\u524d\u6267\u884c\u67d0\u4e9b\u903b\u8f91",level:2},{value:"hook main \u51fd\u6570\u7684\u4ee3\u7801",id:"hook-main-\u51fd\u6570\u7684\u4ee3\u7801",level:2},{value:"\u4e0a\u8ff0\u4ee3\u7801\u6709\u600e\u6837\u7684\u903b\u8f91\uff1f",id:"\u4e0a\u8ff0\u4ee3\u7801\u6709\u600e\u6837\u7684\u903b\u8f91",level:2},{value:"\u7f16\u8bd1\u53c2\u6570\u4e0e\u6267\u884c\u53c2\u6570",id:"\u7f16\u8bd1\u53c2\u6570\u4e0e\u6267\u884c\u53c2\u6570",level:2},{value:"\u52a8\u6001\u5e93\u76f8\u5173\u51fd\u6570\u8c03\u7528",id:"\u52a8\u6001\u5e93\u76f8\u5173\u51fd\u6570\u8c03\u7528",level:2},{value:"preload \u5230\u5e95\u662f\u600e\u6837\u5de5\u4f5c\u7684\uff1f",id:"preload-\u5230\u5e95\u662f\u600e\u6837\u5de5\u4f5c\u7684",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],p={toc:m};function h(n){var t=n.components,e=(0,i.Z)(n,a);return(0,o.kt)("wrapper",(0,r.Z)({},p,e,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,o.kt)("p",null,"\u5728\u652f\u6301\u67d0\u4e2a\u9879\u76ee\u7684\u65f6\u5019\uff0c\u9700\u8981\u6253\u5305\u56fe\u5f62\u5316\u7a0b\u5e8f\u8fd0\u884c\u4f9d\u8d56\u7684\u6587\u4ef6\uff0c\u7136\u540e\u5728\u975e\u5e38\u8001\u7684 linux \u7248\u672c\u4e0a\u8fd0\u884c\uff0c\u76f4\u63a5\u4f7f\u7528 chroot \u547d\u4ee4\u53ef\u4ee5\u8fbe\u6210\u76ee\u6807\uff0c\u4f46\u662f\u6211\u89c9\u5f97\u4e5f\u8bb8\u53ef\u4ee5\u901a\u8fc7 preload \u7684\u65b9\u5f0f\u6765\u9690\u85cf chroot \u7684\u884c\u4e3a\u3002"),(0,o.kt)("p",null,"\u7531\u4e8e chroot \u7684\u5f71\u54cd\u662f\u7cfb\u7edf\u7ea7\u7684\uff0c\u6211\u53ea\u8981\u5728 main \u51fd\u6570\u4e4b\u524d\u6267\u884c chroot \u5c31\u80fd\u591f\u8fbe\u6210\u76ee\u6807\u3002"),(0,o.kt)("h2",{id:"\u5982\u4f55\u5b9e\u73b0\u5728-main-\u51fd\u6570\u4e4b\u524d\u6267\u884c\u67d0\u4e9b\u903b\u8f91"},"\u5982\u4f55\u5b9e\u73b0\u5728 main \u51fd\u6570\u4e4b\u524d\u6267\u884c\u67d0\u4e9b\u903b\u8f91"),(0,o.kt)("p",null,"\u65e2\u7136\u5df2\u7ecf\u786e\u5b9a\u4e86\u76ee\u6807\uff0c\u90a3\u4e48\u6211\u9700\u8981\u627e\u5230\u4e00\u79cd\u673a\u5236\uff0c\u5141\u8bb8\u6211\u5728 main \u51fd\u6570\u4e4b\u524d\u6267\u884c chroot \u7cfb\u7edf\u8c03\u7528\uff0c\u6309\u7167\u6211\u638c\u63e1\u7684\u77e5\u8bc6\u6709\u5982\u4e0b\u4e24\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4f7f\u7528 gcc \u7684 constructor \u5c5e\u6027"),(0,o.kt)("li",{parentName:"ol"},"hook main \u51fd\u6570\uff0c\u5148\u6267\u884c chroot \u76f8\u5173\u903b\u8f91\uff0c\u7136\u540e\u6267\u884c\u7a0b\u5e8f\u4e2d\u7684 main \u51fd\u6570")),(0,o.kt)("p",null,"\u7531\u4e8e\u6211\u4e0d\u80fd\u91cd\u65b0\u7f16\u8bd1\u76ee\u6807\u56fe\u5f62\u5316\u7a0b\u5e8f\uff0c\u7b2c\u4e00\u79cd\u65b9\u5f0f\u4e0d\u53ef\u7528\uff0c\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u5012\u662f\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\u3002"),(0,o.kt)("h2",{id:"hook-main-\u51fd\u6570\u7684\u4ee3\u7801"},"hook main \u51fd\u6570\u7684\u4ee3\u7801"),(0,o.kt)("p",null,"\u5982\u4e0b\u4ee3\u7801\u4ece ",(0,o.kt)("a",{parentName:"p",href:"https://gist.github.com/apsun/1e144bf7639b22ff0097171fa0f8c6b1"},"Hook main() using LD_PRELOAD ")," \u8fd9\u4e2a github \u9879\u76ee\u4e2d\u62f7\u8d1d\u5e76\u9488\u5bf9\u6211\u7684\u9700\u6c42\u8fdb\u884c\u4e86\u4fee\u6539\u3002"),(0,o.kt)("p",null,"\u4fee\u6539\u540e\u7684\u4ee3\u7801\u8d34\u5230\u4e0b\u9762\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'/*\n ** Hook main() using LD_PRELOAD, because why not?\n ** Obviously, this code is not portable. Use at your own risk.\n **\n ** Compile using \'gcc hax.c -o hax.so -fPIC -shared -ldl\'\n ** Then run your program as \'LD_PRELOAD=$PWD/hax.so ./a.out\'\n **/\n\n#define _GNU_SOURCE\n#include <stdio.h>\n#include <dlfcn.h>\n#include <unistd.h>\n\n/* Trampoline for the real main() */\nstatic int (*main_orig)(int, char **, char **);\n\n/* Our fake main() that gets called by __libc_start_main() */\nint main_hook(int argc, char **argv, char **envp)\n{\n    int i;\n    for (i = 0; i < argc; ++i) {\n        printf("argv[%d] = %s\\n", i, argv[i]);\n    }\n    printf("--- Before main ---\\n");\n    chroot("./");\n    chdir("/");\n    int ret = main_orig(argc, argv, envp);\n    printf("--- After main ----\\n");\n    printf("main() returned %d\\n", ret);\n    return ret;\n}\n\n/*\n *  * Wrapper for __libc_start_main() that replaces the real main\n *   * function with our hooked version.\n *    */\nint __libc_start_main(\n    int (*main)(int, char **, char **),\n    int argc,\n    char **argv,\n    int (*init)(int, char **, char **),\n    void (*fini)(void),\n    void (*rtld_fini)(void),\n    void *stack_end)\n{\n    /* Save the real main function address */\n    main_orig = main;\n\n    /* Find the real __libc_start_main()... */\n    typeof(&__libc_start_main) orig = dlsym(RTLD_NEXT, "__libc_start_main");\n\n    /* ... and call it with our custom main function */\n    return orig(main_hook, argc, argv, init, fini, rtld_fini, stack_end);\n}\n')),(0,o.kt)("p",null,"\u5728 main_hook \u4e2d\u6211\u6dfb\u52a0\u4e86\u4e0b\u9762\u4e24\u884c\u4e0e chroot \u76f8\u5173\u7684\u4ee3\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'    chroot("./");\n    chdir("/");\n')),(0,o.kt)("p",null,"\u8fd9\u91cc\u4f7f\u7528\u7684\u662f\u5f53\u524d\u76ee\u5f55\uff0c\u4e5f\u53ef\u4ee5\u6539\u4e3a\u7edd\u5bf9\u8def\u5f84\uff0c\u8fd9",(0,o.kt)("strong",{parentName:"p"},"\u4e24\u884c\u4ee3\u7801\u5176\u5b9e\u5c31\u662f chroot \u547d\u4ee4\u7684\u6838\u5fc3\u3002")),(0,o.kt)("h2",{id:"\u4e0a\u8ff0\u4ee3\u7801\u6709\u600e\u6837\u7684\u903b\u8f91"},"\u4e0a\u8ff0\u4ee3\u7801\u6709\u600e\u6837\u7684\u903b\u8f91\uff1f"),(0,o.kt)("p",null,"\u5b9e\u9645\u4e0a\u4e0a\u8ff0\u4ee3\u7801 hook \u7684\u662f  __libc_start_main \u8fd9\u4e2a\u51fd\u6570\uff01"),(0,o.kt)("p",null,"\u52a8\u6001\u94fe\u63a5\u7684\u7a0b\u5e8f\uff0c\u5176 ",(0,o.kt)("strong",{parentName:"p"},"main \u51fd\u6570\u662f __libc_start_main \u51fd\u6570\u7684\u4e00\u4e2a\u53c2\u6570"),"\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u5148 ",(0,o.kt)("strong",{parentName:"p"},"hook __libc_start_main")," \u5f97\u5230\u9700\u8981\u8c03\u7528\u7684 main \u51fd\u6570\uff0c\u4ee5\u5176\u503c\u8bbe\u5b9a",(0,o.kt)("strong",{parentName:"p"},"\u9759\u6001\u53d8\u91cf  main_orig"),"\uff0c\u7136\u540e\u4f7f\u7528 ",(0,o.kt)("strong",{parentName:"p"},"dlsym")," \u51fd\u6570\u627e\u5230\u7a0b\u5e8f\u4e2d",(0,o.kt)("strong",{parentName:"p"},"\u771f\u5b9e\u7684 __libc_start_main \u51fd\u6570\u7684\u4f4d\u7f6e"),"\uff0c\u4f7f\u7528 main_hook \u66ff\u6362\u53c2\u6570 main \u8c03\u7528\u771f\u5b9e\u7684 __libc_start_main\u3002"),(0,o.kt)("p",null,"\u5f53\u771f\u6b63\u7684 __libc_start_main \u6267\u884c\u7684\u65f6\u5019\uff0c\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u5df2\u7ecf\u88ab\u66ff\u6362\u4e3a\u4e86 hook \u5e93\u4e2d\u7684 main_hook \u51fd\u6570\uff0c\u540c\u65f6\u539f\u6765\u7684 main \u51fd\u6570\u5730\u5740\u4e5f\u5df2\u7ecf\u4fdd\u5b58\u5230\u4e86 main_orig \u4e2d\u3002"),(0,o.kt)("p",null,"main_hook \u51fd\u6570\u9996\u5148\u6267\u884c\u9700\u8981\u5728 main \u51fd\u6570\u4e4b\u524d\u6267\u884c\u7684\u903b\u8f91\uff0c\u7136\u540e\u8c03\u7528 main_orig \u5c31\u4e32\u8d77\u4e86\u6574\u4e2a\u8fc7\u7a0b\u3002"),(0,o.kt)("h2",{id:"\u7f16\u8bd1\u53c2\u6570\u4e0e\u6267\u884c\u53c2\u6570"},"\u7f16\u8bd1\u53c2\u6570\u4e0e\u6267\u884c\u53c2\u6570"),(0,o.kt)("p",null,"\u5c06\u4e0a\u9762\u7684\u6e90\u7801\u4fdd\u5b58\u4e3a hook_main.c\uff0c\u7136\u540e\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u7f16\u8bd1\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"gcc -fPIC -shared hook_main.c -o libhooker.so -ldl\n")),(0,o.kt)("p",null,"\u6267\u884c\u793a\u4f8b\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"LD_PRELOAD=/tmp/libhooker.so ./a.out\n")),(0,o.kt)("h2",{id:"\u52a8\u6001\u5e93\u76f8\u5173\u51fd\u6570\u8c03\u7528"},"\u52a8\u6001\u5e93\u76f8\u5173\u51fd\u6570\u8c03\u7528"),(0,o.kt)("p",null,"\u4e0a\u9762\u7684\u4ee3\u7801\u5bfb\u627e\u771f\u5b9e\u7684 __libc_start_main \u51fd\u6570\u662f\u901a\u8fc7\u8c03\u7528 dlsym \u51fd\u6570\u5b8c\u6210\u7684\u3002"),(0,o.kt)("p",null,"man dlsym \u627e\u5230\u4e86\u5982\u4e0b\u5173\u8054\u4fe1\u606f\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-manual"},'       RTLD_NEXT\n              Find  the  next  occurrence of the desired symbol in the search order after the current object.  This allows one to provide a wrapper around a function in\n              another shared object, so that, for example, the definition of a function in a preloaded shared object (see LD_PRELOAD in ld.so(8)) can  find  and  invoke\n              the  "real" function provided in another shared object (or for that matter, the "next" definition of the function in cases where there are multiple layers\n              of preloading).\n       The _GNU_SOURCE feature test macro must be defined in order to obtain the definitions of RTLD_DEFAULT and RTLD_NEXT from <dlfcn.h>.\n')),(0,o.kt)("p",null,"RTLD_NEXT \u5c06\u4f1a\u8df3\u8fc7\u5f53\u524d\u7684\u5bf9\u8c61\uff0c\u5728\u5176\u540e\u7684\u5bf9\u8c61\u4e2d\u641c\u7d22\u7b26\u53f7\u7684\u4f4d\u7f6e\u3002\u8fd9\u79cd\u884c\u4e3a\u8ba9\u7528\u6237\u80fd\u591f\u5728 preload \u7684\u5171\u4eab\u5e93\u4e2d\u627e\u5230\u5728\u5176\u5b83\u5171\u4eab\u5e93\u4e2d\u63d0\u4f9b\u7684\u7b26\u53f7\u7684\u771f\u5b9e\u5b9a\u4e49\u4f4d\u7f6e\u3002"),(0,o.kt)("p",null,"\u6700\u4e0b\u9762\u7684\u4e00\u884c\u8bf4\u660e\u4e86\u8981\u4f7f\u7528 RTLD_DEFAULT \u548c RTLD_NEXT \u8fd9\u4e24\u4e2a\u5b8f\u9700\u8981\u5728\u5305\u542b dlfcn.h \u4e4b\u524d\u5b9a\u4e49 _GNU_SOURCE \u5b8f\u3002"),(0,o.kt)("h2",{id:"preload-\u5230\u5e95\u662f\u600e\u6837\u5de5\u4f5c\u7684"},"preload \u5230\u5e95\u662f\u600e\u6837\u5de5\u4f5c\u7684\uff1f"),(0,o.kt)("p",null,"\u4e3a\u4e86\u786e\u5b9a preload \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u6211\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'export LD_DEBUG="symbols";   LD_PRELOAD=/home/longyu/chroot_test/libhooker.so ls  > output 2>&1\n')),(0,o.kt)("p",null,"\u4e0a\u9762\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u7684\u542b\u4e49\u53ef\u4ee5\u53c2\u8003 ",(0,o.kt)("a",{parentName:"p",href:"https://blog.csdn.net/Longyu_wlz/article/details/108511931"},"man ld.so \u7684\u7ffb\u8bd1")," \u8fd9\u7bc7\u6587\u7ae0\u3002"),(0,o.kt)("p",null,"\u5728\u8f93\u51fa\u7684 output \u6587\u4ef6\u4e2d\u67e5\u627e __libc_start_main \u7b26\u53f7\u7684\u89e3\u6790\u8fc7\u7a0b\uff0c\u83b7\u53d6\u5230\u4e86\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"     symbol=__libc_start_main;  lookup in file=ls [0]\n     symbol=__libc_start_main;  lookup in file=/home/longyu/chroot_test/libhooker.so [0]\n     \n     symbol=__libc_start_main;  lookup in file=/lib/x86_64-linux-gnu/libselinux.so.1 [0]\n     symbol=__libc_start_main;  lookup in file=/lib/x86_64-linux-gnu/libc.so.6 [0]\n")),(0,o.kt)("p",null,"\u4e0a\u9762\u7684\u4fe1\u606f\u5bf9 __libc_start_main \u7b26\u53f7\u89e3\u6790\u4e86\u4e24\u6b21\uff0c\u7b2c\u4e00\u6b21\u5728 libhooker.so \u4e2d\u627e\u5230\u4e86\u51fd\u6570\u5b9a\u4e49\uff0c\u7b2c\u4e8c\u6b21\u5728 libc \u5e93\u4e2d\u627e\u5230\u4e86\u5b9a\u4e49\u3002"),(0,o.kt)("p",null,"\u67e5\u770b\u5176\u5b83\u7684\u7b26\u53f7\u89e3\u6790\u8fc7\u7a0b\uff0c\u6211\u53d1\u73b0\u5f53\u8bbe\u5b9a\u4e86 PRELOAD \u540e\uff0cPRELOAD \u8bbe\u5b9a\u7684\u52a8\u6001\u5e93\u5c06\u4f1a\u5728\u53ef\u6267\u884c\u7a0b\u5e8f\u5bf9\u8c61\u4e4b\u540e\uff0c\u5176\u5b83\u52a8\u6001\u5e93\u4e4b\u524d\u88ab\u641c\u7d22\uff0c\u8fd9\u5c31\u786e\u4fdd\u4e86\u80fd\u591f\u5148\u5728 PRELOAD \u6307\u5b9a\u7684\u52a8\u6001\u5e93\u4e2d\u627e\u5230 hook \u7684\u7b26\u53f7\uff0c\u4ece\u800c\u8fbe\u6210 hook \u7684\u76ee\u7684\uff0c\u5176\u5b9e\u53ea\u9700\u8981\u901a\u8fc7\u8c03\u6574\u52a8\u6001\u5e93\u641c\u7d22\u987a\u5e8f\u5c31\u80fd\u591f\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u3002"),(0,o.kt)("p",null,"\u540c\u65f6\u5728 libhooker.so \u4e2d\u8c03\u7528 dlsym \u67e5\u627e __libc_start_main \u51fd\u6570\u7684\u771f\u5b9e\u4f4d\u7f6e\u65f6\uff0c\u52a8\u6001\u5e93\u641c\u7d22\u8def\u5f84\u8df3\u8fc7\u4e86\u5f53\u524d\u5bf9\u8c61\uff08libhooker.so\uff09\uff0c\u5728 libc \u5e93\u4e2d\u627e\u5230\u4e86\u771f\u5b9e\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e0e\u4e0a\u6587\u4ece man dlsym \u4e2d\u6458\u5f55\u7684\u4fe1\u606f\u7684\u63cf\u8ff0\u4e00\u81f4\u3002"),(0,o.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,o.kt)("p",null,"\u6211\u6700\u8fd1\u5728\u5199\u535a\u5ba2\u7684\u65f6\u5019\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e4b\u524d\u5df2\u7ecf\u641e\u8fc7\u7684\u95ee\u9898\uff0c\u5f53\u6211\u5c06\u5b83\u8bb0\u5f55\u4e0b\u6765\u65f6\uff0c\u5e38\u5e38\u80fd\u591f\u53d1\u73b0\u65b0\u7684\u95ee\u9898\u70b9\uff0c\u8fd9\u4e9b\u65b0\u7684\u95ee\u9898\u70b9\u53c8\u5f15\u53d1\u4e86\u6211\u7684\u597d\u5947\u5fc3\uff0c\u6700\u7ec8\u6587\u7ae0\u7684\u5185\u5bb9\u4f1a\u8d85\u51fa\u6211\u7684\u9884\u671f\u3002"),(0,o.kt)("p",null,"\u6709\u4e9b\u95ee\u9898\u6211\u4ee5\u524d\u4e5f\u641e\u8fc7\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u53d1\u73b0\u592a\u591a\u7684\u95ee\u9898\uff0c\u5f88\u591a\u77e5\u8bc6\u6211\u4e4b\u524d\u4e5f\u5b66\u4e60\u8fc7\uff0c\u4f46\u662f\u4e5f\u6ca1\u6709\u63d0\u51fa\u4ec0\u4e48\u95ee\u9898\uff0c\u5176\u5b9e\u4ece\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u8bf4\u660e\u6211\u8fd8\u6ca1\u6709\u5b8c\u5168\u638c\u63e1\u3002"),(0,o.kt)("p",null,"\u95ee\u9898\u5c31\u5728\u90a3\u91cc\uff0c\u4e00\u76f4\u90fd\u5728\u90a3\u91cc\uff0c\u4f46\u662f\u4f60\u80fd\u4e0d\u80fd\u53d1\u73b0\u5374\u5f88\u4e0d\u4e00\u5b9a\u3002\u73b0\u5728\u641e\u5f97\u4e1c\u897f\u4e5f\u4e0d\u7b97\u662f\u65b0\u7684\u4e1c\u897f\uff0c\u80fd\u591f\u53d1\u73b0\u65b0\u7684\u95ee\u9898\u5e76\u52a0\u4ee5\u7814\u7a76\u6700\u7ec8\u627e\u5230\u7b54\u6848\uff0c\u7b97\u662f\u6709\u6240\u6210\u957f\u5427\uff01"))}h.isMDXComponent=!0}}]);