"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[4147],{3905:function(e,f,n){n.d(f,{Zo:function(){return d},kt:function(){return k}});var t=n(7294);function r(e,f,n){return f in e?Object.defineProperty(e,f,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[f]=n,e}function a(e,f){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);f&&(t=t.filter((function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var f=1;f<arguments.length;f++){var n=null!=arguments[f]?arguments[f]:{};f%2?a(Object(n),!0).forEach((function(f){r(e,f,n[f])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(f){Object.defineProperty(e,f,Object.getOwnPropertyDescriptor(n,f))}))}return e}function o(e,f){if(null==e)return{};var n,t,r=function(e,f){if(null==e)return{};var n,t,r={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],f.indexOf(n)>=0||(r[n]=e[n]);return r}(e,f);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],f.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=t.createContext({}),i=function(e){var f=t.useContext(c),n=f;return e&&(n="function"==typeof e?e(f):l(l({},f),e)),n},d=function(e){var f=i(e.components);return t.createElement(c.Provider,{value:f},e.children)},p={inlineCode:"code",wrapper:function(e){var f=e.children;return t.createElement(t.Fragment,{},f)}},_=t.forwardRef((function(e,f){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),_=i(n),k=r,s=_["".concat(c,".").concat(k)]||_[k]||p[k]||a;return n?t.createElement(s,l(l({ref:f},d),{},{components:n})):t.createElement(s,l({ref:f},d))}));function k(e,f){var n=arguments,r=f&&f.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=_;var o={};for(var c in f)hasOwnProperty.call(f,c)&&(o[c]=f[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var i=2;i<a;i++)l[i]=n[i];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}_.displayName="MDXCreateElement"},2109:function(e,f,n){n.r(f),n.d(f,{assets:function(){return d},contentTitle:function(){return c},default:function(){return k},frontMatter:function(){return o},metadata:function(){return i},toc:function(){return p}});var t=n(7462),r=n(3366),a=(n(7294),n(3905)),l=["components"],o={},c="\u95ee\u9898\u63cf\u8ff0",i={permalink:"/longyu.github.io/blog/dpdk/dpdk-16.04 rte_kni \u6a21\u5757\u4e0e\u5185\u6838\u5185\u5b58\u6cc4\u9732\u95ee\u9898",editUrl:"https://github.com/longyuwlz/longyu.github.io/blog/dpdk/dpdk-16.04 rte_kni \u6a21\u5757\u4e0e\u5185\u6838\u5185\u5b58\u6cc4\u9732\u95ee\u9898.md",source:"@site/blog/dpdk/dpdk-16.04 rte_kni \u6a21\u5757\u4e0e\u5185\u6838\u5185\u5b58\u6cc4\u9732\u95ee\u9898.md",title:"\u95ee\u9898\u63cf\u8ff0",description:"\u67d0\u8bbe\u5907\u8fd0\u884c dpdk \u7a0b\u5e8f\uff0cfree \u7684\u5185\u5b58\u7a7a\u95f4\u5728\u9010\u6e10\u4e0b\u964d\u3002",date:"2022-06-21T00:32:49.000Z",formattedDate:"2022\u5e746\u670821\u65e5",tags:[],readingTime:7.425,truncated:!1,authors:[],frontMatter:{},prevItem:{title:"dpdk/dpdk-16.04 l2fwd \u6e90\u7801\u5206\u6790",permalink:"/longyu.github.io/blog/dpdk/dpdk-16.04 l2fwd \u6e90\u7801\u5206\u6790"},nextItem:{title:"dpdk/dpdk-16.04 rte_kni \u6a21\u5757\u5206\u6790",permalink:"/longyu.github.io/blog/dpdk/dpdk-16.04 rte_kni \u6a21\u5757\u5206\u6790"}},d={authorsImageUrls:[]},p=[],_={toc:p};function k(e){var f=e.components,n=(0,r.Z)(e,l);return(0,a.kt)("wrapper",(0,t.Z)({},_,n,{components:f,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\u67d0\u8bbe\u5907\u8fd0\u884c dpdk \u7a0b\u5e8f\uff0cfree \u7684\u5185\u5b58\u7a7a\u95f4\u5728\u9010\u6e10\u4e0b\u964d\u3002"),(0,a.kt)("p",null,"\u7b2c\u4e00\u6b21\u67e5\u770b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root]# free -h\ntotal        used        free      shared  buff/cache   available\nMem:           3.6G        1.5G        425M        403M        1.7G        534M\nSwap:            0B          0B          0B\n")),(0,a.kt)("p",null,"\u51e0\u5206\u949f\u540e\u67e5\u770b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root]# free -h\ntotal        used        free      shared  buff/cache   available\nMem:           3.6G        1.2G        425M        403M        1.4G        534M\nSwap:            0B          0B          0B\n")),(0,a.kt)("p",null,"\u6301\u7eed\u89c2\u5bdf\u786e\u5b9a free \u7684\u5185\u5b58\u5728\u3010\u6301\u7eed\u964d\u4f4e\u3011\u3002"),(0,a.kt)("h1",{id:"\u95ee\u9898\u5b9a\u4f4d\u8fc7\u7a0b"},"\u95ee\u9898\u5b9a\u4f4d\u8fc7\u7a0b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4f7f\u7528 top \u67e5\u770b\u7528\u6237\u6001\u7a0b\u5e8f\u7684\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u672a\u53d1\u73b0\u660e\u663e\u5f02\u5e38"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c echo 3 > /proc/sys/vm/drop_caches \u6e05\u9664\u7f13\u5b58\uff0cfree \u7684\u7a7a\u95f4\u4ecd\u65e7\u6ca1\u6709\u589e\u52a0"),(0,a.kt)("li",{parentName:"ol"},"\u89c2\u5bdf /proc/slabinfo \u53d1\u73b0 kmalloc-8192 \u8fd9\u79cd\u7c7b\u578b\u7684 slab \u7a7a\u95f4\u4e00\u76f4\u5728\u589e\u52a0")),(0,a.kt)("p",null,"\u7b2c\u4e00\u6b21\u67e5\u770b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kmalloc-8192      128016 128016   8192    4    8 : tunables    0    0    0 : slabdata  32004  32004      0\n")),(0,a.kt)("p",null,"\u51e0\u5206\u949f\u540e\u67e5\u770b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kmalloc-8192 135760 135760 8192 4 8 : tunables 0 0 0 : slabdata 33940 33940 0\n")),(0,a.kt)("p",null,"\u6000\u7591\u5c31\u662f kmalloc-8192 \u5bfc\u81f4\u7684\u95ee\u9898\u3002"),(0,a.kt)("h1",{id:"\u8ddf\u8e2a-kmalloc-8192-\u7684-alloc-\u4e0e-free-\u8fc7\u7a0b"},"\u8ddf\u8e2a kmalloc-8192 \u7684 alloc \u4e0e free \u8fc7\u7a0b"),(0,a.kt)("p",null,"\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5f00\u542f\u5185\u6838 kmalloc-8192 \u7c7b slab \u5bf9\u8c61\u7684 ",(0,a.kt)("strong",{parentName:"p"},"trace")," \u529f\u80fd\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"echo 1 > /sys/kernel/slab/kmalloc-8192/trace\n")),(0,a.kt)("p",null,"\u51e0\u5341\u79d2\u540e\u67e5\u770b dmesg \u4fe1\u606f\uff0c\u770b\u5230\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"\n[90556.444309] TRACE kmalloc-8192 alloc 0xffff88001a0d8000 inuse=4 fp=0x          (null)\n.........\n[90556.444342] Call Trace:\n[90556.444355]  [<ffffffff826cbd7c>] dump_stack+0x63/0x7f\n[90556.444362]  [<ffffffff826ca454>] alloc_debug_processing+0xb1/0x105\n[90556.444368]  [<ffffffff826ca84a>] __slab_alloc+0x3a2/0x40f\n[90556.444375]  [<ffffffff825a7d4c>] ? kzalloc+0xf/0x11\n[90556.444383]  [<ffffffff826d3792>] ? _raw_spin_unlock_irqrestore+0x1a/0x2d\n[90556.444389]  [<ffffffff8258eb55>] ? pci_conf1_read+0xdb/0xf3\n[90556.444394]  [<ffffffff825a7d4c>] ? kzalloc+0xf/0x11\n[90556.444401]  [<ffffffff82139fad>] __kmalloc+0xf5/0x156\n[90556.444409]  [<ffffffff825c4f0b>] ? eth_mac_addr+0x28/0x28\n[90556.444413]  [<ffffffff825a7d4c>] kzalloc+0xf/0x11\n[90556.444419]  [<ffffffff825ae850>] alloc_netdev_mqs+0x80/0x2d9\n[90556.444425]  [<ffffffff825c5075>] alloc_etherdev_mqs+0x1c/0x1e\n[90556.444463]  [<ffffffffa0058840>] igb_kni_probe+0x64/0xa56 [rte_kni]\n[90556.444471]  [<ffffffff82402fdf>] ? put_device+0x12/0x14\n[90556.444478]  [<ffffffff82305dda>] ? pci_get_dev_by_id+0x71/0x79\n[90556.444483]  [<ffffffff82305e16>] ? pci_get_subsys+0x34/0x3b\n[90556.444507]  [<ffffffffa003567e>] kni_ioctl_create+0x32d/0x5a1 [rte_kni]\n[90556.444531]  [<ffffffffa0035924>] kni_ioctl+0x32/0x3b [rte_kni]\n[90556.444539]  [<ffffffff82156a05>] do_vfs_ioctl+0x351/0x415\n[90556.444546]  [<ffffffff8215e905>] ? __fget+0x66/0x70\n[90556.444552]  [<ffffffff82156b14>] SyS_ioctl+0x4b/0x76\n[90556.444558]  [<ffffffff826d3f89>] system_call_fastpath+0x16/0x1b\n")),(0,a.kt)("p",null,"\u4e0a\u9762\u7684\u4fe1\u606f\u8868\u660e\u6b64\u5904\u7684 alloc \u662f\u5728 kni \u63a5\u53e3\u521d\u59cb\u5316\u65f6\u6267\u884c\u7684\u3002\u540c\u65f6\u4e5f\u770b\u5230\u4e86\u5176\u5b83\u6a21\u5757\u7684\u6253\u5370\uff0creiserfs \u7684\u4e00\u4e2a\u6253\u5370\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"90560.232045] TRACE kmalloc-8192 alloc 0xffff88001a0da000 inuse=4 fp=0x          (null)\n.........\n[90560.232083] Call Trace:\n[90560.232096]  [<ffffffff826cbd7c>] dump_stack+0x63/0x7f\n[90560.232103]  [<ffffffff826ca454>] alloc_debug_processing+0xb1/0x105\n[90560.232109]  [<ffffffff826ca84a>] __slab_alloc+0x3a2/0x40f\n[90560.232117]  [<ffffffff821adca2>] ? fix_nodes+0x188/0x1b1d\n[90560.232124]  [<ffffffff8216bb01>] ? touch_buffer+0xd/0xf\n[90560.232130]  [<ffffffff8216c4eb>] ? __find_get_block+0x1e5/0x1f7\n[90560.232136]  [<ffffffff821adca2>] ? fix_nodes+0x188/0x1b1d\n[90560.232143]  [<ffffffff82139fad>] __kmalloc+0xf5/0x156\n[90560.232149]  [<ffffffff821adca2>] fix_nodes+0x188/0x1b1d\n[90560.232156]  [<ffffffff8210b43b>] ? mark_page_accessed+0xf/0xc5\n[90560.232161]  [<ffffffff8216bb01>] ? touch_buffer+0xd/0xf\n[90560.232167]  [<ffffffff8210b43b>] ? mark_page_accessed+0xf/0xc5\n[90560.232172]  [<ffffffff8216bb01>] ? touch_buffer+0xd/0xf\n[90560.232178]  [<ffffffff821bdd39>] ? journal_mark_dirty+0x62/0x25f\n[90560.232185]  [<ffffffff821b95f1>] reiserfs_insert_item+0x1ba/0x247\n[90560.232196]  [<ffffffff821b1675>] add_save_link+0x170/0x1b8\n[90560.232202]  [<ffffffff826d1ccf>] ? mutex_unlock+0x11/0x13\n[90560.232209]  [<ffffffff821a8a2b>] reiserfs_truncate_file+0x197/0x278\n[90560.232215]  [<ffffffff8210c341>] ? truncate_pagecache+0x4d/0x54\n[90560.232221]  [<ffffffff821abc4a>] reiserfs_setattr+0x2e2/0x311\n[90560.232228]  [<ffffffff8218c405>] ? __dquot_initialize+0x20/0x14c\n[90560.232236]  [<ffffffff820ac766>] ? preempt_count_add+0x75/0x88\n[90560.232241]  [<ffffffff820ac6c2>] ? get_parent_ip+0xd/0x3c\n[90560.232248]  [<ffffffff8215e092>] notify_change+0x1e2/0x2c6\n[90560.232255]  [<ffffffff82147096>] do_truncate+0x64/0x89\n[90560.232262]  [<ffffffff82153f2c>] do_last.isra.46+0x976/0x9a5\n[90560.232269]  [<ffffffff82154172>] path_openat+0x217/0x4ab\n[90560.232275]  [<ffffffff8215547d>] do_filp_open+0x35/0x7a\n[90560.232281]  [<ffffffff826d3765>] ? _raw_spin_unlock+0x12/0x25\n[90560.232287]  [<ffffffff8215ee1f>] ? __alloc_fd+0xe5/0xf4\n[90560.232293]  [<ffffffff8214830f>] do_sys_open+0x6b/0xfa\n[90560.232298]  [<ffffffff821483b7>] SyS_open+0x19/0x1b\n[90560.232303]  [<ffffffff826d3f89>] system_call_fastpath+0x16/0x1b\n[90560.232321] TRACE kmalloc-8192 free 0xffff88001a0da000 inuse=3 fp=0xffff88001a0dc000\n")),(0,a.kt)("p",null,"\u5b83\u4e0e kni \u6a21\u5757 alloc \u7a7a\u95f4\u6253\u5370\u7684\u5806\u6808\u4fe1\u606f\u7684\u533a\u522b\u5728\u4e8e\u6700\u540e\u4e00\u884c\uff0c\u5373 TRACE ",(0,a.kt)("strong",{parentName:"p"},"kmalloc-8192 free 0xffff88001a0da000 ......."),"\uff0c\u6b64\u884c\u8868\u660e\u3010\u91ca\u653e\u3011\u4e86 8192 \u5927\u5c0f\u7684\u7a7a\u95f4\uff0c\u800c kni \u6a21\u5757\u7684\u6253\u5370\u4e2d\u6ca1\u6709\u91ca\u653e\u7684\u6253\u5370\uff0c\u8868\u660e\u53ea\u5728\u521b\u5efa\u3002"),(0,a.kt)("h1",{id:"\u4e3a\u4ec0\u4e48-kni-\u6a21\u5757\u5728\u4e00\u76f4\u521b\u5efa-netdev-\u5462"},"\u4e3a\u4ec0\u4e48 kni \u6a21\u5757\u5728\u4e00\u76f4\u521b\u5efa netdev \u5462\uff1f"),(0,a.kt)("p",null,"\u4f7f\u7528 kni \u6a21\u5757\u7684\u7a0b\u5e8f\u53ea\u5728\u3010\u521d\u59cb\u5316\u3011\u7684\u8fc7\u7a0b\u4e2d\u624d\u4f1a\u521b\u5efa netdev\uff0c\u7a0b\u5e8f\u6b7b\u4ea1\u540e netdev \u4f1a\u91ca\u653e\uff0c\u90a3\u4e0a\u9762\u8bf4\u7684\u6ca1\u6709\u91ca\u653e\u662f\u5426\u662f\u56e0\u4e3a\u7a0b\u5e8f\u4e00\u76f4\u5728\u8fd0\u884c\uff1f"),(0,a.kt)("p",null,"\u67e5\u770b\u7a0b\u5e8f\u72b6\u6001\u53d1\u73b0\uff0c\u7a0b\u5e8f\u7adf\u7136\u5728\u4e00\u76f4\u91cd\u542f\uff0c\u540c\u65f6 kmalloc-8192 \u7684\u6570\u91cf\u5728\u4ee5\u56fa\u5b9a\u7684\u6570\u76ee\u7f13\u6162\u589e\u957f\uff0c\u91cd\u547d\u540d\u7a0b\u5e8f\u540e\u4e0d\u518d\u589e\u957f\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u80fd\u591f\u786e\u5b9a\u662f rte_kni \u5185\u90e8\u6a21\u5757\u5b58\u5728\u5185\u5b58\u6cc4\u9732\u95ee\u9898"),"\u3002"),(0,a.kt)("h1",{id:"rte_kniko-\u4ee3\u7801\u5206\u6790"},"rte_kni.ko \u4ee3\u7801\u5206\u6790"),(0,a.kt)("p",null,"\u9605\u8bfb rte_kni.ko \u6e90\u7801\u53d1\u73b0\uff0c\u5728 ",(0,a.kt)("strong",{parentName:"p"},"igb_kni_probe")," \u51fd\u6570\u4e2d\u4f1a\u8c03\u7528 ",(0,a.kt)("strong",{parentName:"p"},"alloc_etherdev_mq")," \u521b\u5efa\u4e00\u4e2a ",(0,a.kt)("strong",{parentName:"p"},"netdev"),"\uff0c\u6b64\u5916 ",(0,a.kt)("strong",{parentName:"p"},"kni_ioctl_create")," \u4e2d\u4e5f\u4f1a\u521b\u5efa\u4e00\u4e2a ",(0,a.kt)("strong",{parentName:"p"},"netdev"),"\uff0c\u800c\u5728\u3010\u91ca\u653e\u3011\u903b\u8f91\u4e2d\uff0c",(0,a.kt)("strong",{parentName:"p"},"kni_dev_remove")," \u4e2d\u53ea\u91ca\u653e\u4e86 ",(0,a.kt)("strong",{parentName:"p"},"kni_ioctl_create"),"  \u4e2d\u521b\u5efa\u7684 ",(0,a.kt)("strong",{parentName:"p"},"netdev"),"\uff0c\u3010\u6ca1\u6709\u91ca\u653e\u3011 e1000\u3001igb\u3001ixgbe xxx_kni_probe \u4e2d\u521b\u5efa\u7684 netdev \u7ed3\u6784\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u9732\u3002"),(0,a.kt)("h1",{id:"\u89e3\u51b3\u65b9\u6848"},"\u89e3\u51b3\u65b9\u6848"),(0,a.kt)("p",null,"\u5728 e1000\u3001igb\u3001ixgbe \u7684 xxx_kni_probe \u4e2d\u521b\u5efa\u7684 netdev \u7ed3\u6784\u4f1a\u88ab\u586b\u5145\u5230 kni_dev \u7ed3\u6784\u7684 ",(0,a.kt)("strong",{parentName:"p"},"lad_dev")," \u5b57\u6bb5\u4e2d\uff0c\u53ea\u9700\u8981\u5728 kni_dev_remove \u51fd\u6570\u4e2d\u5224\u65ad lad_dev \u5b57\u6bb5\u662f\u5426\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u5219\u8c03\u7528 free_netdev \u91ca\u653e\u5373\u53ef\u3002"),(0,a.kt)("p",null,"\u4fee\u6539\u540e\u7684 kni_dev_remove \u51fd\u6570\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},"static int\nkni_dev_remove(struct kni_dev *dev)\n{\n    if (!dev)\n        return -ENODEV;\n    .........\n    if (dev->lad_dev) {\n        free_netdev(dev->lad_dev);\n    }\n\n    if (dev->net_dev) {\n        unregister_netdev(dev->net_dev);\n        free_netdev(dev->net_dev);\n    }\n\n    return 0;\n}\n")),(0,a.kt)("h1",{id:"\u9a8c\u8bc1\u65b9\u6848"},"\u9a8c\u8bc1\u65b9\u6848"),(0,a.kt)("p",null,"\u4f7f\u7528 ",(0,a.kt)("strong",{parentName:"p"},"ftrace")," \u8ddf\u8e2a",(0,a.kt)("strong",{parentName:"p"},"\u5185\u6838\u51fd\u6570\u8c03\u7528"),"\u6765\u9a8c\u8bc1\u4fee\u6539\u6709\u6548\uff0c\u4f7f\u7528 ftrace \u8ddf\u8e2a kni \u7a0b\u5e8f\u521d\u59cb\u5316\u65f6\u8c03\u7528 alloc_netdev_mqs \u4ee5\u53ca\u6b7b\u4ea1\u65f6\u8c03\u7528 free_netdev \u7684\u8fc7\u7a0b\u6765\u9a8c\u8bc1\u95ee\u9898\u5f97\u5230\u89e3\u51b3\u3002"),(0,a.kt)("p",null,"kni \u7a0b\u5e8f\u8fd0\u884c\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'[root]# ./kni  -- -p0x3 --config="(0,0,1),(1,1,1)"\n')),(0,a.kt)("p",null,"ftrace \u8ddf\u8e2a\u5230 alloc_netdev_mqs \u51fd\u6570\u8c03\u7528\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# tracer: function\n#\n# entries-in-buffer/entries-written: 4/4   #P:4\n#\n#                              _-----=> irqs-off\n#                             / _----=> need-resched\n#                            | / _---=> hardirq/softirq\n#                            || / _--=> preempt-depth\n#                            ||| /     delay\n#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION\n#              | |       |   ||||       |         |\n             kni-11436 [000] ....  1906.033365: alloc_netdev_mqs <-kni_ioctl_create\n             kni-11436 [000] ....  1906.033435: alloc_netdev_mqs <-alloc_etherdev_mqs\n             kni-11436 [000] ....  1906.220368: alloc_netdev_mqs <-kni_ioctl_create\n             kni-11436 [000] ....  1906.220440: alloc_netdev_mqs <-alloc_etherdev_mqs\n\n")),(0,a.kt)("p",null,"\u6740\u6b7b kni \u7a0b\u5e8f\u540e\uff0cftrace \u8ddf\u8e2a\u5230 free_netdev \u8c03\u7528\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"}," Develop>cat ./trace\n# tracer: function\n#\n# entries-in-buffer/entries-written: 2/2   #P:4\n#\n#                              _-----=> irqs-off\n#                             / _----=> need-resched\n#                            | / _---=> hardirq/softirq\n#                            || / _--=> preempt-depth\n#                            ||| /     delay\n#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION\n#              | |       |   ||||       |         |\n             kni-11436 [000] ....  1990.960338: free_netdev <-kni_dev_remove\n             kni-11436 [000] ....  1990.986674: free_netdev <-kni_dev_remove\n")),(0,a.kt)("p",null,"\u80fd\u591f\u770b\u5230\u8fd9\u91cc\u7533\u8bf7\u4e86\u56db\u6b21\uff0c\u4f46\u662f\u53ea\u91ca\u653e\u4e86\u4e24\u6b21\uff0c\u6cc4\u9732\u4e86\u4e24\u4e2a netdev \u7ed3\u6784\uff08\u6bcf\u4e2a\u53e3\u6cc4\u9732\u4e00\u4e2a\uff09\uff0c\u7b26\u5408\u9884\u671f\u3002"),(0,a.kt)("p",null,"\u91cd\u65b0\u52a0\u8f7d\u4fee\u6539\u540e\u7684 rte_kni.ko \u6587\u4ef6\u540e\u6d4b\u8bd5\u8bb0\u5f55\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,"ftrace \u8ddf\u8e2a\u5230 alloc_netdev_mqs \u51fd\u6570\u8c03\u7528\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"}," \n Develop>cat ./trace\n# tracer: function\n#\n# entries-in-buffer/entries-written: 8/8   #P:4\n#\n#                              _-----=> irqs-off\n#                             / _----=> need-resched\n#                            | / _---=> hardirq/softirq\n#                            || / _--=> preempt-depth\n#                            ||| /     delay\n#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION\n#              | |       |   ||||       |         |\n             kni-13861 [000] ....  2951.871499: alloc_netdev_mqs <-kni_ioctl_create\n             kni-13861 [000] ....  2951.871571: alloc_netdev_mqs <-alloc_etherdev_mqs\n             kni-13861 [000] ....  2952.059302: alloc_netdev_mqs <-kni_ioctl_create\n             kni-13861 [000] ....  2952.059372: alloc_netdev_mqs <-alloc_etherdev_mqs\n\n")),(0,a.kt)("p",null,"\u6740\u6389 kni \u7a0b\u5e8f\u540e\uff0cftrace \u8ddf\u8e2a\u5230 free_netdev \u8c03\u7528\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# tracer: function\n#\n# entries-in-buffer/entries-written: 4/4   #P:4\n#\n#                              _-----=> irqs-off\n#                             / _----=> need-resched\n#                            | / _---=> hardirq/softirq\n#                            || / _--=> preempt-depth\n#                            ||| /     delay\n#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION\n#              | |       |   ||||       |         |\n             kni-13861 [000] ....  3000.154817: free_netdev <-kni_dev_remove\n             kni-13861 [000] ....  3000.165235: free_netdev <-kni_dev_remove\n             kni-13861 [000] ....  3000.181801: free_netdev <-kni_dev_remove\n             kni-13861 [000] ....  3000.190228: free_netdev <-kni_dev_remove\n")),(0,a.kt)("p",null,"\u4fee\u590d\u540e\u7533\u8bf7\u4e86\u56db\u6b21\uff0c\u91ca\u653e\u4e86\u56db\u6b21\uff0c\u7b26\u5408\u9884\u671f\u3002"),(0,a.kt)("h1",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,a.kt)("p",null,"\u524d\u671f\u5df2\u7ecf\u89e3\u51b3\u8fc7\u4e00\u4e9b rte_kni.ko \u6a21\u5757\u7684\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u6b21\u66b4\u9732\u51fa\u7684\u95ee\u9898\u8868\u660e\u5176\u4e2d\u4ecd\u65e7\u6f5c\u85cf\u7740\u4e00\u4e9b\u95ee\u9898\u3002"),(0,a.kt)("p",null,"\u9ad8\u7248\u672c\u7684\u8d8b\u52bf\u662f\u5148\u3010\u5265\u79bb\u3011 rte_kni.ko \u6a21\u5757\u7684 ethtool \u529f\u80fd\uff0c\u6700\u7ec8\u3010\u5b8c\u5168\u629b\u5f03\u3011\uff0c\u8fd9\u662f\u6b63\u786e\u7684\u65b9\u5411\u3002"),(0,a.kt)("p",null,"rte_kni.ko \u6a21\u5757\u7684 ethtool \u529f\u80fd\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u3010\u8fc7\u6e21\u529f\u80fd\u3011\uff0c\u3010\u7a33\u5b9a\u6027\u582a\u5fe7\u3011\uff0c\u6211\u4eec\u4e5f\u5e94\u5f53\u8ffd\u968f\u6f6e\u6d41\u5f03\u7528 rte_kni.ko \u7684 ethtool \u529f\u80fd\u3002"))}k.isMDXComponent=!0}}]);