"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[4254],{3905:function(e,t,p){p.d(t,{Zo:function(){return _},kt:function(){return u}});var o=p(7294);function n(e,t,p){return t in e?Object.defineProperty(e,t,{value:p,enumerable:!0,configurable:!0,writable:!0}):e[t]=p,e}function r(e,t){var p=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),p.push.apply(p,o)}return p}function m(e){for(var t=1;t<arguments.length;t++){var p=null!=arguments[t]?arguments[t]:{};t%2?r(Object(p),!0).forEach((function(t){n(e,t,p[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(p)):r(Object(p)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(p,t))}))}return e}function a(e,t){if(null==e)return{};var p,o,n=function(e,t){if(null==e)return{};var p,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)p=r[o],t.indexOf(p)>=0||(n[p]=e[p]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)p=r[o],t.indexOf(p)>=0||Object.prototype.propertyIsEnumerable.call(e,p)&&(n[p]=e[p])}return n}var l=o.createContext({}),s=function(e){var t=o.useContext(l),p=t;return e&&(p="function"==typeof e?e(t):m(m({},t),e)),p},_=function(e){var t=s(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},i=o.forwardRef((function(e,t){var p=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,_=a(e,["components","mdxType","originalType","parentName"]),i=s(p),u=n,c=i["".concat(l,".").concat(u)]||i[u]||d[u]||r;return p?o.createElement(c,m(m({ref:t},_),{},{components:p})):o.createElement(c,m({ref:t},_))}));function u(e,t){var p=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=p.length,m=new Array(r);m[0]=i;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:n,m[1]=a;for(var s=2;s<r;s++)m[s]=p[s];return o.createElement.apply(null,m)}return o.createElement.apply(null,p)}i.displayName="MDXCreateElement"},1920:function(e,t,p){p.r(t),p.d(t,{assets:function(){return _},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return a},metadata:function(){return s},toc:function(){return d}});var o=p(7462),n=p(3366),r=(p(7294),p(3905)),m=["components"],a={},l="dpdk mempool_ops",s={permalink:"/longyu.github.io/blog/dpdk/\u4ee5 rte_mempool_ops_table \u4e3a\u4f8b\u63cf\u8ff0 dpdk \u7a0b\u5e8f\u5e93\u94fe\u63a5\u987a\u5e8f\u5bf9\u7a0b\u5e8f\u6267\u884c\u7684\u5f71\u54cd",editUrl:"https://github.com/longyuwlz/longyu.github.io/blog/dpdk/\u4ee5 rte_mempool_ops_table \u4e3a\u4f8b\u63cf\u8ff0 dpdk \u7a0b\u5e8f\u5e93\u94fe\u63a5\u987a\u5e8f\u5bf9\u7a0b\u5e8f\u6267\u884c\u7684\u5f71\u54cd.md",source:"@site/blog/dpdk/\u4ee5 rte_mempool_ops_table \u4e3a\u4f8b\u63cf\u8ff0 dpdk \u7a0b\u5e8f\u5e93\u94fe\u63a5\u987a\u5e8f\u5bf9\u7a0b\u5e8f\u6267\u884c\u7684\u5f71\u54cd.md",title:"dpdk mempool_ops",description:"dpdk mempool_ops \u662f\u5bf9\u65e7\u7248 mempool \u4ee3\u7801\u7684\u62bd\u8c61\uff0c\u5728 dpdk-16.07 \u4e2d\u88ab\u5f15\u5165\u3002",date:"2022-06-21T00:32:49.000Z",formattedDate:"2022\u5e746\u670821\u65e5",tags:[],readingTime:12.455,truncated:!1,authors:[],frontMatter:{},prevItem:{title:"dpdk/\u4ee5 ixgbe pmd \u9a71\u52a8\u4e3a\u4f8b\u7814\u7a76 dpdk pmd \u9a71\u52a8\u4e2d\u6ce8\u518c\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\u5e76\u4f7f\u80fd\u4e2d\u65ad\u7684\u8fc7\u7a0b",permalink:"/longyu.github.io/blog/dpdk/\u4ee5 ixgbe pmd \u9a71\u52a8\u4e3a\u4f8b\u7814\u7a76 dpdk pmd \u9a71\u52a8\u4e2d\u6ce8\u518c\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\u5e76\u4f7f\u80fd\u4e2d\u65ad\u7684\u8fc7\u7a0b"},nextItem:{title:"\u73af\u5883\u4ecb\u7ecd",permalink:"/longyu.github.io/blog/dpdk/\u4f7f\u7528\u5185\u6838\u9a71\u52a8\u4e0a\u624b x710 flow directory \u529f\u80fd"}},_={authorsImageUrls:[]},d=[{value:"\u7b2c\u4e00\u79cd\u5e03\u5c40\u65b9\u5f0f\u2014\u2014dpdk \u5185\u90e8\u793a\u4f8b\u7a0b\u5e8f\u7684\u5e03\u5c40",id:"\u7b2c\u4e00\u79cd\u5e03\u5c40\u65b9\u5f0fdpdk-\u5185\u90e8\u793a\u4f8b\u7a0b\u5e8f\u7684\u5e03\u5c40",level:2},{value:"\u4f7f\u7528 libdpdk.a \u94fe\u63a5\u5916\u90e8\u7a0b\u5e8f\u65f6\u7684\u5e03\u5c40\u60c5\u51b5",id:"\u4f7f\u7528-libdpdka-\u94fe\u63a5\u5916\u90e8\u7a0b\u5e8f\u65f6\u7684\u5e03\u5c40\u60c5\u51b5",level:2}],i={toc:d};function u(e){var t=e.components,p=(0,n.Z)(e,m);return(0,r.kt)("wrapper",(0,o.Z)({},i,p,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"dpdk mempool_ops \u662f\u5bf9\u65e7\u7248 mempool \u4ee3\u7801\u7684\u62bd\u8c61\uff0c\u5728 ",(0,r.kt)("strong",{parentName:"p"},"dpdk-16.07")," \u4e2d\u88ab\u5f15\u5165\u3002"),(0,r.kt)("p",null,"\u8001\u7248\u672c\u5728\u521b\u5efa mempool \u65f6\u4f1a\u521b\u5efa\u4e00\u4e2a\u5185\u90e8\u7684 ",(0,r.kt)("strong",{parentName:"p"},"ring")," \u6765\u5b8c\u6210",(0,r.kt)("strong",{parentName:"p"},"\u5165\u961f\u4e0e\u51fa\u961f\u7684\u64cd\u4f5c"),"\uff0c\u5e95\u5c42\u533a\u5206\u4e86",(0,r.kt)("strong",{parentName:"p"},"\u591a\u751f\u4ea7\u8005\u3001\u591a\u6d88\u8d39\u8005\uff0c\u5355\u751f\u4ea7\u8005\u3001\u5355\u6d88\u8d39\u8005"),"\u6a21\u578b\u3002"),(0,r.kt)("p",null,"\u8001\u7248\u672c mempool \u521b\u5efa\u65f6\u4f1a",(0,r.kt)("strong",{parentName:"p"},"\u5c06\u6240\u6709\u7684\u5143\u7d20\u9884\u5148 enqueue \u5230 ring \u4e2d"),"\uff0c\u5e76\u5bf9",(0,r.kt)("strong",{parentName:"p"},"\u6bcf\u4e2a"),"\u5143\u7d20\u6267\u884c",(0,r.kt)("strong",{parentName:"p"},"\u521d\u59cb\u5316"),"\u64cd\u4f5c\uff0c\u8fd9\u90e8\u5206\u4ee3\u7801\u9690\u542b\u5728 mempool \u7684\u5185\u90e8\u5b9e\u73b0\u4e2d\u3002\u7528\u6237\u4ece mempool \u4e2d\u7533\u8bf7\u3001\u91ca\u653e mem\uff0c\u6700\u5e95\u5c42\u662f\u901a\u8fc7 ",(0,r.kt)("strong",{parentName:"p"},"dequeue\u3001enqueue ring")," \u6765\u5b9e\u73b0\u7684\u3002"),(0,r.kt)("p",null,"\u968f\u7740 dpdk \u652f\u6301\u573a\u666f\u7684\u62d3\u5bbd\uff0c\u5728 mempool \u5e95\u5c42\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"ring")," \u8fd9\u4e00\u79cd\u6570\u636e\u7ed3\u6784\u6765\u63a7\u5236 mem \u7684\u7533\u8bf7\u4e0e\u91ca\u653e",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u80fd\u6ee1\u8db3\u6240\u6709\u573a\u666f\u7684\u4f7f\u7528\u9700\u6c42"),"\u3002"),(0,r.kt)("p",null,"\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u4e00\u4e9b\u5916\u90e8\u7684\u5185\u5b58\u5b50\u7cfb\u7edf\u5728\u4f7f\u7528 DPDK \u65f6\u9700\u8981\u5bf9 mempool \u5e95\u5c42\u7684\u5165\u961f\u4e0e\u51fa\u961f\u7684\u884c\u4e3a\u8fdb\u884c\u5b9a\u5236\u5316\u5f00\u53d1\uff0c\u8fd9\u610f\u5473\u7740\u5e95\u5c42\u7684\u8fd9\u90e8\u5206\u529f\u80fd\u9700\u8981\u5411\u5916\u90e8\u5f00\u653e\uff0c\u5fc5\u987b\u80fd\u591f\u8ba9\u7a0b\u5e8f\u6ce8\u518c\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5165\u961f\u3001\u51fa\u961f\u65b9\u6cd5\u53ca\u5173\u8054\u6570\u636e\u7ed3\u6784\uff0crte_mempool_ops \u5c31\u662f\u8fd9\u79cd\u529f\u80fd\u7684\u5177\u4f53\u5b9e\u73b0\u3002"),(0,r.kt)("h1",{id:"rte_mempool_ops-\u7684\u62bd\u8c61"},"rte_mempool_ops \u7684\u62bd\u8c61"),(0,r.kt)("p",null,"16.07 \u4e2d rte_mempool_ops \u7684\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"struct rte_mempool_ops {\n       char name[RTE_MEMPOOL_OPS_NAMESIZE]; /**< Name of mempool ops struct. */\n       rte_mempool_alloc_t alloc;       /**< Allocate private data. */\n       rte_mempool_free_t free;         /**< Free the external pool. */\n       rte_mempool_enqueue_t enqueue;   /**< Enqueue an object. */\n       rte_mempool_dequeue_t dequeue;   /**< Dequeue an object. */\n       rte_mempool_get_count get_count; /**< Get qty of available objs. */\n} __rte_cache_aligned;\n")),(0,r.kt)("p",null,"name \u7528\u4e8e",(0,r.kt)("strong",{parentName:"p"},"\u552f\u4e00\u6807\u8bc6"),"\u6bcf\u4e2a mempool_ops\uff0calloc \u7528\u4e8e mempool_ops ",(0,r.kt)("strong",{parentName:"p"},"\u5185\u90e8\u6570\u636e\u7ed3\u6784\u7684\u521b\u5efa"),"\uff0cfree \u7528\u4e8e mempool_ops ",(0,r.kt)("strong",{parentName:"p"},"\u5185\u90e8\u6570\u636e\u7ed3\u6784\u7684\u9500\u6bc1"),"\uff0cenqueue \u8d1f\u8d23\u5165\u961f\u5217\uff0cdequeue \u8d1f\u8d23\u51fa\u961f\u5217\uff0cget_count \u7528\u4ee5\u83b7\u53d6\u5f53\u524d\u53ef\u7528\u7684\u5bf9\u8c61\u6570\u91cf\u3002"),(0,r.kt)("p",null,"\u603b\u7ed3\u8d77\u6765\u6709\u5982\u4e0b\u4e09\u90e8\u5206\u529f\u80fd\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"mempool_ops \u5185\u90e8\u6570\u636e\u7ed3\u6784\u7684\u521b\u5efa\u4e0e\u91ca\u653e\u529f\u80fd"),(0,r.kt)("li",{parentName:"ol"},"mempool_ops \u5bf9\u8c61\u7684\u5165\u961f\u4e0e\u51fa\u961f\u529f\u80fd"),(0,r.kt)("li",{parentName:"ol"},"mempool_ops \u5e95\u5c42\u53ef\u7528\u5bf9\u8c61\u6570\u91cf\u7684\u67e5\u8be2\u529f\u80fd")),(0,r.kt)("h1",{id:"\u4ee5-ring-\u63cf\u8ff0\u5728-mempool_ops-\u6846\u67b6\u4e0b-mempool_ops-\u7684\u4f7f\u7528\u8fc7\u7a0b"},"\u4ee5 ring \u63cf\u8ff0\u5728 mempool_ops \u6846\u67b6\u4e0b mempool_ops \u7684\u4f7f\u7528\u8fc7\u7a0b"),(0,r.kt)("p",null,"\u6bcf\u4e00\u4e2a mempool_ops \u9700\u8981\u5b9e\u4f8b\u5316\u4e00\u4e2a rte_mempool_ops \u7ed3\u6784\u5e76\u5c06\u6b64\u7ed3\u6784\u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\uff0c\u5bf9\u5355\u751f\u4ea7\u8005\u4e0e\u5355\u6d88\u8d39\u8005\u8fd9\u79cd\u57fa\u4e8e ring \u7684\u6a21\u578b\u800c\u8a00\u5b83\u5b9e\u4f8b\u5316\u7684 rte_mempool_ops \u5b9a\u4e49\u5982\u4e0b\uff1b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'static const struct rte_mempool_ops ops_sp_sc = {\n       .name = "ring_sp_sc",\n       .alloc = common_ring_alloc,\n       .free = common_ring_free,\n       .enqueue = common_ring_sp_enqueue,\n       .dequeue = common_ring_sc_dequeue,\n       .get_count = common_ring_get_count,\n};\n')),(0,r.kt)("p",null,"\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u6ce8\u518c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"MEMPOOL_REGISTER_OPS(ops_sp_sc);\n")),(0,r.kt)("p",null,"MEMPOOL_REGISTER_OPS \u901a\u8fc7 gcc \u7684\u6784\u9020\u51fd\u6570\u58f0\u660e\uff0c\u8c03\u7528 rte_mempool_register_ops \u51fd\u6570\u5c06 ops_sp_sc mempool_ops \u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\u3002"),(0,r.kt)("p",null,"rte_mempool_register_ops \u5728\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u5185\u5bb9\u68c0\u67e5\u540e\uff0c\u5c06 ops_sp_sc \u6ce8\u518c\u5230 rte_mempool_ops_table \u8868\u4e2d\uff08",(0,r.kt)("strong",{parentName:"p"},"\u5728\u83b7\u53d6\u5230\u4e92\u65a5\u9501\u7684\u524d\u63d0\u4e0b\uff0c\u4fdd\u8bc1\u5bf9 rte_mempool_ops_table \u7684\u4e92\u65a5\u8bbf\u95ee"),"\uff09\u3002"),(0,r.kt)("p",null,"\u6210\u529f\u540e\uff0c\u4f1a\u83b7\u53d6\u5230 ",(0,r.kt)("strong",{parentName:"p"},"ops_index")," \uff08",(0,r.kt)("strong",{parentName:"p"},"ops \u5728 rte_mempool_ops_table \u4e2d\u7684\u4e0b\u6807"),"\uff09\uff0c\u8fd9\u4e2a\u4e0b\u6807\u4f1a\u88ab\u4fdd\u5b58\u5230 ",(0,r.kt)("strong",{parentName:"p"},"mempool")," \u7ed3\u6784\u7684 ",(0,r.kt)("strong",{parentName:"p"},"ops_index")," \u5b57\u6bb5\u4e2d\uff08",(0,r.kt)("strong",{parentName:"p"},"\u901a\u8fc7\u8c03\u7528 rte_mempool_set_ops_byname \u51fd\u6570\u8bbe\u7f6e"),"\uff09\u3002"),(0,r.kt)("p",null,"\u5176\u529f\u80fd\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"       /**\n        * Index into rte_mempool_ops_table array of mempool ops\n        * structs, which contain callback function pointers.\n        * We're using an index here rather than pointers to the callbacks\n        * to facilitate any secondary processes that may want to use\n        * this mempool.\n        */\n       int32_t ops_index;\n")),(0,r.kt)("h1",{id:"mempool_ops-\u88ab\u8c03\u7528\u7684\u5730\u65b9"},"mempool_ops \u88ab\u8c03\u7528\u7684\u5730\u65b9"),(0,r.kt)("p",null,"\u4f7f\u7528 mempool_ops \u65f6\uff0c\u901a\u8fc7 rte_mempool_get \u51fd\u6570\u51fa\u961f\u5217\u8fc7\u7a0b\u51fd\u6570\u8c03\u7528\u56fe\u793a\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img-blog.csdnimg.cn/20210615153814667.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xvbmd5dV93bHo=,size_16,color_FFFFFF,t_70",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"}),"\n\u5f53 cache \u4e2d\u6ca1\u6709\u7f13\u5b58\u65f6\uff0c\u5c31\u8c03\u7528\u5e95\u5c42 ops \u4e2d\u6ce8\u518c\u7684 dequeue \u63a5\u53e3\u6765\u5b8c\u6210\u3002"),(0,r.kt)("h1",{id:"dpdk-1607-\u4e2d\u76f8\u5173-git-commit"},"dpdk-16.07 \u4e2d\u76f8\u5173 git commit"),(0,r.kt)("p",null,"\u76f8\u5173\u7684 commit \u4fe1\u606f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"commit 449c49b93a6b87506c7bb07468e82b539efddca3\nAuthor: David Hunt <david.hunt@intel.com>\nDate:   Wed Jun 22 10:27:27 2016 +0100\n\n    mempool: support handler operations\n    \n    Until now, the objects stored in a mempool were internally stored in a\n    ring. This patch introduces the possibility to register external handlers\n    replacing the ring.\n    \n    The default behavior remains unchanged, but calling the new function\n    rte_mempool_set_ops_byname() right after rte_mempool_create_empty() allows\n    the user to change the handler that will be used when populating\n    the mempool.\n    \n    This patch also adds a set of default ops (function callbacks) based\n    on rte_ring.\n    \n    Signed-off-by: David Hunt <david.hunt@intel.com>\n    Signed-off-by: Olivier Matz <olivier.matz@6wind.com>\n    Acked-by: Shreyansh Jain <shreyansh.jain@nxp.com>\n    Acked-by: Olivier Matz <olivier.matz@6wind.com>\n")),(0,r.kt)("p",null,"\u6b64\u63a5\u53e3\u5728\u540e\u9762\u7684\u7248\u672c\u6709\u4e00\u4e9b\u4f18\u5316\uff0c\u4f46\u662f\u4e3b\u4f53\u6846\u67b6\u6ca1\u6709\u5927\u7684\u53d8\u52a8\u3002\u6ce8\u518c\u4e00\u4e2a\u81ea\u5df1\u7684 mempool_ops \u7684\u5b9e\u4f8b",(0,r.kt)("strong",{parentName:"p"},"\u53ef\u4ee5\u53c2\u7167 vpp  dpdk_plugins \u4e2d\u7684\u5b9e\u73b0\u4ee3\u7801"),"\u3002"),(0,r.kt)("h1",{id:"1911-\u4e2d-dpdk-\u7a0b\u5e8f\u521d\u59cb\u5316\u540e-rte_mempool_ops_table-\u7684\u5e03\u5c40\u60c5\u51b5"},"19.11 \u4e2d dpdk \u7a0b\u5e8f\u521d\u59cb\u5316\u540e rte_mempool_ops_table \u7684\u5e03\u5c40\u60c5\u51b5"),(0,r.kt)("p",null,"dpdk-19.11 \u4e2d dpdk \u7a0b\u5e8f\u521d\u59cb\u5316\u540e rte_mempool_ops_table \u7ed3\u6784\u793a\u4f8b\u5982\u4e0b\u56fe\uff1a\n",(0,r.kt)("img",{parentName:"p",src:"https://img-blog.csdnimg.cn/20210615103819679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xvbmd5dV93bHo=,size_16,color_FFFFFF,t_70",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"}),"\n\u4e0a\u56fe\u4e2d\uff0crte_mempool_ops_table \u7684\u4e0d\u540c\u8868\u9879\u6307\u5411\u4e0d\u540c\u7684 mempool_ops \u5b9e\u4f8b\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528\u9759\u6001\u5e93\u65f6\uff0c\u94fe\u63a5\u4e0d\u540c ",(0,r.kt)("strong",{parentName:"p"},"mempool_ops")," \u6240\u5728\u5e93\u7684",(0,r.kt)("strong",{parentName:"p"},"\u987a\u5e8f\u51b3\u5b9a\u4e86")," ",(0,r.kt)("strong",{parentName:"p"},"rte_mempool_ops_table")," \u4e2d\u4e0d\u540c ",(0,r.kt)("strong",{parentName:"p"},"mempool_ops")," \u7684",(0,r.kt)("strong",{parentName:"p"},"\u5e03\u5c40"),"\u3002\u5982\u679c dpdk primary \u8fdb\u7a0b\u4e0e secondary \u8fdb\u7a0b",(0,r.kt)("strong",{parentName:"p"},"\u94fe\u63a5"),"\u4e0d\u540c mempool_ops \u6784\u9020\u51fd\u6570\u6240\u5728",(0,r.kt)("strong",{parentName:"p"},"\u5e93\u7684\u987a\u5e8f\u4e0d\u540c"),"\uff0c\u5219\u4f1a\u6709",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u540c\u7684")," rte_mempool_ops_table ",(0,r.kt)("strong",{parentName:"p"},"\u5e03\u5c40"),"\uff0c\u5f53 mempool \u9700\u8981\u5728 primary \u4e0e secondary \u4e2d\u5171\u4eab\u65f6\uff0c\u4e0d\u540c\u7684 rte_mempool_ops_table \u5e03\u5c40\u5c31\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u95ee\u9898\uff01"),(0,r.kt)("h2",{id:"\u7b2c\u4e00\u79cd\u5e03\u5c40\u65b9\u5f0fdpdk-\u5185\u90e8\u793a\u4f8b\u7a0b\u5e8f\u7684\u5e03\u5c40"},"\u7b2c\u4e00\u79cd\u5e03\u5c40\u65b9\u5f0f\u2014\u2014dpdk \u5185\u90e8\u793a\u4f8b\u7a0b\u5e8f\u7684\u5e03\u5c40"),(0,r.kt)("p",null,"\u8fd9\u91cc\u4ee5 dpdk-pdump \u4e3a\u4ee3\u8868\uff0c\u5176\u94fe\u63a5\u53c2\u6570\u53ef\u4ee5\u67e5\u770b\u5982\u4e0b\u6587\u4ef6\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"x86_64-native-linuxapp-gcc/build/app/pdump/.dpdk-pdump.cmd\n")),(0,r.kt)("p",null,"\u6b64\u79cd\u65b9\u5f0f\u4e0b rte_mempool_ops_table \u7684\u524d 4 \u4e2a\u5143\u7d20\u5e03\u5c40\u60c5\u51b5\u89c1\u4e0b\u56fe\uff1a",(0,r.kt)("img",{parentName:"p",src:"https://img-blog.csdnimg.cn/20210615110317285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xvbmd5dV93bHo=,size_16,color_FFFFFF,t_70",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"}),"\n\u53ef\u4ee5\u770b\u5230\uff0cmp_mc \u8fd9\u79cd\u57fa\u4e8e ring \u7684\u591a\u751f\u4ea7\u8005\u4e0e\u591a\u6d88\u8d39\u8005\u5360\u636e rte_mempool_ops_table \u8868\u4e2d ops \u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u8868\u9879\uff0cexamples \u76ee\u5f55\u4e0b\u7684 dpdk primary \u7a0b\u5e8f\u4e2d rte_mempool_ops_table \u8868\u7684\u5e03\u5c40\u4e0e app \u4e0b\u7684\u7a0b\u5e8f\u5e03\u5c40\u4e00\u81f4\u3002"),(0,r.kt)("h2",{id:"\u4f7f\u7528-libdpdka-\u94fe\u63a5\u5916\u90e8\u7a0b\u5e8f\u65f6\u7684\u5e03\u5c40\u60c5\u51b5"},"\u4f7f\u7528 libdpdk.a \u94fe\u63a5\u5916\u90e8\u7a0b\u5e8f\u65f6\u7684\u5e03\u5c40\u60c5\u51b5"),(0,r.kt)("p",null,"libdpdk.a \u4e2d mempool \u76f8\u5173\u9759\u6001\u5e93\u7684\u94fe\u63a5\u987a\u5e8f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat ./x86_64-native-linux-gcc/lib/libdpdk.a\nGROUP (...librte_mempool_bucket.a librte_mempool_dpaa2.a librte_mempool_octeontx.a librte_mempool_octeontx2.a librte_mempool_ring.a librte_mempool_stack.a ...)\n")),(0,r.kt)("p",null,"\u6b64\u65f6\u7a0b\u5e8f\u8fd0\u884c\u540e\uff0crte_mempool_ops_table \u8868\u4e2d mempool_ops \u7684\u5e03\u5c40\u60c5\u51b5\u89c1\u4e0b\u56fe\uff1a\n",(0,r.kt)("img",{parentName:"p",src:"https://img-blog.csdnimg.cn/20210615111522370.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xvbmd5dV93bHo=,size_16,color_FFFFFF,t_70",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"}),"\n\u53ef\u4ee5\u770b\u5230\uff0c\u6b64\u65f6 mempool_bucket_ops \u5360\u636e rte_mempool_ops_table \u4e2d ops \u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd9\u4e0e\u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\u4e0d\u540c\u7684\u3002"),(0,r.kt)("h1",{id:"\u95ee\u9898\u63cf\u8ff0"},"\u95ee\u9898\u63cf\u8ff0"),(0,r.kt)("p",null,"primary \u8fdb\u7a0b\u4f7f\u7528 libdpdk.a \u4e2d\u7684\u94fe\u63a5\u987a\u5e8f\uff0c\u4f7f\u7528\u7b2c\u4e8c\u79cd rte_mempool_ops_table \u5e03\u5c40\u65b9\u5f0f\uff0csecondary \u8fdb\u7a0b\u4f7f\u7528 dpdk-pdump\uff0c\u4f7f\u7528\u6b64\u7a0b\u5e8f\u6765\u6293\u53d6\u62a5\u6587\u3002"),(0,r.kt)("p",null,"\u95ee\u9898\u73b0\u8c61\uff1a"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6253\u6d41\u60c5\u51b5\u4e0b\uff0cdpdk-pdump \u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u540e\u4f1a\u5bfc\u81f4 primary \u8fdb\u7a0b\u6bb5\u9519\u8bef\u3002")),(0,r.kt)("h1",{id:"dpdk-pdump-dump-\u62a5\u6587\u7684\u539f\u7406\u6d45\u6790"},"dpdk-pdump dump \u62a5\u6587\u7684\u539f\u7406\u6d45\u6790"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"dpdk-pdump")," \u9996\u5148\u521b\u5efa ",(0,r.kt)("strong",{parentName:"p"},"pdump_tuples")," \u4e2d\u4f7f\u80fd\u8868\u9879\u7684\u4e0d\u540c\u5b57\u6bb5\uff0c\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"pdump_tuples \u8868\u9879")," \u80fd\u591f",(0,r.kt)("strong",{parentName:"p"},"\u5b8c\u6574"),"\u7684\u63cf\u8ff0\u4e00\u4e2a\u5f85 dump \u7684\u76ee\u6807\u63a5\u53e3\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"dpdk-pdump")," \u4f1a\u4e3a\u6bcf\u4e00\u4e2a pdump_tuples \u521b\u5efa",(0,r.kt)("strong",{parentName:"p"},"\u5355\u72ec\u7684 pktmbuf_pool")," \u5e76\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"mp_mc_ops")," \u8fd9\u79cd ",(0,r.kt)("strong",{parentName:"p"},"mempool_ops"),"\uff0c\u540c\u65f6\u4f1a\u6839\u636e\u914d\u7f6e\u7684\u529f\u80fd\uff0c\u6765\u521b\u5efa\u76f8\u5e94\u7684 ",(0,r.kt)("strong",{parentName:"p"},"ring"),"\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"pdump_tuples \u53ca vdev \u63a5\u53e3\u521d\u59cb\u5316\u5b8c\u6210\u540e"),"\uff0c",(0,r.kt)("strong",{parentName:"p"},"dpdk-pdump")," \u4f1a\u8c03\u3000",(0,r.kt)("strong",{parentName:"p"},"rte_pdump_enable_by_deviceid")," \u6765\u4f7f\u80fd dump \u6307\u5b9a\u63a5\u53e3\u6307\u5b9a\u961f\u5217\u4e0a\u6307\u5b9a\u6536\u3001\u65b9\u5411\u62a5\u6587\u7684\u529f\u80fd\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"rte_pdump_enable_by_deviceid")," \u4f1a\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"pdump_tuples")," \u4e2d\u914d\u7f6e\u8868\u9879\u7684\u5185\u5bb9\u4f5c\u4e3a\u53c2\u6570\uff0c\u6784\u9020\u4e00\u6761",(0,r.kt)("strong",{parentName:"p"},"\u8bf7\u6c42"),"\uff0c\u7136\u540e\u5c06\u8fd9\u6761\u8bf7\u6c42\u901a\u8fc7",(0,r.kt)("strong",{parentName:"p"},"\u672c\u5730\u5957\u63a5\u5b57"),"\u53d1\u9001\u7ed9 ",(0,r.kt)("strong",{parentName:"p"},"primary")," \u8fdb\u7a0b\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"primary")," \u8fdb\u7a0b\u6536\u5230\u8fd9\u6761\u6d88\u606f\u540e\uff0c\u8fdb\u884c\u89e3\u6790\u5e76\u8c03\u7528 ",(0,r.kt)("strong",{parentName:"p"},"pdump_server")," \u51fd\u6570\uff0c",(0,r.kt)("strong",{parentName:"p"},"pdump_server")," \u8c03\u7528 ",(0,r.kt)("strong",{parentName:"p"},"set_pdump_rxtx_cbs")," \u6765\u5411\u8bf7\u6c42\u7684 port \u4e0e queue \u7684 rx\u3001tx \u65b9\u5411\u6ce8\u518c\u56de\u8c03\u51fd\u6570\uff0crx \u8fd9\u65b9\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"pdump_rx"),"\uff0ctx \u8fd9\u65b9\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"pdump_tx"),"\u3002"),(0,r.kt)("p",null,"\u5b8c\u6210\u4e86\u4e0a\u8ff0\u64cd\u4f5c\u540e\uff0c",(0,r.kt)("strong",{parentName:"p"},"pdump_server")," \u4f1a\u5411\u5bf9\u65b9\u53d1\u9001\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"reply"),"\uff0c\u8868\u660e\u914d\u7f6e\u72b6\u6001\u3002"),(0,r.kt)("p",null,"\u5f53\u7a0b\u5e8f\u8c03\u7528 ",(0,r.kt)("strong",{parentName:"p"},"rte_eth_rx_burst")," \u65f6\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u6210\u529f\u6536\u5230\u62a5\u6587\u540e"),"\uff0c\u4f1a",(0,r.kt)("strong",{parentName:"p"},"\u904d\u5386\u63a5\u6536\u56de\u8c03\u51fd\u6570\u5e76\u6267\u884c"),"\uff0c\u5728\u8fd9\u91cc\u5c31\u8c03\u7528\u5230\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"pdump_rx")," \u51fd\u6570\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"pdump_r"),"x \u51fd\u6570\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"dpdk-pdump")," \u53d1\u9001\u8bf7\u6c42\u4e2d\u6307\u5b9a\u7684 ",(0,r.kt)("strong",{parentName:"p"},"mempool")," \u6765\u7533\u8bf7 ",(0,r.kt)("strong",{parentName:"p"},"mbuf"),"\uff0c\u7136\u540e\u62f7\u8d1d\u62a5\u6587\u5230 ",(0,r.kt)("strong",{parentName:"p"},"mbuf")," \u4e2d\uff0c\u6210\u529f\u540e\u5c31\u5c1d\u8bd5\u5c06\u62a5\u6587\u6295\u9012\u5230 dpdk-pdump \u53d1\u9001\u8bf7\u6c42\u4e2d\u6307\u5b9a\u7684 ring \u4e2d\uff0c\u5931\u8d25\u5219\u76f4\u63a5\u91ca\u653e\u62a5\u6587\u3002"),(0,r.kt)("p",null,"\u7531\u4e8e dpdk \u7a0b\u5e8f\u5728\u521d\u59cb\u5316\u7684\u8fc7\u7a0b\u4e2d\u5df2\u7ecf\u6267\u884c\u4e86\u4e00\u4e9b",(0,r.kt)("strong",{parentName:"p"},"\u5185\u5b58\u7684\u5171\u4eab\u64cd\u4f5c"),"\uff0cprimary \u8fdb\u7a0b\u80fd\u591f",(0,r.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u4f7f\u7528 secondary \u8fdb\u7a0b\u4e2d\u7684\u4e00\u4e9b\u865a\u62df\u5730\u5740"),"\uff0c\u8fd9\u91cc\u7684 mempool \u7684\u5730\u5740\u5c31\u662f\u4e00\u4e2a\u5b9e\u4f8b\u3002"),(0,r.kt)("p",null,"\u95ee\u9898\u5c31\u51fa\u5728\u8fd9\u91cc\uff01\u5f53 primary \u8fdb\u7a0b\u6536\u5230\u5305\u540e\uff0c\u8c03\u7528\u5230 pdump_rx \u51fd\u6570\u65f6\uff0c\u5728\u4ece mempool \u4e2d\u7533\u8bf7 mbuf \u7684\u65f6\u5019\uff0c\u7531\u4e8e ",(0,r.kt)("strong",{parentName:"p"},"dpdk-pdump \u4e0e primary \u8fdb\u7a0b\u7684 rte_mempool_ops_table \u8868\u4e2d mempool_ops \u7684\u5e03\u5c40\u4e0d\u540c"),"\uff0c\u5728 dpdk-pdump \u5bf9\u5e94 ",(0,r.kt)("strong",{parentName:"p"},"ops_mp_mc")," \u8fd9\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"mempool_ops")," \u7684\u8868\u9879\u5904\uff0c\u5728 primary \u8fdb\u7a0b\u4e2d\u5b9e\u9645\u5bf9\u5e94\u7684\u662f ",(0,r.kt)("strong",{parentName:"p"},"bucket")," \u7684 ",(0,r.kt)("strong",{parentName:"p"},"mempool_ops"),"\uff0c\u5c31\u9020\u6210\u4e86 primary \u8fdb\u7a0b",(0,r.kt)("strong",{parentName:"p"},"\u6bb5\u9519\u8bef"),"\uff01"),(0,r.kt)("h1",{id:"\u89e3\u51b3\u65b9\u6848"},"\u89e3\u51b3\u65b9\u6848"),(0,r.kt)("p",null,"\u8c03\u6574 libdpdk.a \u4e2d mempool_ops \u6240\u5728\u5e93\u7684\u94fe\u63a5\u987a\u5e8f\uff0c\u4e0e dpdk-pdump \u4fdd\u6301\u4e00\u81f4\uff0c\u91cd\u65b0\u7f16\u8bd1 primary \u7a0b\u5e8f\u3002"),(0,r.kt)("h1",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("p",null,"\u672c\u6587\u4ece rte_mempool_ops \u7740\u624b\u63cf\u8ff0\uff0c\u76ee\u7684\u5728\u4e8e\u8bf4\u660e\u7531\u4e8e\u5e93\u94fe\u63a5\u987a\u5e8f\u7684\u533a\u522b\u5bfc\u81f4 dpdk primary \u8fdb\u7a0b\u4e0e secondary \u8fdb\u7a0b\u4e2d mempool_ops \u5728 rte_mempool_ops_table \u5360\u636e\u4e0d\u540c\u7684\u8868\u9879\uff0c\u8fdb\u4e00\u6b65\u9020\u6210\u7a0b\u5e8f\u6bb5\u9519\u8bef\u7684\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 gcc \u7684 constructor \u4fee\u9970\u7b26\u6765\u58f0\u660e\u6784\u9020\u51fd\u6570\uff0c\u5728\u4f7f\u7528\u9759\u6001\u5e93\u7684\u60c5\u51b5\u4e0b\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u94fe\u63a5\u987a\u5e8f\u5c31\u51b3\u5b9a\u4e86\u521d\u59cb\u5316\u7684\u987a\u5e8f\uff0c\u8fdb\u800c\u5f71\u54cd\u5230\u4e86\u5728\u4e0d\u540c\u7a0b\u5e8f\u4e2d\u8868\u5355\u7684\u5e03\u5c40"),"\uff0c\u8fd9\u4e00\u5e03\u5c40\u53c8\u968f\u7740\u591a\u4e2a\u7a0b\u5e8f\u4e4b\u95f4\u7684\u4ea4\u4e92\u88ab\u8bef\u7528\uff0c\u6700\u7ec8\u9020\u6210\u4e86\u4e25\u91cd\u7684\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 constructor \u4fee\u9970\u7b26",(0,r.kt)("strong",{parentName:"p"},"\u8ba9 mempool_ops \u7684\u52a8\u6001\u6dfb\u52a0"),"\u53d8\u5f97\u975e\u5e38\u7b80\u5355\uff0c\u907f\u514d\u4e86\u786c\u7f16\u7801\u3002\u4f46\u662f\u4f7f\u7528\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"constructor")," \u7684\u540c\u65f6\u4e5f\u7ee7\u627f\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"constructor")," \u6f5c\u5728\u7684\u95ee\u9898\uff0c\u5373\u94fe\u63a5\u7684\u987a\u5e8f\u51b3\u5b9a\u4e86\u521d\u59cb\u5316\u7684\u987a\u5e8f\uff0c\u8fd9\u7b97\u662f\u79cd\u9690\u5f0f\u7684\u4f9d\u8d56\uff0c\u4e0d\u592a\u5bb9\u6613\u53d1\u73b0\uff01"),(0,r.kt)("p",null,"\u6b63\u5982\u4e00\u4ef6\u4e8b\u7269\u6709\u597d\u6709\u574f\uff0c\u4e00\u4e2a\u6280\u672f\u4e5f\u6709\u597d\u6709\u574f\uff0c\u66f4\u51c6\u786e\u70b9\u8bf4\u5e94\u8be5\u662f",(0,r.kt)("strong",{parentName:"p"},"\u6709\u4f18\u52bf\u4e5f\u6709\u9650\u5236\u6761\u4ef6"),"\u3002\u6211\u4eec\u5e94\u5f53\u505a\u5230\u65e2\u6e05\u695a\u5b83\u7684\u4f18\u52bf\u4e5f\u6e05\u695a\u5b83\u7684\u9650\u5236\u6761\u4ef6\uff0c\u6b63\u5982\u6211\u4eec\u9700\u8981\u660e\u609f\u81ea\u5df1\u7684\u957f\u77ed\u4e00\u822c\uff0c\u5e76\u4e0d\u662f\u90a3\u4e48\u5bb9\u6613\uff01"),(0,r.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u7b97\u662f\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"groff")," \u7ed8\u56fe\u7684\u4e00\u4e2a\u5f00\u7aef\uff0c\u7ed8\u51fa\u7684\u56fe\u8ba9\u4eba\u633a\u6ee1\u610f\u7684\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u5f00\u7aef\uff0c\u4e5f\u662f\u4e00\u4e2a\u6539\u53d8\u7684\u70b9\u3002"),(0,r.kt)("p",null,"\u6700\u540e\u5c06 ",(0,r.kt)("strong",{parentName:"p"},"mempool_ops")," \u4e2d\u67d0\u5f20\u56fe\u7247\u7684 pic \u4ee3\u7801\u8d34\u5230\u4e0b\u9762\uff0c\u4ec5\u4f9b\u53c2\u8003\uff01"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-pic"},'.PS\n\ndefine rte_mempool_ops { \n    box "..........";\n    box $1 fill 0.4;\n    box $2 fill 0.6;\n }\n\nboxht=0.4;\nboxwid=2.5;\n\nA:box "sl";\ndown;\nbox "num_ops" with .nw at A.sw;\nB:box "ops[0]" fill 0.5;\nC:box "ops[1]" fill 0.5;\nD: box "ops[2]" fill 0.5;\nE: box "ops[3]" fill 0.5;\nF:box "ops[...]" fill 0.5;\n\nboxwid=1.8;\n\nH:box "octeontx" with .nw at A.se + (2, -4) fill 0.2;\nrte_mempool_ops("otx2_npa_enq", "otx2_npa_deq");\n\nI:box "dpaa" with .nw at A.e + (2, 0.5) fill 0.2;\nrte_mempool_ops("dpaa_mbuf_free_bulk", "dpaa_mbuf_alloc_bulk");\n\nJ:box "bucket" with .nw at A.se + (2, 3) fill 0.2;\nrte_mempool_ops("bucket_enqueue", "bucket_dequeue");\n\nK:box "dpaa2" with .nw at A.se + (2, -1.5) fill 0.2;\nrte_mempool_ops("irte_hw_mbuf_free_bulk", "rte_dpaa2_mbuf_alloc_bulk");\n\n"\\fBrte_mempool_ops_table\\fR" textwid 2 with .nw at A.c + (0, 0.4);\n"\\fB  mempool_octeontx_ops\\fR" textwid 2 with .nw at H.c + (0, 0.4);\n"\\fB  mempool_dpaa_ops\\fR" textwid 2 with .nw at I.c + (0, 0.4);\n"\\fB  mempool_bucket_ops\\fR" textwid 2 with .nw at J.c + (0, 0.4);\n"\\fB  mempool_dpaa2_ops\\fR" textwid 2 with .nw at K.c + (0, 0.4);\n\n\n\nline chop 0 chop 0 from B.e to J.w ->;\nline chop 0 chop 0 from C.e to I.w ->;\nline chop 0 chop 0 from D.e to K.w ->;\nline chop 0 chop 0 from E.e to H.w ->;\n')))}u.isMDXComponent=!0}}]);