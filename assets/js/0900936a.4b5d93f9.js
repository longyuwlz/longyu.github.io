"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[6173],{3905:function(e,n,t){t.d(n,{Zo:function(){return o},kt:function(){return m}});var s=t(7294);function d(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,s)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,s,d=function(e,n){if(null==e)return{};var t,s,d={},l=Object.keys(e);for(s=0;s<l.length;s++)t=l[s],n.indexOf(t)>=0||(d[t]=e[t]);return d}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)t=l[s],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(d[t]=e[t])}return d}var i=s.createContext({}),a=function(e){var n=s.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):u(u({},n),e)),t},o=function(e){var n=a(e.components);return s.createElement(i.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},p=s.forwardRef((function(e,n){var t=e.components,d=e.mdxType,l=e.originalType,i=e.parentName,o=r(e,["components","mdxType","originalType","parentName"]),p=a(t),m=d,v=p["".concat(i,".").concat(m)]||p[m]||c[m]||l;return t?s.createElement(v,u(u({ref:n},o),{},{components:t})):s.createElement(v,u({ref:n},o))}));function m(e,n){var t=arguments,d=n&&n.mdxType;if("string"==typeof e||d){var l=t.length,u=new Array(l);u[0]=p;var r={};for(var i in n)hasOwnProperty.call(n,i)&&(r[i]=n[i]);r.originalType=e,r.mdxType="string"==typeof e?e:d,u[1]=r;for(var a=2;a<l;a++)u[a]=t[a];return s.createElement.apply(null,u)}return s.createElement.apply(null,t)}p.displayName="MDXCreateElement"},6083:function(e,n,t){t.r(n),t.d(n,{assets:function(){return o},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return r},metadata:function(){return a},toc:function(){return c}});var s=t(7462),d=t(3366),l=(t(7294),t(3905)),u=["components"],r={},i="\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b",a={unversionedId:"\u6280\u672f\u535a\u5ba2/linux-system/systemd/\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b",id:"\u6280\u672f\u535a\u5ba2/linux-system/systemd/\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b",title:"\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b",description:"\u73af\u5883\u4fe1\u606f",source:"@site/docs/\u6280\u672f\u535a\u5ba2/linux-system/systemd/\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/linux-system/systemd",slug:"/\u6280\u672f\u535a\u5ba2/linux-system/systemd/\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/systemd/\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b",draft:!1,editUrl:"https://github.com/longyuwlz/longyu.github.io/docs/\u6280\u672f\u535a\u5ba2/linux-system/systemd/\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"udevd \u68c0\u7d22\u5185\u6838\u6a21\u5757\u5e76\u52a0\u8f7d\u7684 demo",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/systemd/udevd \u68c0\u7d22\u5185\u6838\u6a21\u5757\u5e76\u52a0\u8f7d\u7684 demo"},next:{title:"cn_proc demo \u4e2d\u521b\u5efa\u4e00\u4e2a netlink socket \u80cc\u540e\u7684\u5185\u6838\u884c\u4e3a",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/cn_proc demo \u4e2d\u521b\u5efa\u4e00\u4e2a netlink socket \u80cc\u540e\u7684\u5185\u6838\u884c\u4e3a"}},o={},c=[{value:"\u73af\u5883\u4fe1\u606f",id:"\u73af\u5883\u4fe1\u606f",level:2},{value:"systemd-udevd \u547d\u4ee4 help \u4fe1\u606f",id:"systemd-udevd-\u547d\u4ee4-help-\u4fe1\u606f",level:2},{value:"systemd-udevd -D \u53c2\u6570\u524d\u53f0\u8fd0\u884c",id:"systemd-udevd--d-\u53c2\u6570\u524d\u53f0\u8fd0\u884c",level:2},{value:"\u865a\u62df\u673a\u52a8\u6001\u6dfb\u52a0\u65b0\u7684\u7f51\u7edc\u8bbe\u5907\u6a21\u62df\u70ed\u63d2\u62d4",id:"\u865a\u62df\u673a\u52a8\u6001\u6dfb\u52a0\u65b0\u7684\u7f51\u7edc\u8bbe\u5907\u6a21\u62df\u70ed\u63d2\u62d4",level:2},{value:"\u4e0e\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u76f8\u5173\u7684 udev \u89c4\u5219",id:"\u4e0e\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u76f8\u5173\u7684-udev-\u89c4\u5219",level:3},{value:"2. \u6a21\u62df udevd \u4ece\u5185\u6838\u6536\u5230\u7684 uevent netlink \u6d88\u606f\u7684\u5185\u5bb9",id:"2-\u6a21\u62df-udevd-\u4ece\u5185\u6838\u6536\u5230\u7684-uevent-netlink-\u6d88\u606f\u7684\u5185\u5bb9",level:3},{value:"3. \uff12 \u4e2d\u4e0e udevd \u81ea\u52a8\u52a0\u8f7d\u9a71\u52a8\u76f8\u5173\u7684 netlink \u6d88\u606f",id:"3-\uff12-\u4e2d\u4e0e-udevd-\u81ea\u52a8\u52a0\u8f7d\u9a71\u52a8\u76f8\u5173\u7684-netlink-\u6d88\u606f",level:3},{value:"udevd \u5982\u4f55\u901a\u8fc7 MODALIAS \u83b7\u53d6\u5230\u9700\u8981\u52a0\u8f7d\u7684\u9a71\u52a8?",id:"udevd-\u5982\u4f55\u901a\u8fc7-modalias-\u83b7\u53d6\u5230\u9700\u8981\u52a0\u8f7d\u7684\u9a71\u52a8",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],p={toc:c};function m(e){var n=e.components,t=(0,d.Z)(e,u);return(0,l.kt)("wrapper",(0,s.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u4ece-systemd-udevd-\u8fd0\u884c-log-\u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b"},"\u4ece systemd-udevd \u8fd0\u884c log \u4e2d\u7814\u7a76\u5176\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b"),(0,l.kt)("h2",{id:"\u73af\u5883\u4fe1\u606f"},"\u73af\u5883\u4fe1\u606f"),(0,l.kt)("p",null,"linux \u73af\u5883\uff1adebian10 \u7cfb\u7edf"),(0,l.kt)("p",null,"systemd \u7248\u672c\uff1asystemd 241"),(0,l.kt)("p",null,"\u8fd0\u884c\u73af\u5883\uff1aVMware \u865a\u673a\u73af\u5883"),(0,l.kt)("h2",{id:"systemd-udevd-\u547d\u4ee4-help-\u4fe1\u606f"},"systemd-udevd \u547d\u4ee4 help \u4fe1\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"longyu@debian:~$ /lib/systemd/systemd-udevd --help\nsystemd-udevd [OPTIONS...]\n\nManages devices.\n\n  -h --help                   Print this message\n  -V --version                Print version of the program\n  -d --daemon                 Detach and run in the background\n  -D --debug                  Enable debug output\n  -c --children-max=INT       Set maximum number of workers\n  -e --exec-delay=SECONDS     Seconds to wait before executing RUN=\n  -t --event-timeout=SECONDS  Seconds to wait before terminating an event\n  -N --resolve-names=early|late|never\n                              When to resolve users and groups\n\nSee the systemd-udevd.service(8) man page for details.\n")),(0,l.kt)("p",null,"-D \u53c2\u6570\u53ef\u4ee5\u4f7f\u80fd debug \u4fe1\u606f\uff0c\u9996\u5148\u5f00\u542f\u8fd9\u4e2a\u53c2\u6570\u6765\u89c2\u5bdf systemd-udevd \u7684\u8f93\u51fa\u4fe1\u606f\u3002"),(0,l.kt)("h2",{id:"systemd-udevd--d-\u53c2\u6570\u524d\u53f0\u8fd0\u884c"},"systemd-udevd -D \u53c2\u6570\u524d\u53f0\u8fd0\u884c"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6267\u884c sudo systemctl stop systemd-udevd \u505c\u6b62\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b"),(0,l.kt)("li",{parentName:"ol"},"\u624b\u52a8\u6267\u884c sudo /lib/systemd/systemd-udevd -D")),(0,l.kt)("p",null,"\u624b\u52a8\u8fd0\u884c\u65f6\u7ec8\u7aef\u7684\u90e8\u5206\u8f93\u51fa\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},".........\nLoad module index\ntimestamp of '/etc/systemd/network' changed\ntimestamp of '/usr/lib/systemd/network' changed\nParsed configuration file /usr/lib/systemd/network/99-default.link\nCreated link configuration context.\ntimestamp of '/etc/udev/rules.d' changed\ntimestamp of '/lib/udev/rules.d' changed\nReading rules file: /usr/lib/udev/rules.d/50-firmware.rules\nReading rules file: /usr/lib/udev/rules.d/50-udev-default.rules\nReading rules file: /usr/lib/udev/rules.d/55-dm.rules\nReading rules file: /usr/lib/udev/rules.d/60-block.rules\nReading rules file: /usr/lib/udev/rules.d/60-cdrom_id.rules\nReading rules file: /usr/lib/udev/rules.d/60-drm.rules\n.........\nRules contain 24576 bytes tokens (2048 * 12 bytes), 12517 bytes strings\n1770 strings (22169 bytes), 1165 de-duplicated (10258 bytes), 606 trie nodes used\n")),(0,l.kt)("p",null,"\u4e0a\u9762\u8f93\u51fa\u7684\u5927\u90e8\u5206\u5728\u8bfb\u53d6\u5e76\u89e3\u6790 udev \u7684\u89c4\u5219\uff0c\u8fd9\u4e9b\u89c4\u5219\u63cf\u8ff0\u4e86 systemd-udevd \u63a5\u6536\u5230\u4e00\u4e2a\u4e8b\u4ef6\u65f6\u7684\u5904\u7406\u8fc7\u7a0b\u3002"),(0,l.kt)("h2",{id:"\u865a\u62df\u673a\u52a8\u6001\u6dfb\u52a0\u65b0\u7684\u7f51\u7edc\u8bbe\u5907\u6a21\u62df\u70ed\u63d2\u62d4"},"\u865a\u62df\u673a\u52a8\u6001\u6dfb\u52a0\u65b0\u7684\u7f51\u7edc\u8bbe\u5907\u6a21\u62df\u70ed\u63d2\u62d4"),(0,l.kt)("p",null,"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u7f51\u7edc\u8bbe\u5907\u64cd\u4f5c\u56fe\u793a\u5982\u4e0b\uff1a\n",(0,l.kt)("img",{parentName:"p",src:"https://img-blog.csdnimg.cn/346312ddf01741b69036dc11da04b23b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAbG9uZ3l1X3dseg==,size_15,color_FFFFFF,t_70,g_se,x_16",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"}),"\n\u6dfb\u52a0\u540e\u7ec8\u7aef\u8f93\u51fa\u4fe1\u606f\u4e2d\u4e0e",(0,l.kt)("strong",{parentName:"p"},"\u52a0\u8f7d\u6a21\u5757\u76f8\u5173\u7684\u4fe1\u606f"),"\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"Successfully forked off 'n/a' as PID 2557.\n0000:02:08.0: Worker [2557] is forked for processing SEQNUM=4168.\n0000:02:08.0: Processing device (SEQNUM=4168, ACTION=add)\n0000:02:08.0: IMPORT builtin 'hwdb' /usr/lib/udev/rules.d/50-udev-default.rules:14\n0000:02:08.0: RUN 'kmod load $env{MODALIAS}' /usr/lib/udev/rules.d/80-drivers.rules:5\n0000:02:08.0: sd-device: Created db file '/run/udev/data/+pci:0000:02:08.0' for '/devices/pci0000:00/0000:00:11.0/0000:02:08.0'\nLoading module: pci:v00008086d0000100Fsv000015ADsd00000750bc02sc00i00\nModule 'e1000' is already loaded\n0000:02:08.0: Device (SEQNUM=4168, ACTION=add) processed\n0000:02:08.0: sd-device-monitor: Passed 547 byte to netlink monitor\n")),(0,l.kt)("p",null,"\u4ece\u4e0a\u9762\u7684\u8f93\u51fa\u770b systemd-udevd \u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u8fc7\u7a0b\u53ef\u80fd\u6709\u5982\u4e0b\u6d41\u7a0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5185\u90e8\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u5904\u7406\u4ece\u5185\u6838\u6536\u5230\u7684 uevent \u6d88\u606f"),(0,l.kt)("li",{parentName:"ol"},"\u6839\u636e\u6d88\u606f\u7684\u5185\u5bb9\u5339\u914d udev \u89c4\u5219\uff0c\u4f9d\u6b21\u6267\u884c\u5339\u914d\u5230\u7684\u89c4\u5219\u5bf9\u5e94\u7684\u5185\u90e8\u547d\u4ee4\uff0c\u8fd9\u91cc pci \u8bbe\u5907\u4f1a\u521b\u5efa MODALIAS \u5c5e\u6027\uff0cudevd \u5339\u914d\u5230 /usr/lib/udev/rules.d/80-drivers.rules \u89c4\u5219\uff0c\u8fdb\u800c\u6267\u884c kmod load \u547d\u4ee4\uff0c\u6b64\u547d\u4ee4\u7684\u53c2\u6570\u4e3a MODALIAS \u5c5e\u6027\u7684\u503c"),(0,l.kt)("li",{parentName:"ol"},"\u521b\u5efa\u5185\u90e8\u7684\u6570\u636e\u5e93\u6587\u4ef6"),(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528 MODALIAS \u5339\u914d\u5173\u8054\u7684\u5185\u6838\u9a71\u52a8\u5e76\u5224\u65ad\u662f\u5426\u52a0\u8f7d\uff0c\u672a\u52a0\u8f7d\u5c31\u52a0\u8f7d\uff0c\u5df2\u7ecf\u52a0\u8f7d\u5219\u7ee7\u7eed\u5411\u4e0b\u6267\u884c"),(0,l.kt)("li",{parentName:"ol"},"\u4e8b\u4ef6\u5904\u7406\u5b8c\u6210\u540e\u6b63\u5e38\u8fd4\u56de")),(0,l.kt)("p",null,"\u5728\u4e0a\u8ff0\u5047\u60f3\u6d41\u7a0b\u4e2d\uff0c\u5bf9\u4e8e udevd \u89c4\u5219\u4e0e udevd \u4ece\u5185\u6838\u6536\u5230\u7684 uevent netlink \u6d88\u606f\u7684\u5185\u5bb9\u5b58\u5728\u76f2\u533a\uff0c\u5728\u8fdb\u4e00\u6b65\u7684\u5206\u6790\u524d\u5148\u67e5\u770b\u4e0b\u8fd9\u4e9b\u4fe1\u606f\u3002"),(0,l.kt)("h3",{id:"\u4e0e\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u76f8\u5173\u7684-udev-\u89c4\u5219"},"\u4e0e\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u76f8\u5173\u7684 udev \u89c4\u5219"),(0,l.kt)("p",null,"50-udev-default.rules \u89c4\u5219\u4fe1\u606f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'longyu@debian:~$ sed -n \'14p\' /usr/lib/udev/rules.d/50-udev-default.rules\nENV{MODALIAS}!="", IMPORT{builtin}="hwdb --subsystem=$env{SUBSYSTEM}"\n')),(0,l.kt)("p",null,"80-drivers.rules \u89c4\u5219\u4fe1\u606f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'longyu@debian:~$ sed -n \'5p\' /usr/lib/udev/rules.d/80-drivers.rules\nENV{MODALIAS}=="?*", RUN{builtin}+="kmod load $env{MODALIAS}"\n')),(0,l.kt)("p",null,"\u5173\u952e\u7684\u89c4\u5219\u4e3a 80-drivers.rules \u89c4\u5219\uff0c\u52a0\u8f7d\u6a21\u5757\u5b9e\u9645\u662f\u901a\u8fc7 kmod load \u547d\u4ee4\u5b8c\u6210\u7684\u3002"),(0,l.kt)("h3",{id:"2-\u6a21\u62df-udevd-\u4ece\u5185\u6838\u6536\u5230\u7684-uevent-netlink-\u6d88\u606f\u7684\u5185\u5bb9"},"2. \u6a21\u62df udevd \u4ece\u5185\u6838\u6536\u5230\u7684 uevent netlink \u6d88\u606f\u7684\u5185\u5bb9"),(0,l.kt)("p",null,"\u4f7f\u7528\u5982\u4e0b\u7a0b\u5e8f\uff08\u90e8\u5206\u4ee3\u7801\u6458\u81ea udevd \u6e90\u7801\u5e76\u8fdb\u884c\u4e86\u4e00\u4e9b\u4fee\u6539\uff09\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},'#include <stdio.h>  \n#include <stdlib.h>  \n#include <string.h>  \n#include <ctype.h>  \n#include <sys/un.h>  \n#include <sys/ioctl.h>  \n#include <sys/socket.h>  \n#include <linux/types.h>  \n#include <linux/netlink.h>  \n#include <errno.h>  \n#include <unistd.h>  \n#include <arpa/inet.h>  \n#include <netinet/in.h>  \n\n#ifndef NEWLINE\n#define NEWLINE "\\r\\n"\n#endif\n\n#define UEVENT_BUFFER_SIZE 2048  \n\nstatic int init_hotplug_sock()  \n{  \n  const int buffersize = 1024;  \n  int ret;  \n\n  struct sockaddr_nl snl;  \n  bzero(&snl, sizeof(struct sockaddr_nl));  \n  snl.nl_family = AF_NETLINK;  \n  snl.nl_pid = getpid();  \n  snl.nl_groups = 1;  \n\n  int s = socket(PF_NETLINK, SOCK_DGRAM, NETLINK_KOBJECT_UEVENT);  \n  if (s == -1)   \n  {  \n      perror("socket");  \n      return -1;  \n  }  \n  setsockopt(s, SOL_SOCKET, SO_RCVBUF, &buffersize, sizeof(buffersize));  \n\n  ret = bind(s, (struct sockaddr *)&snl, sizeof(struct sockaddr_nl));  \n  if (ret < 0)   \n  {  \n      perror("bind");  \n      close(s);  \n      return -1;  \n  }  \n\n  return s;  \n}  \n\nchar *truncate_nl(char *s) {\n\n        s[strcspn(s, NEWLINE)] = 0;\n        return s;\n}\n\nint device_new_from_nulstr(uint8_t *nulstr, size_t len) {\n        int i = 0;\n        int r;\n\n        while (i < len) {\n                char *key;\n                const char *end;\n\n                key = (char*)&nulstr[i];\n                end = memchr(key, \'\\0\', len - i);\n                if (!end)\n                    return 0;\n\n                i += end - key + 1;\n                truncate_nl(key);\n                printf("%s\\n", key);    \n        }\n}   \n\nint main(int argc, char* argv[])  \n{  \n    int hotplug_sock = init_hotplug_sock();  \n    int bufpos;\n\n    while(1)  \n    {  \n        int len;\n        /* Netlink message buffer */  \n        char buf[UEVENT_BUFFER_SIZE * 2];\n\n        memset(&buf, 0x00, sizeof(buf));    \n        len = recv(hotplug_sock, &buf, sizeof(buf), 0);\n        \n        if (len <= 0)\n            continue;\n        \n        printf("\\nnew message:\\n");\n        bufpos = strlen(buf) + 1;\n        \n        printf("%s\\n", buf);\n\n        device_new_from_nulstr((uint8_t*)&buf[bufpos], len - bufpos);\n    }\n    return 0;  \n }\n')),(0,l.kt)("p",null,"\u7f16\u8bd1\u5e76\u8fd0\u884c\u6b64\u7a0b\u5e8f\uff0c\u91cd\u65b0\u6dfb\u52a0\u4e00\u4e2a\u7f51\u7edc\u8bbe\u5907\u540e\uff0c\u7ec8\u7aef\u8f93\u51fa\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"new message:\nadd@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0\nACTION=add\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0\nSUBSYSTEM=pci\nPCI_CLASS=20000\nPCI_ID=8086:10D3\nPCI_SUBSYS_ID=8086:0000\nPCI_SLOT_NAME=0000:0a:00.0\nMODALIAS=pci:v00008086d000010D3sv00008086sd00000000bc02sc00i00\nSEQNUM=2068\n\nnew message:\nadd@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/ptp/ptp4\nACTION=add\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/ptp/ptp4\nSUBSYSTEM=ptp\nMAJOR=249\nMINOR=4\nDEVNAME=ptp4\nSEQNUM=2069\n\nnew message:\nadd@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/net/eth0\nACTION=add\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/net/eth0\nSUBSYSTEM=net\nINTERFACE=eth0\nIFINDEX=7\nSEQNUM=2070\n\nnew message:\nadd@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/net/eth0/queues/rx-0\nACTION=add\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/net/eth0/queues/rx-0\nSUBSYSTEM=queues\nSEQNUM=2071\n\nnew message:\nadd@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/net/eth0/queues/tx-0\nACTION=add\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/net/eth0/queues/tx-0\nSUBSYSTEM=queues\nSEQNUM=2072\n\nnew message:\nbind@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0\nACTION=bind\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0\nSUBSYSTEM=pci\nDRIVER=e1000e\nPCI_CLASS=20000\nPCI_ID=8086:10D3\nPCI_SUBSYS_ID=8086:0000\nPCI_SLOT_NAME=0000:0a:00.0\nMODALIAS=pci:v00008086d000010D3sv00008086sd00000000bc02sc00i00\nSEQNUM=2073\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5185\u6838\u89e6\u53d1\u4e86\u591a\u4e2a\u4e0d\u540c\u8bbe\u5907\u7684 uevent \u6d88\u606f\uff0c\u6bcf\u4e00\u4e2a uevent \u6d88\u606f\u90fd\u6709\u81ea\u5df1\u7684\u952e\u503c\u5bf9\uff0cACTION \u8868\u793a uevent \u7684\u52a8\u4f5c\uff0cadd \u8868\u793a\u8bbe\u5907\u6dfb\u52a0\uff0cDEVPATH \u7684\u503c\u6dfb\u52a0 /sys \u524d\u7f00\u6307\u5411\u8bbe\u5907\u5728 /sys \u76ee\u5f55\u4e2d\u7684\u5177\u4f53\u4f4d\u7f6e\uff0cSEQNUM \u8868\u793a\u6d88\u606f\u53f7\uff0c\u4f9d\u6b21\u9012\u589e\uff0cSUBSYSTEM \u8868\u793a\u8bbe\u5907\u6240\u5c5e\u7684\u5b50\u7cfb\u7edf\u3002"),(0,l.kt)("p",null,"\u5f53 systemd-udevd \u6536\u5230\u4e00\u4e2a\u4e0a\u8ff0\u7c7b\u578b\u7684 uevent \u6d88\u606f\u65f6\u5c31\u4f1a\u6309\u7167\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u8fdb\u884c\u89e3\u6790\u5e76\u8bbe\u7f6e\u5185\u90e8\u7684\u6570\u636e\u7ed3\u6784\u3002"),(0,l.kt)("h3",{id:"3-\uff12-\u4e2d\u4e0e-udevd-\u81ea\u52a8\u52a0\u8f7d\u9a71\u52a8\u76f8\u5173\u7684-netlink-\u6d88\u606f"},"3. \uff12 \u4e2d\u4e0e udevd \u81ea\u52a8\u52a0\u8f7d\u9a71\u52a8\u76f8\u5173\u7684 netlink \u6d88\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"add@/devices/pci0000:00/0000:00:03.1/0000:0a:00.0\nACTION=add\nDEVPATH=/devices/pci0000:00/0000:00:03.1/0000:0a:00.0\nSUBSYSTEM=pci\nPCI_CLASS=20000\nPCI_ID=8086:10D3\nPCI_SUBSYS_ID=8086:0000\nPCI_SLOT_NAME=0000:0a:00.0\nMODALIAS=pci:v00008086d000010D3sv00008086sd00000000bc02sc00i00\nSEQNUM=2068\n")),(0,l.kt)("p",null,"\u4e0a\u8ff0\u6d88\u606f\u5728\u88ab udevd \u89e3\u6790\u540e\uff0cpci \u8bbe\u5907 0000:0a:00.0 \u7684 MODALIAS \u5c5e\u6027\u88ab\u8bbe\u7f6e\uff0c\u6700\u7ec8\u5339\u914d\u5230\u4e0a\u6587\u63d0\u5230\u7684 80-drivers.rules \u89c4\u5219\u5b8c\u6210\u6a21\u5757\u52a0\u8f7d\u8fc7\u7a0b\u3002"),(0,l.kt)("p",null,"\u5f53\u8bbe\u5907\u6210\u529f probe \u9a71\u52a8\u540e\uff0c\u8bbe\u5907\u5728 sys \u76ee\u5f55\u4e2d\u5bf9\u5e94\u7684 uevent \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"longyu@virt-debian10:~$ cat /sys/devices/pci0000:00/0000:00:03.1/0000:0a:00.0/uevent\nDRIVER=e1000e\nPCI_CLASS=20000\nPCI_ID=8086:10D3\nPCI_SUBSYS_ID=8086:0000\nPCI_SLOT_NAME=0000:0a:00.0\nMODALIAS=pci:v00008086d000010D3sv00008086sd00000000bc02sc00i00\n")),(0,l.kt)("h2",{id:"udevd-\u5982\u4f55\u901a\u8fc7-modalias-\u83b7\u53d6\u5230\u9700\u8981\u52a0\u8f7d\u7684\u9a71\u52a8"},"udevd \u5982\u4f55\u901a\u8fc7 MODALIAS \u83b7\u53d6\u5230\u9700\u8981\u52a0\u8f7d\u7684\u9a71\u52a8?"),(0,l.kt)("p",null,"udevd \u901a\u8fc7 libkmod \u6a21\u5757\u6765\u5b8c\u6210\u5185\u6838\u6a21\u5757\u7684\u67e5\u627e\u3001\u52a0\u8f7d\u5de5\u4f5c\u3002libkmod \u5b9e\u9645\u662f\u901a\u8fc7\u89e3\u6790 /lib/modules/$(uname -r)/modules.alias.bin \u6765\u83b7\u53d6\u4e0d\u540c\u8bbe\u5907\u4f7f\u7528\u7684\u6a21\u5757\u4fe1\u606f\u3002"),(0,l.kt)("p",null,"\u5728\u6211\u7684\u865a\u62df\u673a\u4e2d\u4f7f\u7528 pci:v00008086d000010D3sv00008086sd00000000bc02sc00i00 \u4e2d\u7684\u524d\u51e0\u4e2a\u5b57\u6bb5\uff08\u8868\u793a vendor id \u4e0e device id \u7684\u5b57\u6bb5\uff09\u68c0\u7d22  /lib/modules/$(uname -r)/modules.alias \u83b7\u53d6\u5230\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"longyu@virt-debian10:/lib/modules/4.19.0-8-amd64$ grep 'v00008086d000010D3' ./modules.alias\nalias pci:v00008086d000010D3sv*sd*bc*sc*i* e1000e\n")),(0,l.kt)("p",null,"\u6700\u540e\u4e00\u5217 e1000e \u8868\u793a\u6b64\u8bbe\u5907\u4f7f\u7528\u7684\u9a71\u52a8\uff0c\u83b7\u53d6\u5230\u8fd9\u4e2a\u9a71\u52a8\u540e\u5c31\u53ef\u4ee5\u8c03\u7528 libkmod \u63d0\u4f9b\u7684\u63a5\u53e3\u52a0\u8f7d e1000e \u6a21\u5757\u3002"),(0,l.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"\u672c\u6587\u4ece systemd-udevd \u7684 manual \u5165\u624b\uff0c\u901a\u8fc7 debug \u9009\u9879\u83b7\u53d6 udevd \u6267\u884c\u7684 log \u4fe1\u606f\uff0c\u901a\u8fc7\u6269\u5927\u4fe1\u606f\u6765\u4e3a\u8fdb\u4e00\u6b65\u7814\u7a76 udevd \u7684\u4ee3\u7801\u505a\u4e86\u94fa\u57ab\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e9b\u4fe1\u606f\u5b9a\u4e49\u4e86 udevd \u7684\u5173\u952e\u6d41\u7a0b\uff0c\u6709\u4e86\u8fd9\u4e9b\u4fe1\u606f\u518d\u6765\u7406\u89e3\u5b83\u7684\u5b9e\u73b0\u5c31\u4e0d\u90a3\u4e48\u56f0\u96be\u4e86\u3002"))}m.isMDXComponent=!0}}]);