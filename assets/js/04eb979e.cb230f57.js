"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[455],{3905:function(n,e,t){t.d(e,{Zo:function(){return u},kt:function(){return d}});var a=t(7294);function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){i(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function p(n,e){if(null==n)return{};var t,a,i=function(n,e){if(null==n)return{};var t,a,i={},l=Object.keys(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}var o=a.createContext({}),s=function(n){var e=a.useContext(o),t=e;return n&&(t="function"==typeof n?n(e):r(r({},e),n)),t},u=function(n){var e=s(n.components);return a.createElement(o.Provider,{value:e},n.children)},f={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},c=a.forwardRef((function(n,e){var t=n.components,i=n.mdxType,l=n.originalType,o=n.parentName,u=p(n,["components","mdxType","originalType","parentName"]),c=s(t),d=i,_=c["".concat(o,".").concat(d)]||c[d]||f[d]||l;return t?a.createElement(_,r(r({ref:e},u),{},{components:t})):a.createElement(_,r({ref:e},u))}));function d(n,e){var t=arguments,i=e&&e.mdxType;if("string"==typeof n||i){var l=t.length,r=new Array(l);r[0]=c;var p={};for(var o in e)hasOwnProperty.call(e,o)&&(p[o]=e[o]);p.originalType=n,p.mdxType="string"==typeof n?n:i,r[1]=p;for(var s=2;s<l;s++)r[s]=t[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},3274:function(n,e,t){t.r(e),t.d(e,{assets:function(){return u},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return f}});var a=t(7462),i=t(3366),l=(t(7294),t(3905)),r=["components"],p={},o="iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757",s={unversionedId:"\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network/iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757",id:"\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network/iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757",title:"iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757",description:"\u95ee\u9898\u63cf\u8ff0",source:"@site/docs/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network/iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network",slug:"/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network/iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network/iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757",draft:!1,editUrl:"https://github.com/longyuwlz/longyu.github.io/docs/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/network/iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"linux \u5185\u6838\u4fe1\u53f7\u673a\u5236\u9700\u8981\u89e3\u51b3\u7684\u4e24\u4e2a\u5173\u952e\u95ee\u9898",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/\u8fdb\u7a0b\u76f8\u5173/\u8fdb\u7a0b\u95f4\u901a\u4fe1/linux \u5185\u6838\u4fe1\u53f7\u673a\u5236\u9700\u8981\u89e3\u51b3\u7684\u4e24\u4e2a\u5173\u952e\u95ee\u9898"},next:{title:"Program xxx tried to access /dev/mem between f0000-\uff1e100000.",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u6a21\u5757/\u5185\u5b58/Program xxx tried to access xxx"}},u={},f=[{value:"\u95ee\u9898\u63cf\u8ff0",id:"\u95ee\u9898\u63cf\u8ff0",level:2},{value:"\u5982\u4f55\u786e\u5b9a iptables \u547d\u4ee4\u9700\u8981\u4f7f\u7528\u7684\u5185\u6838\u6a21\u5757",id:"\u5982\u4f55\u786e\u5b9a-iptables-\u547d\u4ee4\u9700\u8981\u4f7f\u7528\u7684\u5185\u6838\u6a21\u5757",level:2},{value:"\u786e\u5b9a\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb",id:"\u786e\u5b9a\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb",level:2},{value:"insmod nf_nat_ipv6 \u6a21\u5757\u5931\u8d25\u7684\u95ee\u9898",id:"insmod-nf_nat_ipv6-\u6a21\u5757\u5931\u8d25\u7684\u95ee\u9898",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],c={toc:f};function d(n){var e=n.components,t=(0,i.Z)(n,r);return(0,l.kt)("wrapper",(0,a.Z)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"iptables-\u4e0e-ip6tables-\u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757"},"iptables \u4e0e ip6tables \u547d\u4ee4\u4f9d\u8d56\u7684\u5185\u6838\u6a21\u5757"),(0,l.kt)("h2",{id:"\u95ee\u9898\u63cf\u8ff0"},"\u95ee\u9898\u63cf\u8ff0"),(0,l.kt)("p",null,"\u6700\u8fd1\u9700\u8981\u7ed9\u4ea7\u54c1\u7f16\u8bd1 iptables \u76f8\u5173\u7684\u5185\u6838\u6a21\u5757\uff0c\u9700\u8981\u8fbe\u6210\u7684\u76ee\u6807\u662f\u80fd\u591f\u8fd0\u884c\u4e0b\u9762\u8fd9\u4e24\u884c\u547d\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ip6tables -t nat -vnL\niptables -t nat -vnL\n")),(0,l.kt)("p",null,"\u4e4d\u4e00\u770b\u611f\u89c9\u633a\u5bb9\u6613\u7684\uff0c\u4f46\u5b9e\u9645\u641e\u7684\u65f6\u5019\u5374\u53d1\u73b0\u9700\u8981\u7f16\u8bd1\u591a\u4e2a\u6a21\u5757\uff0c\u5e76\u4e14\u6a21\u5757\u4e4b\u95f4\u8fd8\u6709\u76f8\u5bf9\u590d\u6742\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6574\u4e86\u4e00\u4f1a\u6700\u7ec8\u641e\u5b9a\u4e86\uff0c\u5728\u672c\u6587\u4e2d\u8bb0\u5f55\u4e00\u4e0b\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898\u3002"),(0,l.kt)("h2",{id:"\u5982\u4f55\u786e\u5b9a-iptables-\u547d\u4ee4\u9700\u8981\u4f7f\u7528\u7684\u5185\u6838\u6a21\u5757"},"\u5982\u4f55\u786e\u5b9a iptables \u547d\u4ee4\u9700\u8981\u4f7f\u7528\u7684\u5185\u6838\u6a21\u5757"),(0,l.kt)("p",null,"\u771f\u6b63\u5f00\u59cb\u641e\u7684\u65f6\u5019\uff0c\u6211\u53d1\u73b0 iptables \u547d\u4ee4\u9700\u8981\u4f7f\u7528\u54ea\u4e9b\u5185\u6838\u6a21\u5757\u8ba9\u6211\u72af\u96be\u4e86\u3002\u7531\u4e8e\u6211\u4eec\u4f7f\u7528\u7684\u662f\u5b9a\u5236\u5316\u7684\u5185\u6838\uff0c\u4e0d\u80fd\u4ece\u5185\u90e8\u627e\u5230\u4e00\u4e2a\u57fa\u7ebf\u53c2\u8003\u3002"),(0,l.kt)("p",null,"\u7ecf\u8fc7\u540c\u4e8b\u63d0\u9192\uff0c\u6211\u53d1\u73b0\u53ef\u4ee5\u901a\u8fc7\u73b0\u6709\u7684\u53d1\u884c\u7248\u6765\u786e\u5b9a\u9700\u8981\u4f7f\u7528\u54ea\u4e9b\u6a21\u5757\u3002"),(0,l.kt)("p",null,"debian10 \u4e2d\u7684 iptables \u547d\u4ee4\u9700\u8981\u4f7f\u7528\u5230\u7684\u5185\u6838\u6a21\u5757\u5217\u8868\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"nft_chain_nat_ipv6     16384  4\nnf_nat_ipv6            16384  1 nft_chain_nat_ipv6\nnf_nat                 36864  1 nf_nat_ipv6\nnf_conntrack          172032  2 nf_nat,nf_nat_ipv6\nnf_defrag_ipv6         20480  1 nf_conntrack\nnf_defrag_ipv4         16384  1 nf_conntrack\nlibcrc32c              16384  2 nf_conntrack,nf_nat\nnf_tables             143360  1 nft_chain_nat_ipv6\nnfnetlink              16384  1 nf_tables\n")),(0,l.kt)("p",null,"\u6709\u4e86\u8fd9\u4e2a\u57fa\u7ebf\u6570\u636e\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u53d8\u5f97\u7b80\u5355\u4e86\uff01"),(0,l.kt)("h2",{id:"\u786e\u5b9a\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb"},"\u786e\u5b9a\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb"),(0,l.kt)("p",null,"\u5bf9\u53d1\u884c\u7248\u4f7f\u7528\u5230\u7684\u5185\u6838\u6a21\u5757\u8fdb\u884c\u68b3\u7406\uff0c\u521d\u6b65\u786e\u5b9a\u9700\u8981\u7f16\u8bd1\u4e0b\u9762\u8fd9\u4e9b\u5185\u6838\u6a21\u5757\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"iptable_filter.ko\nnf_nat.ko\nnf_defrag_ipv4.ko\nnf_conntrack_ipv4.ko\nnf_nat_ipv4.ko\niptable_nat.ko\nip6_tables.ko\nip6table_filter.ko\nnf_nat_ipv6.ko\nip6table_nat.ko\n")),(0,l.kt)("p",null,"\u7531\u4e8e\u6211\u4eec\u4f7f\u7528\u7684\u662f insmod \u547d\u4ee4\uff0c\u8fd8\u5fc5\u987b",(0,l.kt)("strong",{parentName:"p"},"\u786e\u5b9a\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb"),"\uff0c\u540c\u65f6\u7531\u4e8e\u6211\u4eec\u7684\u7cfb\u7edf\u4e2d\u79fb\u9664\u4e86 /lib/modules \u76ee\u5f55\uff0c\u65e0\u6cd5\u901a\u8fc7 modprobe \u6765\u627e\u5230\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb\u3002"),(0,l.kt)("p",null,"\u6211\u60f3\u4e5f\u8bb8 modinfo \u53ef\u4ee5\u89e3\u51b3\u6211\u7684\u95ee\u9898\uff0cman modinfo \u5f97\u5230\u4e86\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-manual"},"   -F, --field\n           Only print this field value, one per line. This is most useful for scripts. Field names are case-insensitive. Common fields (which may\n           not be in every module) include author, description, license, parm, depends, and alias. There are often multiple parm, alias and\n           depends fields. The special field filename lists the filename of the module.\n")),(0,l.kt)("p",null,"\u4e0a\u9762\u7684\u63cf\u8ff0\u8bf4\u660e\uff0c\u53ef\u4ee5\u8bbe\u5b9a modinfo \u7684 -F \u53c2\u6570\u6765\u8f93\u51fa\u6a21\u5757\u4f9d\u8d56\u7b49\u4fe1\u606f\u3002\u5c06\u4e0a\u6587\u4e2d\u68b3\u7406\u51fa\u6765\u7684 iptables \u76f8\u5173\u5185\u6838\u6a21\u5757\u5217\u8868\u5b58\u50a8\u4e3a\u4e00\u4e2a\u540d\u4e3a test \u7684\u6587\u4ef6\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6\u6a21\u5757\u4f9d\u8d56\u4fe1\u606f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'for i in $(cat test); do echo -n -e "$i depends:"; find ./ -name "$i" -exec modinfo -F depends {} \\; ; done\n')),(0,l.kt)("p",null,"\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u5f97\u5230\u7684\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"iptable_filter.ko depends:\nnf_nat.ko depends:\nnf_defrag_ipv4.ko depends:\nnf_conntrack_ipv4.ko depends:nf_defrag_ipv4\nnf_nat_ipv4.ko depends:nf_nat\niptable_nat.ko depends:nf_nat_ipv4\nip6_tables.ko depends:\nip6table_filter.ko depends:ip6_tables\nnf_nat_ipv6.ko depends:nf_nat\nip6table_nat.ko depends:ip6_tables,nf_nat_ipv6\n")),(0,l.kt)("p",null,"\u4e0a\u9762\u7684\u547d\u4ee4\u884c\u4e2d\u7684 ./ \u6240\u5728\u7684\u76ee\u5f55\u662f\u5df2\u7ecf\u7f16\u8bd1\u8fc7\u7684\u5185\u6838\u7684\u6839\u76ee\u5f55\uff0c\u8f93\u51fa\u4fe1\u606f\u4e2d depends: \u540e\u4e3a\u7a7a\u7684\u9879\u76ee\u8868\u660e\u6b64\u6a21\u5757\u6ca1\u6709\u4f9d\u8d56\u3002"),(0,l.kt)("p",null,"\u6839\u636e\u4e0a\u9762\u8fd9\u4e9b\u4fe1\u606f\uff0c\u8c03\u6574\u52a0\u8f7d\u547d\u4ee4\uff0c\u6d4b\u8bd5\u53d1\u73b0 ipv4 \u7684 iptables \u529f\u80fd\u53ef\u7528\uff0c\u4f46\u662f\u5728\u52a0\u8f7d nf_nat_ipv6 \u6a21\u5757\u65f6\u4f1a\u5931\u8d25\u3002"),(0,l.kt)("h2",{id:"insmod-nf_nat_ipv6-\u6a21\u5757\u5931\u8d25\u7684\u95ee\u9898"},"insmod nf_nat_ipv6 \u6a21\u5757\u5931\u8d25\u7684\u95ee\u9898"),(0,l.kt)("p",null,"\u4ece\u4e0a\u6587\u4e2d\u8bb0\u5f55\u7684 nf_nat_ipv6 \u7684\u6a21\u5757\u4f9d\u8d56\u4fe1\u606f\u53ef\u4ee5\u770b\u51fa\uff0c\u5b83",(0,l.kt)("strong",{parentName:"p"},"\u53ea\u4f9d\u8d56 nf_nat \u6a21\u5757"),"\uff0c\u5728\u52a0\u8f7d\u4e86 nf_nat \u540e\uff0c\u52a0\u8f7d nf_nat_ipv6.ko \u7684\u65f6\u5019\u7adf\u7136\u8fd8\u4f1a\u62a5\u9519\uff01\u9519\u8bef\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"insmod: ERROR: could not insert module nf_nat_ipv6.ko: Protocol wrong type for socket \n")),(0,l.kt)("p",null,"dmesg \u4e5f\u6ca1\u6709\u770b\u5230\u5176\u5b83\u4fe1\u606f\uff0c\u4e00\u901a\u6298\u817e\u53d1\u73b0\uff0c",(0,l.kt)("strong",{parentName:"p"},"nf_nat_ipv6.ko")," \u5bf9\u4e0b\u9762\u8fd9\u4e24\u4e2a ko \u6709\u9690\u5f0f\u7684\u4f9d\u8d56\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"nf_defrag_ipv6 \nnf_conntrack_ipv6\n")),(0,l.kt)("p",null,"\u52a0\u8f7d\u4e86\u8fd9\u4e24\u4e2a ko \u540e\uff0c",(0,l.kt)("strong",{parentName:"p"},"nf_nat_ipv6.ko")," \u5c31\u80fd\u591f\u6b63\u5e38\u52a0\u8f7d\uff0cip6tables \u547d\u4ee4\u4e5f\u80fd\u591f\u6b63\u5e38\u6267\u884c\u3002"),(0,l.kt)("p",null,"\u6700\u7ec8\u7cfb\u7edf\u4e2d\u52a0\u8f7d\u7684 iptables \u76f8\u5173\u9a71\u52a8\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ip6table_nat            2827  0\nnf_nat_ipv6             7249  1 ip6table_nat\nnf_conntrack_ipv6      13000  1\nnf_defrag_ipv6         29882  1 nf_conntrack_ipv6\nip6table_filter         2451  0\nip6_tables             18750  2 ip6table_filter,ip6table_nat\niptable_nat             2838  0\nnf_nat_ipv4             6979  1 iptable_nat\nnf_conntrack_ipv4      19999  1\nnf_defrag_ipv4          2265  1 nf_conntrack_ipv4\nnf_nat                 19269  2 nf_nat_ipv4,nf_nat_ipv6\niptable_filter          2473  0\n")),(0,l.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"\u5728\u641e\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\u65f6\uff0c\u9700\u8981\u4f18\u5148\u8003\u8651\u6709\u6ca1\u6709\u73b0\u6709\u7684\u65b9\u6848\uff0c\u8fd9\u4e9b\u73b0\u6709\u7684\u65b9\u6848\u5e76\u4e0d\u80fd\u89e3\u51b3 100\uff05 \u7684\u95ee\u9898\uff0c\u4f46\u662f\u5b83\u4eec\u80fd\u591f\u63d0\u4f9b\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e00\u4e2a\u57fa\u7ebf\u6570\u636e\uff0c\u6709\u4e86\u8fd9\u4e2a\u57fa\u7ebf\u624d\u80fd\u4fdd\u8bc1\u6211\u4eec\u4e00\u76f4\u5728\u6b63\u786e\u7684\u65b9\u5411\u4e0a\u524d\u8fdb\u3002"),(0,l.kt)("p",null,"\u5728\u672c\u6587\u63cf\u8ff0\u7684\u95ee\u9898\u4e2d\uff0c\u73b0\u5b58\u7684\u53d1\u884c\u7248\u5c31\u662f\u4e00\u4e2a\u73b0\u6709\u7684\u65b9\u6848\uff0c\u901a\u8fc7\u7814\u7a76\u73b0\u6709\u7684\u65b9\u6848\u786e\u5b9a\u57fa\u7ebf\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c\u590d\u5236\u4e0e\u8fc1\u79fb\uff0c\u6700\u7ec8\u8fbe\u6210\u9884\u5b9a\u7684\u9700\u6c42\u3002"),(0,l.kt)("p",null,"\u5f88\u591a\u65f6\u5019\u6211\u4eec\u5e38\u5e38\u5ffd\u7565\u57fa\u7ebf\u6570\u636e\uff0c\u800c\u70ed\u8877\u4e8e\u7814\u7a76\u6280\u672f\u5185\u90e8\u7684\u539f\u7406\uff0c\u5bf9\u4e8e\u7814\u7a76\u6765\u8bf4\u8fd9\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5bf9\u4e8e\u5de5\u4f5c\u6765\u8bf4\uff0c\u5c31\u663e\u5f97\u6709\u4e9b\u4f4e\u6548\u4e86\u3002"))}d.isMDXComponent=!0}}]);