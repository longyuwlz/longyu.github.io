"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[2663],{3905:function(e,n,l){l.d(n,{Zo:function(){return f},kt:function(){return d}});var t=l(7294);function a(e,n,l){return n in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function r(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),l.push.apply(l,t)}return l}function p(e){for(var n=1;n<arguments.length;n++){var l=null!=arguments[n]?arguments[n]:{};n%2?r(Object(l),!0).forEach((function(n){a(e,n,l[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):r(Object(l)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(l,n))}))}return e}function i(e,n){if(null==e)return{};var l,t,a=function(e,n){if(null==e)return{};var l,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)l=r[t],n.indexOf(l)>=0||(a[l]=e[l]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)l=r[t],n.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}var u=t.createContext({}),s=function(e){var n=t.useContext(u),l=n;return e&&(l="function"==typeof e?e(n):p(p({},n),e)),l},f=function(e){var n=s(e.components);return t.createElement(u.Provider,{value:n},e.children)},o={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},x=t.forwardRef((function(e,n){var l=e.components,a=e.mdxType,r=e.originalType,u=e.parentName,f=i(e,["components","mdxType","originalType","parentName"]),x=s(l),d=a,c=x["".concat(u,".").concat(d)]||x[d]||o[d]||r;return l?t.createElement(c,p(p({ref:n},f),{},{components:l})):t.createElement(c,p({ref:n},f))}));function d(e,n){var l=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=l.length,p=new Array(r);p[0]=x;var i={};for(var u in n)hasOwnProperty.call(n,u)&&(i[u]=n[u]);i.originalType=e,i.mdxType="string"==typeof e?e:a,p[1]=i;for(var s=2;s<r;s++)p[s]=l[s];return t.createElement.apply(null,p)}return t.createElement.apply(null,l)}x.displayName="MDXCreateElement"},3777:function(e,n,l){l.r(n),l.d(n,{assets:function(){return f},contentTitle:function(){return u},default:function(){return d},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return o}});var t=l(7462),a=l(3366),r=(l(7294),l(3905)),p=["components"],i={},u="\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",s={unversionedId:"\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",id:"\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",title:"\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",description:"\u524d\u8a00",source:"@site/docs/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93",slug:"/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879",draft:!1,editUrl:"https://github.com/longyuwlz/longyu.github.io/docs/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u52a8\u6001\u5e93/\u4ee5 hook main \u51fd\u6570\u4e3a\u4f8b\u63a2\u8ba8 PRELOAD \u7684\u539f\u7406"},next:{title:"glibc-strlen \u5206\u6790",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/glibc/\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570/glibc-strlen \u5206\u6790"}},f={},o=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u7b2c\u4e00\u4e2a\u95ee\u9898\uff1aprintf \u51fd\u6570\u8c03\u7528\u54ea\u53bb\u4e86\uff1f",id:"\u7b2c\u4e00\u4e2a\u95ee\u9898printf-\u51fd\u6570\u8c03\u7528\u54ea\u53bb\u4e86",level:2},{value:"\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1alazy binding \u7684\u539f\u7406",id:"\u7b2c\u4e8c\u4e2a\u95ee\u9898lazy-binding-\u7684\u539f\u7406",level:2},{value:"\u4ece gdb \u7740\u624b",id:"\u4ece-gdb-\u7740\u624b",level:2},{value:"gdb \u8ddf\u8e2a\u5931\u8d25\u7684\u4e2d\u95f4\u8fc7\u7a0b",id:"gdb-\u8ddf\u8e2a\u5931\u8d25\u7684\u4e2d\u95f4\u8fc7\u7a0b",level:2},{value:"\u7ee7\u7eed\u4f7f\u7528 gdb \u6765\u9a8c\u8bc1\u4e0a\u9762\u7684",id:"\u7ee7\u7eed\u4f7f\u7528-gdb-\u6765\u9a8c\u8bc1\u4e0a\u9762\u7684",level:3},{value:"GOT0 \u5b58\u653e\u4e86\u6307\u5411\u53ef\u6267\u884c\u6587\u4ef6\u52a8\u6001\u6bb5\u7684\u5730\u5740",id:"got0-\u5b58\u653e\u4e86\u6307\u5411\u53ef\u6267\u884c\u6587\u4ef6\u52a8\u6001\u6bb5\u7684\u5730\u5740",level:4},{value:"GOT1 \u5b58\u653e link_map \u7ed3\u6784\u7684\u5730\u5740",id:"got1-\u5b58\u653e-link_map-\u7ed3\u6784\u7684\u5730\u5740",level:4},{value:"GOT2 \u5b58\u653e dl_runtime_resolve \u51fd\u6570\u7684\u5730\u5740",id:"got2-\u5b58\u653e-dl_runtime_resolve-\u51fd\u6570\u7684\u5730\u5740",level:4},{value:"\u5f15\u7528\u591a\u4e2a\u52a8\u6001\u5e93\u7b26\u53f7\u7684\u60c5\u51b5",id:"\u5f15\u7528\u591a\u4e2a\u52a8\u6001\u5e93\u7b26\u53f7\u7684\u60c5\u51b5",level:4},{value:"GOT \u8868\u7684\u4e00\u4e9b\u5176\u5b83\u7279\u70b9",id:"got-\u8868\u7684\u4e00\u4e9b\u5176\u5b83\u7279\u70b9",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],x={toc:o};function d(e){var n=e.components,l=(0,a.Z)(e,p);return(0,r.kt)("wrapper",(0,t.Z)({},x,l,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u52a8\u6001\u94fe\u63a5-lazy-binding-\u7684\u539f\u7406\u4e0e-got-\u8868\u7684\u4fdd\u7559\u8868\u9879"},"\u52a8\u6001\u94fe\u63a5 lazy binding \u7684\u539f\u7406\u4e0e GOT \u8868\u7684\u4fdd\u7559\u8868\u9879"),(0,r.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,r.kt)("p",null,"\u6211\u6700\u8fd1\u5bf9\u52a8\u6001\u5e93\u7684\u5b9e\u73b0\u975e\u5e38\u597d\u5947\uff0c\u81ea\u5df1\u7422\u78e8\u4e86\u534a\u5929\u6ca1\u6709\u770b\u51fa\u4ec0\u4e48\u540d\u5802\uff0c\u5c31\u60f3\u7740\u80fd\u4e0d\n\u80fd\u627e\u5230\u4e00\u672c\u8bb2\u76f8\u5173\u5185\u5bb9\u7684\u4e66\u7c4d\uff0c\u7f51\u4e0a\u641c\u7d22\u4e86\u4e0b\u53d1\u73b0\u786e\u5b9e\u6709\u8fd9\u6837\u7684\u4e00\u672c\u4e66\uff0c\u4e66\u540d\u4e3a\n",(0,r.kt)("strong",{parentName:"p"},"\u300aLinux \u4e8c\u8fdb\u5236\u5206\u6790\u300b"),"\u3002"),(0,r.kt)("p",null,"\u52a8\u6001\u5e93\u7684\u5de5\u4f5c\u539f\u7406\u4ece\u8fd9\u672c\u4e66\u4e2d\u80fd\u591f\u627e\u5230\u89e3\u7b54\uff0c\u5728\u672c\u6587\u4e2d\uff0c\u6211\u5c06\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a hello\n\u7a0b\u5e8f\u6765\u9a8c\u8bc1\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-\uff43"},'#include <stdio.h>\n\nint main(int argc, char* argv[])\n{\n    printf("hello world\\n");\n    return 0;\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u4e00\u4e2a\u95ee\u9898printf-\u51fd\u6570\u8c03\u7528\u54ea\u53bb\u4e86"},"\u7b2c\u4e00\u4e2a\u95ee\u9898\uff1aprintf \u51fd\u6570\u8c03\u7528\u54ea\u53bb\u4e86\uff1f"),(0,r.kt)("p",null,"\u5c06\u4e0a\u8ff0\u7a0b\u5e8f\u4fdd\u5b58\u4e3a hello.c \u540e\u6267\u884c gcc hello.c -o hello \u8fdb\u884c\u7f16\u8bd1\uff0c\u7f16\u8bd1\u540e\u53cd\u6c47\u7f16\n\u7a0b\u5e8f\uff0c\u53d1\u73b0\u6ca1\u6709\u5bf9 printf \u51fd\u6570\u7684\u8c03\u7528\uff0c\u53ea\u6709\u5bf9 puts \u51fd\u6570\u7684\u8c03\u7528\u3002"),(0,r.kt)("p",null,"\u91cd\u65b0\u5ba1\u89c6\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u6211\u53d1\u73b0\u53ef\u80fd\u662f printf \u51fd\u6570\u8c03\u7528\u88ab\u4f18\u5316\u4e3a puts \u51fd\u6570\u4e86\uff0c\u8fd9\u91cc\n\u6211\u6253\u5370 hello world \u5b57\u7b26\u4e32\u4e0d\u9700\u8981\u89e3\u6790\u53c2\u6570\uff0c\u529f\u80fd\u4e0e puts \u51fd\u6570\u4e00\u6837\u3002"),(0,r.kt)("p",null,'\u5c06\u4e0a\u8ff0 printf \u4ee3\u7801\u6539\u4e3a printf("hello world!%d\\n", 1); \u540e\u91cd\u65b0\u7f16\u8bd1\uff0c\u8fd9\u6b21\u6ca1\u6709\u88ab\n\u4f18\u5316\u3002'),(0,r.kt)("p",null,"\u8fdb\u4e00\u6b65\u7684\u6d4b\u8bd5\u53d1\u73b0\uff0c\u5982\u4e0b\u8c03\u7528 printf \u51fd\u6570\u7684\u4ee3\u7801\u4e5f\u5c06\u4f1a\u88ab\u4f18\u5316\u4e3a puts \u51fd\u6570\u8c03\u7528\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'printf("%s\\n", hello world\\n); \n')),(0,r.kt)("p",null,"\u8fd9\u7b97\u662f\u4e00\u4e2a\u7ecf\u9a8c\u3002"),(0,r.kt)("h2",{id:"\u7b2c\u4e8c\u4e2a\u95ee\u9898lazy-binding-\u7684\u539f\u7406"},"\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1alazy binding \u7684\u539f\u7406"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u52a8\u6001\u5e93\u4f7f\u7528\u4e86\u4e00\u79cd lazy binding \u7684\u673a\u5236\uff0c\u771f\u5b9e\u7684\u51fd\u6570\u5730\u5740\u7684\u7ed1\u5b9a\u8fc7\u7a0b\u7531\u7f16\u8bd1\u65f6\n\u63a8\u8fdf\u5230\u8fd0\u884c\u540e\u7684\u7b2c\u4e00\u6b21\u8c03\u7528\u65f6\uff0c\u4f7f\u7528\u52a8\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7b26\u53f7\u7684\u7b2c\u4e00\u6b21\n\u5f15\u7528\u4e0e\u7b2c\u4e8c\u6b21\u5f15\u7528\u6709\u4e0d\u540c\u7684\u884c\u4e3a\uff0c\u7b2c\u4e00\u6b21\u5f15\u7528\u4f1a\u6267\u884c\u7ed1\u5b9a\u64cd\u4f5c\uff0c\u7b2c\u4e8c\u6b21\u5f15\u7528\u5219\n\u76f4\u63a5\u8df3\u8f6c\u6267\u884c\u3002")),(0,r.kt)("p",null,"\u8fd9\u91cc\u6709\u4e00\u4e2a\u95ee\u9898\u2014\u2014 lazy binding \u6709\u600e\u6837\u7684\u8fc7\u7a0b\u5462\uff1f"),(0,r.kt)("h2",{id:"\u4ece-gdb-\u7740\u624b"},"\u4ece gdb \u7740\u624b"),(0,r.kt)("p",null,"\u6267\u884c gcc -g -no-pie hello.c -o hello \u7f16\u8bd1\u4e0a\u8ff0\u7a0b\u5e8f\uff0c\u7f16\u8bd1\u540e\u4f7f\u7528 gdb \u8fd0\u884c\u3002"),(0,r.kt)("p",null,"\u8ba9\u7a0b\u5e8f\u6267\u884c\u5230\u8c03\u7528 puts@plt \u4ee3\u7801\u7684\u5982\u4e0b\u6307\u4ee4\u5904\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"=> 0x0000000000401138 <+22>:    callq  0x401030 <puts@plt>\n")),(0,r.kt)("p",null,"\u6267\u884c si \u5355\u6b65\u8fd0\u884c\u7a0b\u5e8f\uff0c\u8fdb\u5165\u5230 puts@plt \u51fd\u6570\u4e2d\uff0c\u53cd\u6c47\u7f16 puts@plt \u51fd\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) si\n0x0000000000401030 in puts@plt ()\n(gdb) disass\nDump of assembler code for function puts@plt:\n=> 0x0000000000401030 <+0>: jmpq   *0x2fe2(%rip)        # 0x404018 <puts@got.plt>\n   0x0000000000401036 <+6>: pushq  $0x0\n   0x000000000040103b <+11>:    jmpq   0x401020\n")),(0,r.kt)("p",null,"\u67e5\u770b 0x404018 \u5730\u5740\u5b58\u50a8\u7684\u503c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) x 0x404018\n0x404018 <puts@got.plt>:    0x00401036\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5b83\u5b58\u50a8\u7684\u503c\u662f 0x401036\uff0c\u8fd9\u4e2a\u5730\u5740\u5c31\u662f puts@plt \u51fd\u6570\u7684\u7b2c\u4e8c\u884c\n\u6307\u4ee4\u5730\u5740\u3002"),(0,r.kt)("p",null,"\u7ee7\u7eed\u6267\u884c si\uff0c\u6267\u884c\u540e\u7ee7\u7eed\u53cd\u6c47\u7f16\u67e5\u770b\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u786e\u8ba4\u7a0b\u5e8f\u786e\u5b9e\u8df3\u8f6c\u5230\u4e86 puts@plt \u7684\n\u7b2c\u4e8c\u6761\u6307\u4ee4\u5904\u3002")," \u76f8\u5173\u8fc7\u7a0b\u8bb0\u5f55\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) si\n0x0000000000401036 in puts@plt ()\n(gdb) disass\nDump of assembler code for function puts@plt:\n   0x0000000000401030 <+0>: jmpq   *0x2fe2(%rip)        # 0x404018 <puts@got.plt>\n=> 0x0000000000401036 <+6>: pushq  $0x0\n   0x000000000040103b <+11>:    jmpq   0x401020\nEnd of assembler dump.\n")),(0,r.kt)("p",null,"\u7ee7\u7eed\u5355\u6b65\u540e\uff0c\u6267\u884c\u6700\u540e\u4e00\u884c\u8df3\u8f6c\u6307\u4ee4\u540e gdb \u770b\u4e0d\u5230\u5176\u5b83\u4fe1\u606f\u4e86\uff0c\u8fd9\u65f6\u6253\u65ad\u70b9\n\u8ba9\u7a0b\u5e8f\u76f4\u63a5\u8fd0\u884c\u5b8c puts \u51fd\u6570\uff0c\u8fd0\u884c\u5b8c\u540e\uff0c\u91cd\u65b0\u67e5\u770b 0x404018 \u8fd9\u4e2a\u5730\u5740\n\u5b58\u50a8\u7684\u503c\uff0c\u83b7\u53d6\u5230\u4e86\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) x 0x404018\n0x404018 <puts@got.plt>:    0xf7e5a910\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230 0x404018 \u5730\u5740\u4e2d\u5b58\u50a8\u7684\u503c\u88ab\u4fee\u6539\u4e86\uff0c\u53d8\u4e3a\u4e86 0xf7e5a910\uff0c\u8fd9\u4e2a\n\u5730\u5740\u6b63\u662f puts \u51fd\u6570\u7684\u5730\u5740\u3002"),(0,r.kt)("p",null,"disass puts \u51fd\u6570\u5f97\u5230\u4e86\u5982\u4e0b\u4fe1\u606fi\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) disass puts\nDump of assembler code for function __GI__IO_puts:\nAddress range 0x7ffff7e5a910 to 0x7ffff7e5aaad:\n   0x00007ffff7e5a910 <+0>: push   %r14\n")),(0,r.kt)("p",null,"\u89c2\u5bdf puts \u51fd\u6570\u5730\u5740\u7684\u540e 32 \u4f4d\uff0c\u5176\u6570\u503c\u4e0e 0x404018 \u5730\u5740\u5904\u5b58\u50a8\u7684\u5730\u5740\n\u662f\u76f8\u540c\u7684\uff0c\u8fd9\u91cc\u6211\u7684\u7cfb\u7edf\u662f x86_64 \u67b6\u6784\uff0c\u5176\u865a\u62df\u5185\u5b58\u4f4d\n\u6570\u4e3a 48 \u4f4d\uff0c\u4ece\u5185\u6838\u6e90\u7801\u6811\u4e2d ",(0,r.kt)("strong",{parentName:"p"},"Documentation/x86/x86_64/mm.txt"),"  \u4e2d\u53ef\n\u4ee5\u83b7\u77e5\uff0c\u5bf9\u4e8e\u56db\u7ea7\u9875\u8868\uff0c\u7528\u6237\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5b9e\u9645\u662f 47 \u4f4d\u5bbd\u6bb5\u3002"),(0,r.kt)("p",null,"\u76f8\u5173\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-manual"},"Virtual memory map with 4 level page tables:\n\n0000000000000000 - 00007fffffffffff (=47 bits) user space, different per mm\nhole caused by [47:63] sign extension\n")),(0,r.kt)("p",null,"\u9875\u8868\u7ea7\u6570\u53ef\u4ee5\u662f\u901a\u8fc7 ",(0,r.kt)("strong",{parentName:"p"},"CONFIG_PGTABLE_LEVELS")," \u914d\u7f6e\u9879\u76ee\u6765\u63a7\u5236\n\u7684\uff0c\u5728\u6211\u7684\u7cfb\u7edf\u4e2d\u5176\u503c\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-manual"},"/boot/config-4.19.0-11-amd64:CONFIG_PGTABLE_LEVELS=4\n")),(0,r.kt)("p",null,"\u5c06 0xf7d5a910 \u7b26\u53f7\u6269\u5c55\u5230 47 \u4f4d\u5c31\u4f1a\u5f97\u5230 0x00007ffff7e5a910 \u8fd9\u4e2a\u5730\u5740\uff0c\n\u5b83\u6b63\u662f puts \u51fd\u6570\u6620\u5c04\u5230\u5185\u5b58\u4e2d\u7684\u5730\u5740\u3002"),(0,r.kt)("p",null,"\u8fd9\u5176\u5b9e\u5c31\u662f lazy binding \u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5b83\u4f1a\u5728\u7b26\u53f7\u7b2c\u4e00\u6b21\u88ab\u5f15\u7528\u7684\u65f6\u5019\u7ed1\n\u5b9a\u7b26\u53f7\u7684\u5730\u5740\uff0c\u4e4b\u540e\u7684\u8bbf\u95ee\u7531\u4e8e\u5730\u5740\u5df2\u7ecf\u7ed1\u5b9a\u5b8c\u6210\uff0c\u4f1a\u76f4\u63a5\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\n\u51fd\u6570\u6267\u884c\u3002"),(0,r.kt)("h2",{id:"gdb-\u8ddf\u8e2a\u5931\u8d25\u7684\u4e2d\u95f4\u8fc7\u7a0b"},"gdb \u8ddf\u8e2a\u5931\u8d25\u7684\u4e2d\u95f4\u8fc7\u7a0b"),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u53d9\u8ff0\u4e2d\uff0c\u5728 puts@plt \u7684\u6700\u540e\u4e00\u884c\u8df3\u8f6c\u6307\u5b9a\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5230 puts \u6267\n\u884c\u5b8c\u6210\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u7684\u64cd\u4f5c\u662f\u4e00\u4e2a\u9ed1\u76d2\uff0c\u4f7f\u7528 gdb \u8ddf\u4e22\u4e86\u3002"),(0,r.kt)("p",null,"\u8fd9\u91cc\u6211\u9996\u5148\u6267\u884c objdump \u53cd\u6c47\u7f16 hello \u7a0b\u5e8f\u6765\u7814\u7a76\u4e00\u4e0b\uff0c\u53cd\u6c47\u7f16\u7684\u8f93\u51fa\u4e2d\n\u4e0e\u8fd9\u4e2a\u95ee\u9898\u76f8\u5173\u7684\u90e8\u5206\u4fe1\u606f\u6458\u5f55\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Disassembly of section .plt:\n\n0000000000401020 <.plt>:\n  401020:       ff 35 e2 2f 00 00       pushq  0x2fe2(%rip)        # 404008 <_GLOBAL_OFFSET_TABLE_+0x8>\n  401026:       ff 25 e4 2f 00 00       jmpq   *0x2fe4(%rip)        # 404010 <_GLOBAL_OFFSET_TABLE_+0x10>\n  40102c:       0f 1f 40 00             nopl   0x0(%rax)\n\n0000000000401030 <puts@plt>:\n  401030:       ff 25 e2 2f 00 00       jmpq   *0x2fe2(%rip)        # 404018 <puts@GLIBC_2.2.5>\n  401036:       68 00 00 00 00          pushq  $0x0\n  40103b:       e9 e0 ff ff ff          jmpq   401020 <.plt>\n")),(0,r.kt)("p",null,"\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230 puts@plt \u51fd\u6570\u7684\u6700\u540e\u4e00\u4e2a\u8df3\u8f6c\u8bed\u53e5\u5b9e\u9645\u4e0a\u8df3\u8f6c\u5230\u4e86 .plt\nsection \u4e2d\uff0c\u8fd9\u4e2a section \u7684\u7b2c\u4e00\u884c\u6307\u4ee4\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"_GLOBAL_OFFSET_TABLE_+ 0x8"),"\n\u7684\u503c\u538b\u6808\uff0c\u7136\u540e\u53c8\u8df3\u8f6c\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"_GLOBAL_OFFSET_TABLE_ + 0x10"),"\u6307\u5411\u7684\u51fd\u6570\n\u5904\u6267\u884c\u3002"),(0,r.kt)("p",null,"\u8fd9\u91cc 0x8 \u4e0e 0x10 \u662f\u8fde\u7eed\u7684\u4e24\u4e2a 8 \u5b57\u8282\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u5982\u679c\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2a 8 \u5b57\u8282\n\u770b\u505a\u662f\u4e00\u4e2a\u8868\u9879"),"\uff0c\u90a3\u4e48\u8fd9\u91cc\u65f6\u95f4\u4e0a\u5c31\u662f\u4f7f\u7528\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"_GLOBAL_OFFSET_TABLE_ "),"\n\u8868\u7684\u8868\u9879 1\uff0c\u4e0e\u8868\u9879 2\uff0c\u53ef\u4ee5\u7b80\u5199\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"GOT","[1]","\uff0cGOT","[2]"),"\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u8fd9\u4e2a ",(0,r.kt)("inlineCode",{parentName:"strong"},"_GLOBAL_OFFSET_TABLE_"),"\u662f\u5565\u4e1c\u4e1c\u5462\uff1f")),(0,r.kt)("p",null,"\u5176\u5b9e\u5b83\u5c31\u662f",(0,r.kt)("strong",{parentName:"p"},"\u5168\u5c40\u7684 got \u8868"),"\uff0c\u7a0b\u5e8f\u4e2d\u5f15\u7528\u7684\u6bcf\u4e00\u4e2a\u52a8\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u90fd\u5728\n\u8fd9\u4e2a\u5168\u5c40\u7684 got \u8868\u4e2d\u5360\u636e\u4e00\u4e2a\u8868\u9879\uff0c\u52a8\u6001\u5e93\u94fe\u63a5\u5668\u4f1a\u5728\u7b26\u53f7\u7b2c\u4e00\u6b21\u88ab\u5f15\u7528\n\u7684\u65f6\u5019\u5bf9\u7b26\u53f7\u7684\u5730\u5740\u8fdb\u884c\u89e3\u6790\uff0c\u5e76\u628a\u89e3\u6790\u51fa\u6765\u7684\u7b26\u53f7\u5730\u5740\u5b58\u5230\u7b26\u53f7\u5360\u636e\u7684\ngot \u8868\u9879\u4e2d\u3002"),(0,r.kt)("p",null,"\u8fd9\u91cc puts@plt \u51fd\u6570\u7684\u7b2c\u4e8c\u884c\u5c06 0 \u538b\u6808\uff0c\u8fd9\u4e2a 0 \u8868\u793a\u7684\u5c31\u662f puts@plt \u5728\nGOT \u8868\u4e2d\u7684\u4f4d\u7f6e\uff0c\u4e0d\u8fc7\u5b83\u5e76\u4e0d\u50cf\u6211\u4eec\u60f3\u7684\u90a3\u6837\u6307\u5411 GOT","[0]","\uff0c\u800c\u662f\u6307\u5411\nGOT","[3]","\u3002"),(0,r.kt)("p",null,"GOT \u8868\u4e2d\u7684\u524d\u51e0\u9879\u6709\u7279\u6b8a\u7684\u4f5c\u7528\uff0c\u76f8\u5173\u5185\u5bb9\u6458\u81ea\u300aLinux \u4e8c\u8fdb\u5236\u5206\u6790\u300b\n\u4e00\u4e66\uff0c\u63cf\u8ff0\u5982\u4e0b\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"GOT","[0]",":\u5b58\u653e\u4e86\u6307\u5411\u53ef\u6267\u884c\u6587\u4ef6\u52a8\u6001\u6bb5\u7684\u5730\u5740,\u52a8\u6001\u94fe\n\u63a5\u5668\u5229\u7528\u8be5\u5730\u5740\u63d0\u53d6\u52a8\u6001\u94fe\u63a5\u76f8\u5173\u7684\u4fe1\u606f\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"GOT","[1]",":\u5b58\u653e link_map \u7ed3\u6784\u7684\u5730\u5740,\u52a8\u6001\u94fe\u63a5\u5668\u5229\u7528\u8be5\u5730\u5740\u6765\u5bf9\u7b26\u53f7\u8fdb\u884c\u89e3\u6790\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"GOT","[2]",":\u5b58\u653e\u4e86\u6307\u5411\u52a8\u6001\u94fe\u63a5\u5668 _dl_runtime_resolve()\n\u51fd\u6570\u7684\u5730\u5740,\u8be5\u51fd\u6570\u7528\u6765\u89e3\u6790\u5171\u4eab\u5e93\u51fd\u6570\u7684\u5b9e\u9645\u7b26\u53f7\u5730\u5740")),(0,r.kt)("p",null,"\u5728\u8fd9\u4e2a hello \u7a0b\u5e8f\u4e2d\uff0cputs \u51fd\u6570\u5b9e\u9645\u5360\u636e\u7684\u662f GOT","[3]"," \u8fd9\u4e2a\u9879\u76ee\u3002"),(0,r.kt)("h3",{id:"\u7ee7\u7eed\u4f7f\u7528-gdb-\u6765\u9a8c\u8bc1\u4e0a\u9762\u7684"},"\u7ee7\u7eed\u4f7f\u7528 gdb \u6765\u9a8c\u8bc1\u4e0a\u9762\u7684"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4e0a\u9762\u9648\u8ff0\u7684 GOT","[0]","\u3001GOT","[1]","\u3001GOT","[2]"," \u4fdd\u5b58\u7684\u5185\u5bb9\u5176\u5b9e\u9645\u60c5\u51b5\n\u7a76\u7adf\u662f\u600e\u6837\u7684\u5462\uff1f\u6211\u4e0b\u9762\u7ee7\u7eed\u901a\u8fc7\u4f7f\u7528 gdb \u6765\u786e\u8ba4\u3002"),(0,r.kt)("h4",{id:"got0-\u5b58\u653e\u4e86\u6307\u5411\u53ef\u6267\u884c\u6587\u4ef6\u52a8\u6001\u6bb5\u7684\u5730\u5740"},"GOT","[0]"," \u5b58\u653e\u4e86\u6307\u5411\u53ef\u6267\u884c\u6587\u4ef6\u52a8\u6001\u6bb5\u7684\u5730\u5740"),(0,r.kt)("p",null,"\u9996\u5148\u4f7f\u7528 gdb \u6253\u5370\u51fa GOT","[0]"," \u5730\u5740\u4e2d\u5b58\u50a8\u7684\u503c\uff0c\u786e\u5b9a\u8fd9\u4e2a\u503c\u662f 0x403e20\u3002\n\u76f8\u5173\u4fe1\u606f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) x 0x404000\n0x404000:   0x00403e20\n")),(0,r.kt)("p",null,"\u7136\u540e\u6211\u901a\u8fc7\u751f\u6210 map \u6587\u4ef6\u6765\u67e5\u770b\u7a0b\u5e8f\u52a8\u6001\u6bb5\u7684\u5730\u5740\uff0c\u9a8c\u8bc1\u786e\u5b9e\u662f 0x403e20\uff0c\n\u8fc7\u7a0b\u8bb0\u5f55\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gcc -no-pie -g ./hello.c -Wl,-Map=output.map -o hello\n\n[longyu@debian-10:22:03:01] cwd $ grep '.dynamic' output.map \n.dynamic        0x0000000000403e20      0x1d0\n *(.dynamic)\n .dynamic       0x0000000000403e20      0x1d0 /usr/lib/gcc/x86_64-linux-gnu/8/../../../x86_64-linux-gnu/crt1.o\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"GOT","[0]"," \u7684\u63cf\u8ff0\u6210\u7acb\uff01")),(0,r.kt)("h4",{id:"got1-\u5b58\u653e-link_map-\u7ed3\u6784\u7684\u5730\u5740"},"GOT","[1]"," \u5b58\u653e link_map \u7ed3\u6784\u7684\u5730\u5740"),(0,r.kt)("p",null,"\u7ee7\u7eed\u7528 x \u547d\u4ee4\u6253\u5370 GOT","[1]"," \u7684\u503c\uff0c\u83b7\u53d6\u5230\u4e86\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) x 0x404008\n0x404008:   0xf7ffe190\n")),(0,r.kt)("p",null,"\u540c\u6837\u5bf9\u8fd9\u4e2a\u503c\u8fdb\u884c\u7b26\u53f7\u6269\u5c55\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u5730\u5740\u5f3a\u8f6c\u4e3a\u4e00\u4e2a link_map\n\u7ed3\u6784\u4f53\uff0c\u6253\u5370\u6b64\u7ed3\u6784\u4f53\u7684\u5185\u5bb9\uff0c\u8bb0\u5f55\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(gdb) print /x *(struct link_map *)0x7ffff7ffe190\n$2 = {l_addr = 0x0, l_name = 0x7ffff7ffe728, l_ld = 0x403e20, l_next = 0x7ffff7ffe730, l_prev = 0x0, l_real = 0x7ffff7ffe190, l_ns = 0x0, l_libname = 0x7ffff7ffe710, \n  l_info = {0x0, 0x403e20, 0x403f00, 0x403ef0, 0x0, 0x403ea0, 0x403eb0, 0x403f30, 0x403f40, 0x403f50, 0x403ec0, 0x403ed0, 0x403e30, 0x403e40, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, \n    0x403f10, 0x403ee0, 0x0, 0x403f20, 0x0, 0x403e50, 0x403e70, 0x403e60, 0x403e80, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x403f70, 0x403f60, 0x0 <repeats 13 times>, 0x403f80, \n    0x0 <repeats 25 times>, 0x403e90}, l_phdr = 0x400040, l_entry = 0x401040, l_phnum = 0xb, l_ldnum = 0x0, l_searchlist = {r_list = 0x7ffff7faa520, r_nlist = 0x3}, \n  l_symbolic_searchlist = {r_list = 0x7ffff7ffe708, r_nlist = 0x0}, l_loader = 0x0, l_versions = 0x7ffff7faa540, l_nversions = 0x3, l_nbuckets = 0x1, \n  l_gnu_bitmask_idxbits = 0x0, l_gnu_shift = 0x0, l_gnu_bitmask = 0x400318, {l_gnu_buckets = 0x400320, l_chain = 0x400320}, {l_gnu_chain_zero = 0x400320, \n    l_buckets = 0x400320}, l_direct_opencount = 0x1, l_type = 0x0, l_relocated = 0x1, l_init_called = 0x1, l_global = 0x1, l_reserved = 0x0, l_phdr_allocated = 0x0, \n  l_soname_added = 0x0, l_faked = 0x0, l_need_tls_init = 0x0, l_auditing = 0x0, l_audit_any_plt = 0x0, l_removed = 0x0, l_contiguous = 0x0, \n  l_symbolic_in_local_scope = 0x0, l_free_initfini = 0x0, l_cet = 0x0, l_rpath_dirs = {dirs = 0xffffffffffffffff, malloced = 0x0}, l_reloc_result = 0x0, \n  l_versyms = 0x4003c6, l_origin = 0x0, l_map_start = 0x400000, l_map_end = 0x404038, l_text_end = 0x4011bd, l_scope_mem = {0x7ffff7ffe450, 0x0, 0x0, 0x0}, \n  l_scope_max = 0x4, l_scope = 0x7ffff7ffe4f0, l_local_scope = {0x7ffff7ffe450, 0x0}, l_file_id = {dev = 0x0, ino = 0x0}, l_runpath_dirs = {dirs = 0xffffffffffffffff, \n    malloced = 0x0}, l_initfini = 0x7ffff7faa500, l_reldeps = 0x0, l_reldepsmax = 0x0, l_used = 0x1, l_feature_1 = 0x0, l_flags_1 = 0x0, l_flags = 0x0, l_idx = 0x0, \n  l_mach = {plt = 0x0, gotplt = 0x0, tlsdesc_table = 0x0}, l_lookup_cache = {sym = 0x400370, type_class = 0x4, value = 0x0, ret = 0x0}, l_tls_initimage = 0x0, \n  l_tls_initimage_size = 0x0, l_tls_blocksize = 0x0, l_tls_align = 0x0, l_tls_firstbyte_offset = 0x0, l_tls_offset = 0x0, l_tls_modid = 0x0, l_tls_dtor_count = 0x0, \n  l_relro_addr = 0x403e10, l_relro_size = 0x1f0, l_serial = 0x0, l_audit = 0x7ffff7ffe608}\n")),(0,r.kt)("p",null,"\u770b\u5230\u8fd9\u4e2a\u7ed3\u6784\u5e76\u4e0d\u80fd\u8bf4\u660e GOT","[1]"," \u7684\u503c\u662f\u6307\u5411\u4e00\u4e2a link_map \u7ed3\u6784\u4f53\n\u7684\u6307\u9488\uff0c\u4e0d\u8fc7\u770b\u4e0a\u53bb link_map \u662f\u4e2a\u975e\u5e38\u590d\u6742\u7684\u7ed3\u6784\u4f53\uff0c\u8fd9\u662f\u6211\u7684\u7b2c\n\u4e00\u5370\u8c61\u3002"),(0,r.kt)("p",null,"\u518d\u68c0\u89c6\u4e0a\u9762\u7684\u8f93\u51fa\uff0c\u6211\u6ce8\u610f\u5230\u4e86\u5982\u4e0b\u5b57\u6bb5\u53ca\u5176\u503c\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"l_entry = 0x401040")),(0,r.kt)("p",null,"\u8fd9\u4e2a\u5b57\u6bb5\u770b\u4e0a\u53bb\u5e94\u8be5\u662f\u67d0\u67d0\u5165\u53e3\uff0c\u7ee7\u7eed\u4f7f\u7528 x \u547d\u4ee4\u6253\u5370\u8fd9\u4e2a\u5730\u5740\u7684\u503c\uff0c\n\u83b7\u53d6\u5230\u4e86\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) x 0x401040\n0x401040 <_start>:  0x8949ed31\n")),(0,r.kt)("p",null,"_start \u8fd9\u6b63\u662f\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u4ece\u8fd9\u70b9\u4e0a\u8bf4\u660e ",(0,r.kt)("strong",{parentName:"p"},"GOT","[1]"," \u7684\u63cf\u8ff0\u53ef\u4fe1"),"\u3002"),(0,r.kt)("h4",{id:"got2-\u5b58\u653e-dl_runtime_resolve-\u51fd\u6570\u7684\u5730\u5740"},"GOT","[2]"," \u5b58\u653e dl_runtime_resolve \u51fd\u6570\u7684\u5730\u5740"),(0,r.kt)("p",null,"\u4ecd\u65e7\u4f7f\u7528\u4e0e\u4e0a\u9762\u76f8\u540c\u7684\u65b9\u6cd5\u8fdb\u884c\u9a8c\u8bc1\uff0c\u83b7\u53d6\u5230\u4e86\u5982\u4e0b\u4fe1\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) x 0x404010\n0x404010:   0xf7fea500\n(gdb) x 0x7ffff7fea500\n0x7ffff7fea500 <_dl_runtime_resolve_xsavec>:    0xe3894853\n(gdb) disas _dl_runtime_resolve_xsavec\nDump of assembler code for function _dl_runtime_resolve_xsavec:\n   0x00007ffff7fea500 <+0>: push   %rbx\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230 GOT","[2]"," \u4e2d\u5b58\u653e\u4e86 _dl_runtime_resolve_xsavec \u51fd\u6570\u7684\u5730\u5740\uff0c\n\u8fd9\u4e2a\u51fd\u6570\u4e0e dl_runtime_resolve \u5e76\u4e0d\u76f8\u540c\uff0c\u6211\u4f7f\u7528 gdb \u8865\u5168\u529f\u80fd\u53d1\u73b0\uff0c\n\u80fd\u591f\u627e\u5230\u4e0b\u9762 3 \u4e2a\u4e0d\u540c\u7c7b\u578b\u7684\u51fd\u6570\u3002 "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(gdb) disass _dl_runtime_resolve\n_dl_runtime_resolve_fxsave  _dl_runtime_resolve_xsave   _dl_runtime_resolve_xsavec\n")),(0,r.kt)("p",null,"\u770b\u6765\u5e94\u8be5\u662f\u9488\u5bf9\u4e0d\u540c\u7684\u6307\u4ee4\u96c6\u7f16\u5199\u7684\u4e0d\u540c\u5b9e\u73b0\uff0c",(0,r.kt)("strong",{parentName:"p"},"GOT","[2]"," \u7684\u63cf\u8ff0\u9a8c\u8bc1\u901a\u8fc7"),"\uff01"),(0,r.kt)("h4",{id:"\u5f15\u7528\u591a\u4e2a\u52a8\u6001\u5e93\u7b26\u53f7\u7684\u60c5\u51b5"},"\u5f15\u7528\u591a\u4e2a\u52a8\u6001\u5e93\u7b26\u53f7\u7684\u60c5\u51b5"),(0,r.kt)("p",null,"\u4e0a\u6587\u4e2d\u6211\u8bf4\u660e\u4e86 puts \u51fd\u6570\u5c06\u4f1a\u6307\u5411 GOT","[3]"," \u7684\u8868\u9879\uff0c\u6211\u4f7f\u7528\u7684 demo \u91cc\n\u53ea\u6709 printf \u8fd9\u4e00\u4e2a\u52a8\u6001\u5e93\u51fd\u6570\uff0c\u90a3\u5bf9\u4e8e\u591a\u4e2a\u52a8\u6001\u5e93\u51fd\u6570\u7684\u5f15\u7528\uff0c\u6240\u5360\u636e\u7684\nGOT \u8868\u9879\u662f\u600e\u6837\u7684\u5462\uff1f"),(0,r.kt)("p",null,"\u4e3a\u4e86\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u5c06\u4e0a\u9762\u7684 hello.c \u4ee3\u7801\u4fee\u6539\u4e3a\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'#include <stdio.h>\n#include <unistd.h>\n\nint main(int argc, char* argv[])\n{\n    printf("hello world\\n");\n\n    pause();\n\n    return 0;\n}\n')),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u589e\u52a0\u4e86\u4e00\u4e2a\u5bf9 pause \u51fd\u6570\u7684\u8c03\u7528\uff0c\u7ee7\u7eed\u6267\u884c\ngcc -no-pie -g hello.c -o hello \u6765\u7f16\u8bd1\uff0c\u7f16\u8bd1\u5b8c\u6210\u540e\u53cd\u6c47\u7f16\u80fd\u591f\u5f97\u5230\\\n\u5982\u4e0b\u76f8\u5173\u7684\u4fe1\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"0000000000401030 <puts@plt>:\n  401030:       ff 25 e2 2f 00 00       jmpq   *0x2fe2(%rip)        # 404018 <puts@GLIBC_2.2.5>\n  401036:       68 00 00 00 00          pushq  $0x0\n  40103b:       e9 e0 ff ff ff          jmpq   401020 <.plt>\n\n0000000000401040 <pause@plt>:\n  401040:       ff 25 da 2f 00 00       jmpq   *0x2fda(%rip)        # 404020 <pause@GLIBC_2.2.5>\n  401046:       68 01 00 00 00          pushq  $0x1\n  40104b:       e9 d0 ff ff ff          jmpq   401020 <.plt>\n")),(0,r.kt)("p",null,"\u8fd9\u91cc gcc \u751f\u6210\u4e86 puts@plt \u4e0e pause@plt \u8fd9\u4e24\u4e2a\u51fd\u6570\uff0c\u6ce8\u610f\u8fd9\u4e24\u4e2a\n\u51fd\u6570\u7684\u7b2c\u4e8c\u884c\u6307\u4ee4\uff01 "),(0,r.kt)("p",null,"puts@plt \u5c06 0 \u538b\u6808\uff0cpause@plt \u5c06 1 \u538b\u6808\uff0c\u8fd9\u4e2a\u6570\u5b57\u6211\u5728\u4e0a\u6587\u4e2d\n\u5df2\u7ecf\u63d0\u5230\u8fc7\uff0c\u5b83\u4ee3\u8868\u7684\u662f\u7b26\u53f7\u5728 GOT \u8868\u4e2d\u7684\u4e0b\u6807\uff0c\u6700\u7ec8\u7684\u503c\u5e94\n\u8be5\u662f\u8df3\u8fc7\u524d\u4e09\u4e2a\u4fdd\u7559\u5143\u7d20\u7684\u503c\uff0c\u5728\u8fd9\u91cc\u5c31\u6709\u5982\u4e0b\u5bf9\u5e94\u5173\u7cfb\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"puts@plt-----\x3eGOT[3]\n\npause@plt----\x3eGOT[4]\n")),(0,r.kt)("p",null,"\u8fd9\u6837\u5c31\u5c06\u6240\u6709\u7684\u8fc7\u7a0b\u4e32\u8054\u8d77\u6765\u4e86\u3002"),(0,r.kt)("h3",{id:"got-\u8868\u7684\u4e00\u4e9b\u5176\u5b83\u7279\u70b9"},"GOT \u8868\u7684\u4e00\u4e9b\u5176\u5b83\u7279\u70b9"),(0,r.kt)("p",null,"\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u4fee\u6539\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u7684 GOT(Global Offset Table, \u5168\n\u5c40\u504f\u79fb\u8868)\u3002GOT \u4f4d\u4e8e\u6570\u636e\u6bb5(.got.plt \u8282)\u4e2d\uff0c\u56e0\u4e3a GOT \u5fc5\u987b\u662f\u53ef\n\u5199\u7684(\u81f3\u5c11\u6700\u521d\u662f\u53ef\u5199\u7684\uff0c\u53ef\u4ee5\u5c06\u53ea\u8bfb\u91cd\u5b9a\u4f4d\u770b\u505a\u4e00\u79cd\u5b89\u5168\u7279\u6027)\uff0c\n\u6545\u800c\u4f4d\u4e8e\u6570\u636e\u6bb5\u4e2d\u3002\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u4f7f\u7528\u89e3\u6790\u597d\u7684\u5171\u4eab\u5e93\u5730\u5740\u6765\u4fee\n\u6539 GOT\u3002"),(0,r.kt)("p",null,"\u8fd9\u6837\u7684\u884c\u4e3a\u8ba9\u52a8\u6001\u5e93\u7684\u52a0\u8f7d\u6709\u66f4\u597d\u7684\u6027\u80fd\uff0c\u4f46\u4e5f\u53ef\u80fd\u5c06\u4e00\u4e9b\u95ee\u9898\n\u7684\u66b4\u9732\u65f6\u95f4\u63a8\u8fdf\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u5b9a LD_BIND_NOW\n\u73af\u5883\u53d8\u91cf\u6765\u901a\u77e5\u52a8\u6001\u5e93\u94fe\u63a5\u5668\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\u5c31\u5b8c\u6210\u6240\u6709\u7b26\u53f7\n\u7684\u7ed1\u5b9a\uff0c\u800c\u4e0d\u662f\u5728\u7b26\u53f7\u7b2c\u4e00\u6b21\u88ab\u5f15\u7528\u65f6\u624d\u8fdb\u884c\u7ed1\u5b9a\u3002\n\uff08\u90e8\u5206\u5185\u5bb9\u6458\u81ea\u300aLinux \u4e8c\u8fdb\u5236\u5206\u6790\u300b\uff09"),(0,r.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("p",null,"\u52a8\u6001\u5e93 lazy binding \u7684\u539f\u7406\u5927\u81f4\u641e\u6e05\u695a\u4e86\uff0c\u4f46\u662f\u5bf9\u4e0e\u52a8\u6001\u5e93\u94fe\u63a5\u5668\u7684\n\u6267\u884c\u8fc7\u7a0b\u5374\u4e00\u70b9\u4e5f\u4e0d\u6e05\u695a\uff0c\u4ee5\u524d\u5bf9\u52a8\u6001\u5e93\u7684\u539f\u7406\u4e0d\u6e05\u695a\uff0c\u89c9\u5f97\u597d\u50cf\u633a\n\u7b80\u5355\u7684\uff0c\u73b0\u5728\u5355\u770b\u770b link_map \u63a5\u53e3\u4f53\u5c31\u6709\u70b9\u5934\u5927\uff0c\u771f\u662f\u77e5\u9053\u7684\u8d8a\u591a\n\u8d8a\u660e\u767d\u81ea\u5df1\u4e0d\u77e5\u9053\u7684\u8d8a\u591a\uff01"))}d.isMDXComponent=!0}}]);