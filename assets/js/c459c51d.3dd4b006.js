"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[795],{3905:function(n,t,e){e.d(t,{Zo:function(){return k},kt:function(){return m}});var r=e(7294);function l(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function i(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?i(Object(e),!0).forEach((function(t){l(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function o(n,t){if(null==n)return{};var e,r,l=function(n,t){if(null==n)return{};var e,r,l={},i=Object.keys(n);for(r=0;r<i.length;r++)e=i[r],t.indexOf(e)>=0||(l[e]=n[e]);return l}(n,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)e=i[r],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(l[e]=n[e])}return l}var p=r.createContext({}),s=function(n){var t=r.useContext(p),e=t;return n&&(e="function"==typeof n?n(t):a(a({},t),n)),e},k=function(n){var t=s(n.components);return r.createElement(p.Provider,{value:t},n.children)},c={inlineCode:"code",wrapper:function(n){var t=n.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(n,t){var e=n.components,l=n.mdxType,i=n.originalType,p=n.parentName,k=o(n,["components","mdxType","originalType","parentName"]),u=s(e),m=l,_=u["".concat(p,".").concat(m)]||u[m]||c[m]||i;return e?r.createElement(_,a(a({ref:t},k),{},{components:e})):r.createElement(_,a({ref:t},k))}));function m(n,t){var e=arguments,l=t&&t.mdxType;if("string"==typeof n||l){var i=e.length,a=new Array(i);a[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=n,o.mdxType="string"==typeof n?n:l,a[1]=o;for(var s=2;s<i;s++)a[s]=e[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,e)}u.displayName="MDXCreateElement"},6321:function(n,t,e){e.r(t),e.d(t,{assets:function(){return k},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return c}});var r=e(7462),l=e(3366),i=(e(7294),e(3905)),a=["components"],o={},p="nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0",s={unversionedId:"\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0",id:"\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0",title:"nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0",description:"\u524d\u8a00",source:"@site/docs/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink",slug:"/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0",draft:!1,editUrl:"https://github.com/longyuwlz/longyu.github.io/docs/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"linux \u5185\u6838 connector \u6846\u67b6\u91cd\u8981\u7684\u6570\u636e\u7ed3\u6784\u53ca\u5176\u8054\u7cfb",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/linux \u5185\u6838 connector \u6846\u67b6\u91cd\u8981\u7684\u6570\u636e\u7ed3\u6784\u53ca\u5176\u8054\u7cfb"},next:{title:"\u4f7f\u7528 nlmon \u9a71\u52a8\u6293\u53d6 netlink \u62a5\u6587\u7684\u539f\u7406",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/\u5185\u6838\u539f\u7406\u5206\u6790/netlink/\u4f7f\u7528 nlmon \u9a71\u52a8\u6293\u53d6 netlink \u62a5\u6587\u7684\u539f\u7406"}},k={},c=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u518d\u6b21\u63cf\u8ff0 tcpdump \u6293\u53d6 netlink \u62a5\u6587\u7684\u539f\u7406",id:"\u518d\u6b21\u63cf\u8ff0-tcpdump-\u6293\u53d6-netlink-\u62a5\u6587\u7684\u539f\u7406",level:2},{value:"netlink_deliver_tap \u51fd\u6570",id:"netlink_deliver_tap-\u51fd\u6570",level:2},{value:"netlink_filter_tap",id:"netlink_filter_tap",level:2},{value:"\u70ed\u63d2\u62d4\u4e8b\u4ef6 netlink \u5bf9\u5e94\u7684 sk_protocol \u5b57\u6bb5\u7684\u503c",id:"\u70ed\u63d2\u62d4\u4e8b\u4ef6-netlink-\u5bf9\u5e94\u7684-sk_protocol-\u5b57\u6bb5\u7684\u503c",level:2}],u={toc:c};function m(n){var t=n.components,e=(0,l.Z)(n,a);return(0,i.kt)("wrapper",(0,r.Z)({},u,e,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"nlmon-\u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206-netlink-\u62a5\u6587\u7684\u539f\u56e0"},"nlmon \u9a71\u52a8\u53ea\u80fd\u6293\u53d6\u90e8\u5206 netlink \u62a5\u6587\u7684\u539f\u56e0"),(0,i.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,i.kt)("p",null,"\u6211\u5728\u3000",(0,i.kt)("a",{parentName:"p",href:"https://blog.csdn.net/Longyu_wlz/article/details/108879156"},"tcpdump \u6293\u53d6 netlink \u62a5\u6587")," \u8fd9\u7bc7\u535a\u6587\u4e2d\u63cf\u8ff0\u4e86\u5982\u4f55\u4f7f\u7528 nlmon \u9a71\u52a8\u6293\u53d6 netlink \u62a5\u6587\u7684\u8fc7\u7a0b\uff0c\u5728\u5b9e\u9645\u7684\u6d4b\u8bd5\u4e2d\u6211\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e9b netlink \u6d88\u606f\uff0c\u4f8b\u5982 usb \u8bbe\u5907\u70ed\u63d2\u62d4\u4e8b\u4ef6\u53d1\u9001\u7684 netlink \u6d88\u606f\u5c31\u4e0d\u80fd\u6293\u53d6\u5230\u3002"),(0,i.kt)("h2",{id:"\u518d\u6b21\u63cf\u8ff0-tcpdump-\u6293\u53d6-netlink-\u62a5\u6587\u7684\u539f\u7406"},"\u518d\u6b21\u63cf\u8ff0 tcpdump \u6293\u53d6 netlink \u62a5\u6587\u7684\u539f\u7406"),(0,i.kt)("p",null,"\u6211\u5728 ",(0,i.kt)("a",{parentName:"p",href:"https://blog.csdn.net/Longyu_wlz/article/details/108883293"},"\u4f7f\u7528 nlmon \u9a71\u52a8\u6293\u53d6 netlink \u62a5\u6587\u7684\u539f\u7406")," \u8fd9\u7bc7\u535a\u6587\u4e2d\u63cf\u8ff0\u4e86\u901a\u8fc7 nlmon \u9a71\u52a8\u6293\u53d6 netlink \u62a5\u6587\u7684\u539f\u7406\uff0c\u5176\u6838\u5fc3\u662f\u521b\u5efa\u4e86\u4e00\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"netlink tap")," \u53e3\uff0c\u5f53\u5185\u6838\u5728",(0,i.kt)("strong",{parentName:"p"},"\u53d1\u9001\u3001\u63a5\u6536")," netlink \u6d88\u606f\u65f6\uff0c\u62a5\u6587\u4f1a ",(0,i.kt)("strong",{parentName:"p"},"deliver")," \u5230\u8fd9\u865a\u62df\u7684 netlink tap \u53e3\u4e0a\uff0ctcpdump \u5c31\u662f\u901a\u8fc7\u8fd9\u4e2a tap \u53e3\u6765\u6293\u53d6 netlink \u6d88\u606f\u7684\u3002"),(0,i.kt)("h2",{id:"netlink_deliver_tap-\u51fd\u6570"},"netlink_deliver_tap \u51fd\u6570"),(0,i.kt)("p",null,"\u4e0a\u6587\u63d0\u5230\u7684 deliver netlink \u6d88\u606f\u5230 tap \u53e3\u4e0a\uff0c\u5b9e\u9645\u662f\u901a\u8fc7\u8c03\u7528 netlink_deliver_tap \u51fd\u6570\u6765\u5b8c\u6210\u7684\u3002"),(0,i.kt)("p",null,"netlink_deliver_tap \u53c8\u4f1a\u8c03\u7528 ",(0,i.kt)("strong",{parentName:"p"},"netlink_deliver_tap \u51fd\u6570\uff0c\u5728 "),"netlink_deliver_tap \u51fd\u6570\u4e2d\u6709\u5982\u4e0b\u76f8\u5173\u4ee3\u7801\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"static void __netlink_deliver_tap(struct sk_buff *skb, struct netlink_tap_net *nn)\n{\n    int ret;\n    struct netlink_tap *tmp;\n\n    if (!netlink_filter_tap(skb))\n        return;\n")),(0,i.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c_netlink_deliver_tap \u51fd\u6570\u4f1a\u5148\u8c03\u7528 netlink_filter_tap \u51fd\u6570\u6765",(0,i.kt)("strong",{parentName:"p"},"\u8fc7\u6ee4"),"\u53d1\u9001\u5230 tap \u53e3\u7684 netlink \u6d88\u606f\uff0c\u5f53 netlink_filter_tap \u51fd\u6570\u8fd4\u56de ",(0,i.kt)("strong",{parentName:"p"},"false")," \u540e _netlink_deliver_tap \u51fd\u6570",(0,i.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u8fd4\u56de"),"\uff0c\u76f8\u5173\u7684 netlink \u6d88\u606f\u5c31",(0,i.kt)("strong",{parentName:"p"},"\u4e0d\u4f1a\u8fc7 tap \u53e3"),"\uff0ctcpdump \u81ea\u7136\u4e5f\u5c31",(0,i.kt)("strong",{parentName:"p"},"\u6293\u53d6\u4e0d\u5230"),"\u8fd9\u90e8\u5206\u62a5\u6587\u3002"),(0,i.kt)("h2",{id:"netlink_filter_tap"},"netlink_filter_tap"),(0,i.kt)("p",null,"netlink_filter_tap \u51fd\u6570\u7684\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"static bool netlink_filter_tap(const struct sk_buff *skb)\n{\n    struct sock *sk = skb->sk;\n\n    /* We take the more conservative approach and\n     * whitelist socket protocols that may pass.\n     */\n    switch (sk->sk_protocol) {\n    case NTLINK_ROUTE:\n    case NETLINK_USERSOCK:\n    case NETLINK_SOCK_DIAG:\n    case NETLINK_NFLOG:\n    case NETLINK_XFRM:\n    case NETLINK_FIB_LOOKUP:\n    case NETLINK_NETFILTER:\n    case NETLINK_GENERIC:\n        return true;\n    }\n\n    return false;\n}\n")),(0,i.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5b83\u901a\u8fc7\u5224\u65ad sock \u4e2d\u7684 ",(0,i.kt)("strong",{parentName:"p"},"sk_protocol")," \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u5206\u53d1\uff0c\u4ec5\u4ec5\u5f53 sk_protocol \u7684\u503c\u662f switch \u4e2d\u5217\u4e3e\u7684\u90a3\u4e9b NETLINK \u534f\u8bae\u6d88\u606f\u7c7b\u578b\u65f6\u5b83\u624d\u4f1a\u8fd4\u56de true\uff0c\u5426\u5219\u5b83\u4f1a\u8fd4\u56de false\uff0c\u8fd9\u5c31\u662f tcpdump \u65e0\u6cd5\u6293\u53d6\u5230\u8bf8\u5982 usb \u8bbe\u5907\u70ed\u63d2\u62d4\u65f6\u5185\u6838\u53d1\u9001\u7684 netlink \u62a5\u6587\u7684\u539f\u56e0\u3002"),(0,i.kt)("h2",{id:"\u70ed\u63d2\u62d4\u4e8b\u4ef6-netlink-\u5bf9\u5e94\u7684-sk_protocol-\u5b57\u6bb5\u7684\u503c"},"\u70ed\u63d2\u62d4\u4e8b\u4ef6 netlink \u5bf9\u5e94\u7684 sk_protocol \u5b57\u6bb5\u7684\u503c"),(0,i.kt)("p",null,"\u70ed\u63d2\u62d4\u4e8b\u4ef6\u5904\u7406\u76f8\u5173\u7684\u4ee3\u7801\u5728\u5185\u6838\u6e90\u7801\u6811\u7684 ",(0,i.kt)("strong",{parentName:"p"},"lib/kobject_uevent.c")," \u4e2d\uff0c\u7740\u5b9e\u8ba9\u6211\u4e00\u987f\u597d\u627e\u3002\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u770b\u770b\u5176\u521d\u59cb\u5316\u4ee3\u7801\u4e2d\u521b\u5efa netlink sock \u7684\u51fd\u6570\u8c03\u7528\u5c31\u53ef\u4ee5\u4e86\u3002\u76f8\u5173\u8c03\u7528\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"ue_sk->sk = netlink_kernel_create(net, NETLINK_KOBJECT_UEVENT, &cfg);\n")),(0,i.kt)("p",null,"\u6b64\u51fd\u6570\u6700\u7ec8\u4f1a\u8c03\u7528\u5230 ",(0,i.kt)("strong",{parentName:"p"},"__netlink_create")," \u5e76\u5728\u5176\u4e2d\u521b\u5efa\u4e00\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"struct sock \u63a5\u53e3"),"\uff0c\u7136\u540e\u5c06\u8be5\u7ed3\u6784\u4f53\u4e2d\u7684 sk_protocol \u5b57\u6bb5\u8d4b\u503c\u4e3a ",(0,i.kt)("strong",{parentName:"p"},"NETLINK_KOBJECT_UEVENT"),"\u3002"),(0,i.kt)("p",null,"\u8fd9\u6837\u5728 ",(0,i.kt)("strong",{parentName:"p"},"netlink_filter_tap")," \u4e2d\u5224\u65ad\u5230\u8fd9\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"sk_protocol")," \u540e\uff0c\u51fd\u6570\u5c06\u4f1a\u8fd4\u56de ",(0,i.kt)("strong",{parentName:"p"},"false"),"\uff0c\u4e0d\u4f1a\u5c06\u76f8\u5173\u7684\u62a5\u6587\u6dfb\u52a0\u5230 ",(0,i.kt)("strong",{parentName:"p"},"netlink tap")," \u53e3\u4e2d\uff0c\u81ea\u7136\u4e5f\u5c31\u6293\u53d6\u4e0d\u5230\u8fd9\u79cd\u7c7b\u578b\u7684\u62a5\u6587\u4e86\u3002"))}m.isMDXComponent=!0}}]);