"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[7145],{3905:function(t,e,o){o.d(e,{Zo:function(){return p},kt:function(){return h}});var n=o(7294);function l(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function i(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach((function(e){l(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function a(t,e){if(null==t)return{};var o,n,l=function(t,e){if(null==t)return{};var o,n,l={},r=Object.keys(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||(l[o]=t[o]);return l}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(l[o]=t[o])}return l}var u=n.createContext({}),c=function(t){var e=n.useContext(u),o=e;return t&&(o="function"==typeof t?t(e):i(i({},e),t)),o},p=function(t){var e=c(t.components);return n.createElement(u.Provider,{value:e},t.children)},s={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var o=t.components,l=t.mdxType,r=t.originalType,u=t.parentName,p=a(t,["components","mdxType","originalType","parentName"]),d=c(o),h=l,m=d["".concat(u,".").concat(h)]||d[h]||s[h]||r;return o?n.createElement(m,i(i({ref:e},p),{},{components:o})):n.createElement(m,i({ref:e},p))}));function h(t,e){var o=arguments,l=e&&e.mdxType;if("string"==typeof t||l){var r=o.length,i=new Array(r);i[0]=d;var a={};for(var u in e)hasOwnProperty.call(e,u)&&(a[u]=e[u]);a.originalType=t,a.mdxType="string"==typeof t?t:l,i[1]=a;for(var c=2;c<r;c++)i[c]=o[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},3110:function(t,e,o){o.r(e),o.d(e,{assets:function(){return p},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return a},metadata:function(){return c},toc:function(){return s}});var n=o(7462),l=o(3366),r=(o(7294),o(3905)),i=["components"],a={},u="ethtool \u7684\u5de5\u4f5c\u539f\u7406",c={unversionedId:"\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u7684\u5de5\u4f5c\u539f\u7406",id:"\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u7684\u5de5\u4f5c\u539f\u7406",title:"ethtool \u7684\u5de5\u4f5c\u539f\u7406",description:"ethtool \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f",source:"@site/docs/\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u7684\u5de5\u4f5c\u539f\u7406.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool",slug:"/\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u7684\u5de5\u4f5c\u539f\u7406",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u7684\u5de5\u4f5c\u539f\u7406",draft:!1,editUrl:"https://github.com/longyuwlz/longyu.github.io/docs/\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u7684\u5de5\u4f5c\u539f\u7406.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ethtool \u652f\u6301 dump i40e \u7f51\u5361\u7684\u5bc4\u5b58\u5668",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u652f\u6301 dump x710 \u7f51\u5361\u5bc4\u5b58\u5668"},next:{title:"ethtool -s \u914d\u7f6e\u7f51\u5361\u901f\u7387\u53cc\u5de5\u7684\u6d41\u7a0b\u4e0e netdevice \u7684 user_ns \u7ed3\u6784",permalink:"/longyu.github.io/\u6280\u672f\u535a\u5ba2/linux-system/network/ethtool/ethtool \u914d\u7f6e\u7f51\u5361\u901f\u7387\u53cc\u5de5\u7684\u6d41\u7a0b\u4e0e netdevice \u7684 user_ns \u7ed3\u6784"}},p={},s=[{value:"ethtool \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f",id:"ethtool-\u662f\u5982\u4f55\u5de5\u4f5c\u7684",level:2},{value:"\u5982\u4f55\u83b7\u53d6 ethtool \u7684\u6e90\u7801?",id:"\u5982\u4f55\u83b7\u53d6-ethtool-\u7684\u6e90\u7801",level:3},{value:"ethtool \u7684\u5de5\u4f5c\u6d41\u7a0b",id:"ethtool-\u7684\u5de5\u4f5c\u6d41\u7a0b",level:3},{value:"ioctl \u51fd\u6570\u4e2d\u7684\u63a7\u5236\u4f20\u9012",id:"ioctl-\u51fd\u6570\u4e2d\u7684\u63a7\u5236\u4f20\u9012",level:2},{value:"devname \u5bf9\u5e94\u7684\u7f51\u7edc\u63a5\u53e3\u7684 netdev \u7ed3\u6784\u662f\u5982\u4f55\u83b7\u53d6\u5230\u7684\uff1f",id:"devname-\u5bf9\u5e94\u7684\u7f51\u7edc\u63a5\u53e3\u7684-netdev-\u7ed3\u6784\u662f\u5982\u4f55\u83b7\u53d6\u5230\u7684",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],d={toc:s};function h(t){var e=t.components,o=(0,l.Z)(t,i);return(0,r.kt)("wrapper",(0,n.Z)({},d,o,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"ethtool-\u7684\u5de5\u4f5c\u539f\u7406"},"ethtool \u7684\u5de5\u4f5c\u539f\u7406"),(0,r.kt)("h2",{id:"ethtool-\u662f\u5982\u4f55\u5de5\u4f5c\u7684"},"ethtool \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f"),(0,r.kt)("p",null,"\u6e90\u7801\u4e4b\u524d\uff0c\u4e86\u65e0\u79d8\u5bc6\u3002\u8981\u77e5\u9053 ethtool \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230\u5b83\u7684\u6e90\u7801\u3002"),(0,r.kt)("h3",{id:"\u5982\u4f55\u83b7\u53d6-ethtool-\u7684\u6e90\u7801"},"\u5982\u4f55\u83b7\u53d6 ethtool \u7684\u6e90\u7801?"),(0,r.kt)("p",null,"\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5728\u7f51\u7edc\u4e0a\u641c\u7d22\u6765\u5b8c\u6210\uff0c\u4f46\u662f\u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u65b9\u6cd5\u3002\u7531\u4e8e\u6211\u4f7f\u7528\u7684\u662f debian \u7cfb\u7edf\uff0c\u6211\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6 ethtool \u5de5\u5177\u7684\u6e90\u7801\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"longyu@longyu-pc:~$ sudo apt-get source ethtool\n")),(0,r.kt)("p",null,"\u6267\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4e4b\u540e\uff0c\u67e5\u770b\u5f53\u524d\u76ee\u5f55\uff0cethtool \u7684\u6e90\u7801\u5305\u5df2\u7ecf\u4e0b\u8f7d\u4e86\u4e0b\u6765\u3002\u5728\u6211\u7684\u7cfb\u7edf\u4e2d\u76f8\u5173\u7684\u6587\u4ef6\u5982\n\u4e0b\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"ethtool_4.19-1.debian.tar.xz\nethtool_4.19.orig.tar.xz")),(0,r.kt)("p",null,"\u6211\u5c06\u8fd9\u4e24\u4e2a\u6587\u4ef6\u89e3\u538b\uff0c\u53d1\u73b0 ethtool \u7684\u6e90\u7801\u5728 ethtool_4.19.orig.tar.xz \u4e2d\u3002"),(0,r.kt)("h3",{id:"ethtool-\u7684\u5de5\u4f5c\u6d41\u7a0b"},"ethtool \u7684\u5de5\u4f5c\u6d41\u7a0b"),(0,r.kt)("p",null,"\u901a\u8fc7\u9605\u8bfb\u6e90\u7801\uff0c\u6211\u5927\u81f4\u7406\u6e05\u4e86 ethtool \u5de5\u5177\u7684\u5de5\u4f5c\u6d41\u7a0b\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"ethtool \u7684\u6838\u5fc3\u5728\u4e8e\u901a\u8fc7 ioctl \u7684 SIOCETHTOOL \u547d\u4ee4\u6765\u8c03\u7528\u7f51\u7edc\u8bbe\u5907\u9a71\u52a8\u4e2d\u5b9e\u73b0\u7684 ethtool \u65b9\u6cd5\u7684\u5b9e\u4f8b\u6765\u83b7\u53d6\u6570\u636e\uff0c\u7136\u540e\u6839\u636e\u4e0d\u540c\u7f51\u5361\u7684\u4e0d\u540c\u914d\u7f6e\u683c\u5f0f\u5316\u6570\u636e\u4ee5\u8f93\u51fa\u3002")),(0,r.kt)("p",null,"ethtool \u547d\u4ee4\u4f7f\u7528 send_ioctl \u51fd\u6570\u6765\u4ece\u7f51\u5361\u4e2d\u83b7\u53d6\u4fe1\u606f\u3002send_ioctl \u51fd\u6570\u7684\u6e90\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"int send_ioctl(struct cmd_context *ctx, void *cmd)\n{\n    ctx->ifr.ifr_data = cmd;\n    return ioctl(ctx->fd, SIOCETHTOOL, &ctx->ifr);\n}\n")),(0,r.kt)("p",null,"\u8fd9\u91cc\u7684 ctx \u53c2\u6570\u53ef\u4ee5\u770b\u505a\u662f ioctl \u6267\u884c\u7684\u73af\u5883\uff0c\u5176\u4e2d\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e24\u4e2a\u5b57\u6bb5\uff1a"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. ctx->fd"),"\nctx->fd \u662f\u5728 main \u51fd\u6570\u4e2d\u901a\u8fc7\u8c03\u7528 socket \u51fd\u6570\u6765\u83b7\u53d6\u5230\u7684\u7f51\u7edc\u8bbe\u5907\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'        ctx.fd = socket(AF_INET, SOCK_DGRAM, 0);\n        if (ctx.fd < 0)\n            ctx.fd = socket(AF_NETLINK, SOCK_RAW, NETLINK_GENERIC);\n        if (ctx.fd < 0) {\n            perror("Cannot get control socket");\n            return 70;\n        }\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. ctx->ifr \u7ed3\u6784\u4f53")),(0,r.kt)("p",null,"ifr \u7ed3\u6784\u4f53\u4e2d\u91cd\u8981\u7684\u662f\u4e24\u4e2a\u5b57\u6bb5\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"ifr_name "),(0,r.kt)("p",{parentName:"li"},"ifr_name \u4e2d\u4fdd\u5b58\u7684\u5185\u5bb9\u662f\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4e2d\u6307\u5b9a\u7684\u7f51\u7edc\u8bbe\u5907\u7684\u540d\u79f0\uff0c\u5982 eth1\u3001ens33 \u7b49\u3002\n")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"ifr_data "),(0,r.kt)("p",{parentName:"li"},"ifr_data \u4e2d\u4fdd\u5b58\u7740 ethtool \u4e2d\u66f4\u4e3a\u5177\u4f53\u7684\u547d\u4ee4\uff0c\u5982 ETHTOOL_GDRVINFO\u3001ETHTOOL_GREGS\u3001ETHTOOL_GWOL \u7b49\u3002"))),(0,r.kt)("p",null,"ctx->fd \u8fd9\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u662f\u7f51\u7edc\u8bbe\u5907\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5728\u5185\u6838\u4e2d\u5bf9\u5e94\u4e86\u7f51\u7edc\u8bbe\u5907\u7684\u79c1\u6709 file_operations\u3002\u8fd9\u4e2a file_operations \u865a\u51fd\u6570\u8868\u5728 socket.c \u4e2d\u88ab\u5b9a\u4e49\u3002"),(0,r.kt)("h2",{id:"ioctl-\u51fd\u6570\u4e2d\u7684\u63a7\u5236\u4f20\u9012"},"ioctl \u51fd\u6570\u4e2d\u7684\u63a7\u5236\u4f20\u9012"),(0,r.kt)("p",null,"ethtool \u547d\u4ee4\u6267\u884c ioctl \u540e\u8fdb\u5165\u5185\u6838\uff0c\u5728\u5185\u6838\u4e2d\u63a7\u5236\u4f20\u9012\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"sock_ioctl ---\x3e dev_ioctl ---\x3e dev_ethtool ---\x3e ethtool layer ---\x3edev->ethtool_ops")),(0,r.kt)("p",null,"\u6700\u7ec8\u8c03\u7528\u5230\u7684\u51fd\u6570\u662f\u5728\u7f51\u5361\u9a71\u52a8\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u8c03\u7528 SET_ETHTOOL_OPS \u8bbe\u5b9a\u7684\u3010ethtool_ops\u3011\u865a\u51fd\u6570\u8868\u4e2d\u7684\u51fd\u6570\u6307\u9488\u3002\u5728 netdev \u7ed3\u6784\u4f53\u4e2d\u6709\u6307\u5411 ethtool_ops \u865a\u51fd\u6570\u8868\u7684\u6307\u9488\uff0c\u4e0d\u540c\u7684\u7f51\u5361\u5c06\u7ed1\u5b9a\u4e0d\u540c\u7684\u865a\u51fd\u6570\u8868\uff0c\u8fd9\u5b9e\u73b0\u4e86 ethtool\u3010\u63a5\u53e3\u7684\u91cd\u8f7d\u3011\u3002"),(0,r.kt)("p",null,"\u65e2\u7136\u4e0d\u540c\u7684\u7f51\u5361\u4f1a\u7ed1\u5b9a\u4e0d\u540c\u7684\u865a\u51fd\u6570\u8868\uff0c\u90a3\u4e48\u6211\u4eec\u662f\u600e\u6837\u901a\u8fc7\u7f51\u5361\u63a5\u53e3\u540d\u79f0\u83b7\u53d6\u5230\u8fd9\u5f20\u8868\u7684\u5462\uff1f"),(0,r.kt)("p",null,"\u6211\u60f3\u8fd9\u4e00\u5b9a\u4e0e ethtool \u547d\u4ee4\u5728\u6267\u884c\u65f6\u4f20\u9012\u7684 devname \u6709\u5173\u3002\u65e2\u7136\u5728 netdev \u7ed3\u6784\u4f53\u4e2d\u6709\u6307\u5411 ehtool_ops \u865a\u51fd\u6570\u8868\u7684\u6307\u9488\uff0c\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86 devname \u8868\u793a\u7684\u7f51\u7edc\u63a5\u53e3 netdev \u7ed3\u6784\u5982\u4f55\u83b7\u53d6\u5230\u7684\u95ee\u9898\u3002"),(0,r.kt)("h2",{id:"devname-\u5bf9\u5e94\u7684\u7f51\u7edc\u63a5\u53e3\u7684-netdev-\u7ed3\u6784\u662f\u5982\u4f55\u83b7\u53d6\u5230\u7684"},"devname \u5bf9\u5e94\u7684\u7f51\u7edc\u63a5\u53e3\u7684 netdev \u7ed3\u6784\u662f\u5982\u4f55\u83b7\u53d6\u5230\u7684\uff1f"),(0,r.kt)("p",null,"\u8be6\u7ec6\u7684\u63cf\u8ff0\u8bf7\u53c2\u8003\u6211\u7684\u8fd9\u7bc7\u535a\u6587\u2014\u2014",(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/Longyu_wlz/article/details/103249749"},"ethtool \u547d\u4ee4\u6307\u5b9a\u7684 devname \u662f\u5728\u54ea\u91cc\u88ab\u4f7f\u7528\u7684\uff1f")),(0,r.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("p",null,"ethtool \u7684\u5de5\u4f5c\u539f\u7406\u975e\u5e38\u7b80\u5355\uff0c\u4f46\u662f\u5728\u5185\u6838\u4e2d\u7684\u8c03\u7528\u5c42\u6b21\u975e\u5e38\u590d\u6742\u3002\u6211\u8fd9\u91cc\u53ea\u5bf9 ethtool \u7684\u5de5\u4f5c\u539f\u7406\u8fdb\u884c\u4e86\u975e\u5e38\u7c97\u7cd9\u7684\u63cf\u8ff0\uff0c\u5ffd\u7565\u4e86\u4e00\u4e9b\u7ec6\u8282\u3002\u7406\u6e05 ethtool \u7684\u5de5\u4f5c\u539f\u7406\u4e4b\u540e\uff0c\u6211\u53d1\u73b0\u5176\u5b9e\u53ea\u9700\u8981\u5173\u6ce8\u7f51\u5361\u9a71\u52a8\u4e2d\u7684 ethtool_ops \u865a\u51fd\u6570\u8868\u7684\u5b9e\u73b0\u4ee5\u53ca\u5728 ethtool \u8c03\u7528\u65f6\u4f20\u9012\u7684 devname \u5728\u54ea\u91cc\u88ab\u4f7f\u7528\u8fd9\u4e24\u4e2a\u65b9\u9762\u5c31\u80fd\u591f\u6293\u4f4f\u5173\u952e\u3002"))}h.isMDXComponent=!0}}]);