"use strict";(self.webpackChunklongyu_website=self.webpackChunklongyu_website||[]).push([[9094],{3905:function(e,t,r){r.d(t,{Zo:function(){return d},kt:function(){return u}});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},_=Object.keys(e);for(n=0;n<_.length;n++)r=_[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(n=0;n<_.length;n++)r=_[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var f=n.createContext({}),a=function(e){var t=n.useContext(f),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},d=function(e){var t=a(e.components);return n.createElement(f.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,_=e.originalType,f=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=a(r),u=i,F=c["".concat(f,".").concat(u)]||c[u]||p[u]||_;return r?n.createElement(F,o(o({ref:t},d),{},{components:r})):n.createElement(F,o({ref:t},d))}));function u(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var _=r.length,o=new Array(_);o[0]=c;var l={};for(var f in t)hasOwnProperty.call(t,f)&&(l[f]=t[f]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var a=2;a<_;a++)o[a]=r[a];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},1178:function(e,t,r){r.r(t),r.d(t,{assets:function(){return d},contentTitle:function(){return f},default:function(){return u},frontMatter:function(){return l},metadata:function(){return a},toc:function(){return p}});var n=r(7462),i=r(3366),_=(r(7294),r(3905)),o=["components"],l={},f=void 0,a={permalink:"/longyu.github.io/blog/dpdk/l2fwd \u652f\u6301 x710 \u901a\u8fc7 fdir \u8fc7\u6ee4\u975e\u5206\u7247 ipv4 udp \u62a5\u6587",editUrl:"https://github.com/longyuwlz/longyu.github.io/blog/dpdk/l2fwd \u652f\u6301 x710 \u901a\u8fc7 fdir \u8fc7\u6ee4\u975e\u5206\u7247 ipv4 udp \u62a5\u6587.md",source:"@site/blog/dpdk/l2fwd \u652f\u6301 x710 \u901a\u8fc7 fdir \u8fc7\u6ee4\u975e\u5206\u7247 ipv4 udp \u62a5\u6587.md",title:"dpdk/l2fwd \u652f\u6301 x710 \u901a\u8fc7 fdir \u8fc7\u6ee4\u975e\u5206\u7247 ipv4 udp \u62a5\u6587",description:"\u95ee\u9898\u63cf\u8ff0",date:"2022-06-21T00:32:49.000Z",formattedDate:"2022\u5e746\u670821\u65e5",tags:[],readingTime:1.595,truncated:!1,authors:[],frontMatter:{},prevItem:{title:"dpdk/igb_uio.ko \u7684 md5sum \u4e3a\u5565\u53c8\u53d8\u5316\u4e86\uff1f",permalink:"/longyu.github.io/blog/dpdk/igb_uio.ko \u7684 md5sum \u4e3a\u5565\u53c8\u53d8\u5316\u4e86\uff1f"},nextItem:{title:"dpdk/x710 hash \u5206\u7247\u4e0e\u975e\u5206\u7247 tcp \u62a5\u6587\u5f02\u5e38\u95ee\u9898",permalink:"/longyu.github.io/blog/dpdk/x710 hash \u5206\u7247\u4e0e\u975e\u5206\u7247 tcp \u62a5\u6587\u5f02\u5e38\u95ee\u9898"}},d={authorsImageUrls:[]},p=[{value:"\u95ee\u9898\u63cf\u8ff0",id:"\u95ee\u9898\u63cf\u8ff0",level:2},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848",level:2},{value:"1. port_conf \u7684\u914d\u7f6e\uff0c\u7528\u4e8e dev_configure",id:"1-port_conf-\u7684\u914d\u7f6e\u7528\u4e8e-dev_configure",level:3},{value:"2. rte_eth_fdir_filter_info \u4e0e rte_eth_fdir_filter \u5b57\u6bb5\u586b\u5145",id:"2-rte_eth_fdir_filter_info-\u4e0e-rte_eth_fdir_filter-\u5b57\u6bb5\u586b\u5145",level:3},{value:"3. \u8c03\u7528 rte_eth_dev_filter_ctrl \u5b8c\u6210\u914d\u7f6e\u8fc7\u7a0b",id:"3-\u8c03\u7528-rte_eth_dev_filter_ctrl-\u5b8c\u6210\u914d\u7f6e\u8fc7\u7a0b",level:3},{value:"4. \u7a0b\u5e8f\u9000\u51fa\u524d\u6307\u5b9a RTE_ETH_FILTER_FLUSH \u53c2\u6570\uff0c\u8c03\u7528 rte_eth_dev_filter_ctrl \u6765\u6e05\u7a7a\u914d\u7f6e\uff01",id:"4-\u7a0b\u5e8f\u9000\u51fa\u524d\u6307\u5b9a-rte_eth_filter_flush-\u53c2\u6570\u8c03\u7528-rte_eth_dev_filter_ctrl-\u6765\u6e05\u7a7a\u914d\u7f6e",level:3}],c={toc:p};function u(e){var t=e.components,r=(0,i.Z)(e,o);return(0,_.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,_.kt)("h2",{id:"\u95ee\u9898\u63cf\u8ff0"},"\u95ee\u9898\u63cf\u8ff0"),(0,_.kt)("p",null,"\u9700\u8981\u901a\u8fc7 x710 \u7f51\u5361 fdir \u529f\u80fd\u8fc7\u6ee4\u975e\u5206\u7247 ipv4 udp \u62a5\u6587\uff0c\u76f4\u63a5\u5728\u7f51\u5361\u786c\u4ef6\u4e0a\u4e22\u5f03\u3002"),(0,_.kt)("h2",{id:"\u89e3\u51b3\u65b9\u6848"},"\u89e3\u51b3\u65b9\u6848"),(0,_.kt)("p",null,"\u901a\u8fc7\u4fee\u6539 l2fwd \u4ee3\u7801\u6765\u9a8c\u8bc1\uff0c\u9700\u8981\u6ce8\u610f\u5f53\u5f00\u542f\u4e86 fdir \u7684\u65f6\u5019 hash \u529f\u80fd\u9700\u8981\u5173\u95ed\u3002"),(0,_.kt)("h3",{id:"1-port_conf-\u7684\u914d\u7f6e\u7528\u4e8e-dev_configure"},"1. port_conf \u7684\u914d\u7f6e\uff0c\u7528\u4e8e dev_configure"),(0,_.kt)("pre",null,(0,_.kt)("code",{parentName:"pre",className:"language-c"},"static const struct rte_eth_conf port_conf = {\n    .rxmode = {\n        .split_hdr_size = 0,\n        .header_split   = 0, /**< Header Split disabled */\n        .hw_ip_checksum = 0, /**< IP checksum offload disabled */\n        .hw_vlan_filter = 0, /**< VLAN filtering disabled */\n        .jumbo_frame    = 0, /**< Jumbo Frame Support disabled */\n        .hw_strip_crc   = 0, /**< CRC stripped by hardware */\n    },\n    .txmode = {\n        .mq_mode = ETH_MQ_TX_NONE,\n    },\n    .fdir_conf = {\n        .mode = RTE_FDIR_MODE_PERFECT,\n        .pballoc = RTE_FDIR_PBALLOC_64K,\n        .status = RTE_FDIR_REPORT_STATUS,\n        .mask = {\n            .vlan_tci_mask = 0x0,\n            .ipv4_mask     = {\n                .src_ip = 0xFFFFFFFF,\n                .dst_ip = 0xFFFFFFFF,\n            },\n            .ipv6_mask     = {\n                .src_ip = {0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF},\n                .dst_ip = {0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF},\n            },\n            .src_port_mask = 0xFFFF,\n            .dst_port_mask = 0xFFFF,\n            .mac_addr_byte_mask = 0xFF,\n            .tunnel_type_mask = 1,\n            .tunnel_id_mask = 0xFFFFFFFF,\n        },\n        .drop_queue = 127,\n    },\n\n};\n")),(0,_.kt)("h3",{id:"2-rte_eth_fdir_filter_info-\u4e0e-rte_eth_fdir_filter-\u5b57\u6bb5\u586b\u5145"},"2. rte_eth_fdir_filter_info \u4e0e rte_eth_fdir_filter \u5b57\u6bb5\u586b\u5145"),(0,_.kt)("pre",null,(0,_.kt)("code",{parentName:"pre",className:"language-c"},"    struct rte_eth_fdir_filter_info info;\n\n    memset(&info, 0, sizeof(info));\n    info.info_type = RTE_ETH_FDIR_FILTER_INPUT_SET_SELECT;\n    info.info.input_set_conf.flow_type = RTE_ETH_FLOW_NONFRAG_IPV4_UDP;\n    info.info.input_set_conf.field[0] = RTE_ETH_INPUT_SET_NONE;\n    info.info.input_set_conf.inset_size = 0;\n    info.info.input_set_conf.op = RTE_ETH_INPUT_SET_SELECT;\n\n    struct rte_eth_fdir_filter arg_udpport = {\n        .soft_id = 1,\n        .input   = {\n            .flow_type = RTE_ETH_FLOW_NONFRAG_IPV4_UDP,\n        },\n        .action  = {\n            .rx_queue  =  0,\n            .behavior  = RTE_ETH_FDIR_REJECT,\n            .report_status = RTE_ETH_FDIR_REPORT_ID,\n        },\n    };\n")),(0,_.kt)("h3",{id:"3-\u8c03\u7528-rte_eth_dev_filter_ctrl-\u5b8c\u6210\u914d\u7f6e\u8fc7\u7a0b"},"3. \u8c03\u7528 rte_eth_dev_filter_ctrl \u5b8c\u6210\u914d\u7f6e\u8fc7\u7a0b"),(0,_.kt)("pre",null,(0,_.kt)("code",{parentName:"pre",className:"language-c"},'    ret = rte_eth_dev_filter_ctrl(portid, RTE_ETH_FILTER_FDIR, RTE_ETH_FILTER_SET, &info);\n    printf("ret is %d\\n", ret);\n    ret = rte_eth_dev_filter_ctrl(portid, RTE_ETH_FILTER_FDIR,RTE_ETH_FILTER_ADD, &arg_udpport);\n    printf("ret is %d\\n", ret);\n')),(0,_.kt)("h3",{id:"4-\u7a0b\u5e8f\u9000\u51fa\u524d\u6307\u5b9a-rte_eth_filter_flush-\u53c2\u6570\u8c03\u7528-rte_eth_dev_filter_ctrl-\u6765\u6e05\u7a7a\u914d\u7f6e"},"4. \u7a0b\u5e8f\u9000\u51fa\u524d\u6307\u5b9a RTE_ETH_FILTER_FLUSH \u53c2\u6570\uff0c\u8c03\u7528 rte_eth_dev_filter_ctrl \u6765\u6e05\u7a7a\u914d\u7f6e\uff01"))}u.isMDXComponent=!0}}]);