# c 语言未包含头文件导致的问题
## 问题描述

最近在做项目时遇到了一个奇怪的问题。调用函数获取被调函数返回的指针，获取成功后解引用时偶尔会导致程序崩溃。

## 定位问题
首先查看源码，没有发现明显的问题。

这之后开始调试，在调试中发现被调函数的 return 语句处的指针值是正确的，赋值之后值发生了变化。

为了进一步确定问题，我做了如下尝试：

复制被调函数的函数体，将其放到调用函数内部执行，再次观察结果。这次问题没有出现，查看地址发现正常。

## 进一步的分析问题
这时我可以确定应该是返回值传递过程中出现了问题。可是难道在此期间有人修改了返回值吗？首先排除了这种可能，毕竟没有其它执行流在同时执行。

最后发现原来是没有包含足够的头文件导致返回值被截断。如果是在 32 位机器上这个问题不会造成任何严重后果。编译器猜测的 int 型返回值类型的长度与指针长度相同，不会产生截断问题。在 64 位机器上这个问题也是偶然出现的，如果分配的内存的地址区域没有超过 32-bit 长度，仍旧不会产生问题。

## 总结
这个问题说明了头文件包含的重要性，也体现了工程结构中不合理的头文件包含结构可能会造成的严重后果，需要在前期的设计中就注意规避这个问题！


